

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405190208396.jpg">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405190208396.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta name="google-site-verification" content="AjiazagGb4CIlb9bWWd66wgpHJ5-hhpbR58p3yYikbE" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Moon">
  <meta name="keywords" content="">
  
    <meta name="description" content="本文讲述用C++实现的设计模式">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式(C++)">
<meta property="og:url" content="https://moonfordream.github.io/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-C/index.html">
<meta property="og:site_name" content="Moon&#39;s Blog">
<meta property="og:description" content="本文讲述用C++实现的设计模式">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202411161127985.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202411161127986.png">
<meta property="article:published_time" content="2024-11-16T03:24:57.000Z">
<meta property="article:modified_time" content="2024-11-16T03:29:18.891Z">
<meta property="article:author" content="Moon">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202411161127985.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>设计模式(C++) - Moon&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/scrollAnimation.css">
<link rel="stylesheet" href="/css/selection.css">
<link rel="stylesheet" href="/css/mk.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"moonfordream.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Moon&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405190159278.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="设计模式(C++)"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-11-16 11:24" pubdate>
          2024年11月16日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          24k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          201 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="设计模式"
        id="heading-301a19970448f8e4f27ddae7a7d415fe" role="tab" data-toggle="collapse" href="#collapse-301a19970448f8e4f27ddae7a7d415fe"
        aria-expanded="true"
      >
        设计模式
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-301a19970448f8e4f27ddae7a7d415fe"
           role="tabpanel" aria-labelledby="heading-301a19970448f8e4f27ddae7a7d415fe">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-C/" title="设计模式(C++)"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">设计模式(C++)</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">设计模式(C++)</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><strong>设计模式是什么</strong>：</p>
<ul>
<li><strong>设计模式是用于解决在开发过程中产生的设计问题，每种设计模式都解决特定的问题，并且在适合的场景下使用能够带来明显的设计优势</strong>，提高了项目的健壮性、可理解性，易维护性。</li>
<li>简单来说，设计模式是一种模板结构，每种设计模式都有其优点和适用的场景，当我们实现某个功能按照适应场景选择使用相应的设计模式来构建我们的代码结构，能够提高代码的可复用性等好处</li>
</ul>
<p><strong>设计模式目的</strong>：</p>
<ol>
<li><code>可复用</code>：通过这些设计模式，我们可以在多个项目重用这些模式，利于项目后期维护升级，可复用前版本代码</li>
<li><code>标准化</code>：在复杂系统的设计过程中，设计模式提供了一个标准化的方法，使得代码更加统一和规范</li>
</ol>
<p><strong>设计模式原则</strong>：</p>
<ol>
<li><code>依赖倒置原则</code>：高层次的代码（稳定）不应该依赖低层次的代码（变化）、抽象的代码不应该依赖具体的代码，避免依赖具体的类，尽量依赖抽象</li>
<li><code>开放封闭原则</code>：类模块应该开放扩展的，而其原先的代码尽量封闭不可改变</li>
<li><code>单一职责原则</code>：一个类应该仅有一个变化的原因，该变化隐含了它的职责，职责太多时会导致扩展时对代码东拉西扯，造成混乱</li>
<li><code>替换原则</code>：子类必须能够替换它的基类（IS-A），继承可以表达类型抽象</li>
<li><code>接口隔离原则</code>：接口应该小而完备，不该强迫用户使用多余的方法</li>
<li><code>优先使用组合而不是继承</code>：继承通常会让子类和父类的耦合度增加、组合的方式只要求组件具备良好定义的接口</li>
<li><code>封装变化点</code></li>
<li><code>针对接口编程，而不是针对实现编程</code></li>
</ol>
<p><strong>设计模式分类</strong>：</p>
<ul>
<li><code>创建型模式</code>：创建对象的机制，<strong>通过”对象创建”模式绕开new</strong>，**来避免对象创建过程中所导致的紧耦合(依赖具体类)**，从所需要实例化的对象中解耦(解耦就是降低模块之间的依赖程度)</li>
<li><code>结构型模式</code>：将对象或类组装到更大的结构中</li>
<li><code>行为模式</code>：负载对象间的交互和分配职责</li>
</ul>
<h2 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h2><p><code>UML</code>：统一建模语言，经常用于来描述类或者类与类之间的关系</p>
<p><strong>关系词描述</strong>：</p>
<ol>
<li><code>依赖</code>：对类B进行修改会影响到类A</li>
<li><code>关联</code>：<strong>对象A知道对象B</strong>，类A依赖于类B</li>
<li><code>聚合</code>：对象A知道对象B<strong>且由B构成</strong>。类A依赖于类B</li>
<li><code>组合</code>：对象A知道对象B且由B构成，且<strong>管理着B的生命周期</strong>。类A依赖于类B</li>
<li><code>实现</code>：类A定义的方法由接口B声明(B is A接口)。对象A可被视为对象B。类A依赖于类B</li>
<li><code>继承</code>：类A继承类B的接口和实现(B is A父类)，但是可以对其进行扩展。对象A可被视为对象B。类A依赖于类B</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202411161127985.png" srcset="/img/loading.gif" lazyload alt="image-20241030101857438"></p>
<h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><p>​	</p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>​	</p>
<p><code>工厂模式(Factory pattern)</code>：是一种<strong>创建型</strong>设计模式，旨在通过定义一个<strong>用于创建对象的接口，让子类决定实例化哪一个类</strong>。工厂模式使一个类的实例化延迟到其子类。这种模式使得代码<strong>更加灵活、可扩展，并且遵循“开闭原则”（对扩展开放，对修改封闭）</strong></p>
<p>​	</p>
<p>​	</p>
<p><strong>种类</strong>：</p>
<ol>
<li><code>简单工厂模式</code></li>
<li><code>工厂方法模式</code></li>
<li><code>抽象工厂模式</code></li>
</ol>
<p>​	</p>
<p>​	</p>
<p><strong>解决的问题</strong>：</p>
<ol>
<li><code>解耦对象的创建与使用</code>： 工厂模式将对象的创建过程从客户端代码中抽离出来，客户端只需要通过工厂接口获取对象，而不需要知道具体的创建细节。这<strong>降低了客户端与具体实现之间的耦合度</strong>。</li>
<li><code>增强系统的可扩展性</code>： 通过引入工厂接口和具体工厂类，可以方便地<strong>扩展新产品类型</strong>，而<strong>无需修改现有的客户端代码</strong>。这符合“开闭原则”，即对扩展开放，对修改封闭。</li>
<li><code>集中管理对象创建</code>： 将对象创建的逻辑集中在工厂类中，<strong>便于统一管理和维护</strong>。例如，可以在工厂类中添加日志、缓存、单例等功能，而<strong>无需在多个客户端中重复实现</strong>。</li>
<li><code>提高代码的可维护性和可读性</code>： 工厂模式通过明确的接口和类结构，使代码的职责分明，增强了代码的可读性和可维护性。</li>
</ol>
<blockquote>
<p>注意：在设计模式的上下文中，“客户端”指的是<strong>使用或调用某个设计模式提供的接口或功能的代码部分</strong></p>
</blockquote>
<p>​	</p>
<p>​	</p>
<h3 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h3><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>:</p>
<ul>
<li><code>简单工厂模式</code>：定义一个工厂类，根据传入的标识来决定创建哪一种产品类的实例</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li>简化对象创建过程</li>
<li>客户端不需要知道具体的产品类</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>工厂类<strong>集中了所有产品的创建逻辑</strong>，违背了单一职责原则</li>
<li><strong>难以扩展新产品</strong>，如果需要扩展则需要修改工厂类创建产品的代码实现，违背了开放封闭原则</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>示例代码</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// 产品基类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">product</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">product</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;   <span class="hljs-comment">//将产品行为定义为纯虚函数，用于具体类修改</span><br>&#125;;<br><br><br><span class="hljs-comment">// 具体产品类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">productA</span>:<span class="hljs-keyword">public</span> product&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;使用产品A&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">productB</span>:<span class="hljs-keyword">public</span> product&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;使用产品B&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 工厂类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">factory</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">static</span> product* <span class="hljs-title">createproduct</span><span class="hljs-params">(<span class="hljs-type">char</span> type)</span></span>&#123;<br>        product* p=<span class="hljs-literal">nullptr</span>;<br>        <span class="hljs-keyword">switch</span>(type)&#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;A&#x27;</span>:<br>                p=<span class="hljs-keyword">new</span> <span class="hljs-built_in">productA</span>();<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;B&#x27;</span>:<br>                p=<span class="hljs-keyword">new</span> <span class="hljs-built_in">productB</span>();<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> p;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    <span class="hljs-keyword">auto</span> producta=factory::<span class="hljs-built_in">createproduct</span>(<span class="hljs-string">&#x27;A&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(producta)&#123;<br>        producta-&gt;<span class="hljs-built_in">use</span>();<br>        <span class="hljs-keyword">delete</span> producta;<br>    &#125;<br><br>    <span class="hljs-keyword">auto</span> productb=factory::<span class="hljs-built_in">createproduct</span>(<span class="hljs-string">&#x27;B&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(productb)&#123;<br>        productb-&gt;<span class="hljs-built_in">use</span>();<br>        <span class="hljs-keyword">delete</span> productb;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br><span class="hljs-comment">// 输出结果</span><br><span class="hljs-comment">// || 使用产品A</span><br><span class="hljs-comment">// || 使用产品B</span><br><span class="hljs-comment">// || Exited with code 0</span><br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h3 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h3><p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>工厂方法模式</code>：用于<strong>定义一个创建对象的接口，但由子类决定实例化哪个类</strong>，工厂方法<strong>让类把实例化推迟到子类</strong>。是一个类创建型模式，也就是用类解决问题</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：一个物流公司最初只使用卡车运输，现需要增加轮船运输业务，目前的程序代码与卡车关联。</p>
<p><strong>解决方案</strong>：定义一个用于创建对象的接口，让子类决定实例化哪一个类。factory method使一个类的实例化延迟到子类</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li>遵循开放封闭原则，<strong>易于扩展新产品</strong></li>
<li><strong>每个具体工厂只负责创建一种产品</strong>，符合单一职责原则</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>增加了类的数量</strong>，增加了系统的复杂性</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li>当一个类不知道它所必须创建的对象的类的时候。</li>
<li>当一个类希望由其子类来指定所创建的对象的时候。</li>
<li>当类将创建对象的职责委托给多个帮助子类中的某一个，并且你希望将哪一个帮助子类是代理者这一信息局部化的时候。</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>： 定义一个抽象工厂类，具体工厂类继承抽象工厂类并实现创建具体产品的方法。</p>
<p>​	</p>
<p>​	</p>
<p><strong>示例代码</strong>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// 产品基类(接口)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">product</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">product</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体产品A</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">productA</span>:<span class="hljs-keyword">public</span> product&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;使用产品A&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体产品B</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">productB</span>:<span class="hljs-keyword">public</span> product&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;使用产品B&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 工厂方法类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">creator</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">creator</span>()&#123;&#125;<br>    <span class="hljs-comment">// 工厂方法核心</span><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> product* <span class="hljs-title">createproduct</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">douse</span><span class="hljs-params">()</span></span>&#123;<br>        product* p=<span class="hljs-built_in">createproduct</span>();<br>        p-&gt;<span class="hljs-built_in">use</span>();<br>        <span class="hljs-keyword">delete</span> p;<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-comment">// 具体创建者A</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">creatorA</span>:<span class="hljs-keyword">public</span> creator&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">product* <span class="hljs-title">createproduct</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">productA</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体创建者B</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">creatorB</span>:<span class="hljs-keyword">public</span> creator&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">product* <span class="hljs-title">createproduct</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">productB</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    creator* creatora=<span class="hljs-keyword">new</span> <span class="hljs-built_in">creatorA</span>();<br>    creatora-&gt;<span class="hljs-built_in">douse</span>();<br>    creator* creatorb=<span class="hljs-keyword">new</span> <span class="hljs-built_in">creatorB</span>();<br>    creatorb-&gt;<span class="hljs-built_in">douse</span>();<br>    <span class="hljs-keyword">delete</span> creatora;<br>    <span class="hljs-keyword">delete</span> creatorb;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<p><strong>解析</strong>：</p>
<ol>
<li><strong>产品基类</strong>将会对接口进行声明</li>
<li><strong>具体产品</strong>是产品接口的不同实现</li>
<li><strong>创建者</strong>声明返回产品对象的<code>工厂方法</code></li>
<li><strong>具体创建者</strong>将会重写基础工厂方法，使其返回不同类型的产品</li>
</ol>
<blockquote>
<p>注意：为什么不叫工厂的原因在于这是工厂方法模式，<strong>工厂方法就是生产产品的方法而不是工厂类</strong>，为了区分其他工厂模式，这里叫作创建者</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>抽象工厂模式</code>：提供一个创建一系列相关或相互依赖对象的接口，而<strong>无需指定它们具体的类</strong>。是一个对象创建型模式，也就是用对象解决问题</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：家具店有沙发、椅子、茶几等产品。产品有不同的风格，如现代、北欧、工业。希望确保客户端收到的产品风格统一，并可以方便的添加新产品和风格</p>
<p><strong>解决方案</strong>：提供一个创建一系列相关或相互依赖对象的接口，而无需指定他们具体的类</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li>生成的产品是一系列相关的对象，保证了产品的一致性</li>
<li>易于交换产品系列</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>增加了系统的复杂性，尤其是当需要<strong>增加新的产品系列</strong>时，<strong>需要修改抽象工厂和所有具体工厂</strong></li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li>一个系统要独立于它的产品的创建、组合和表示时。</li>
<li>一个系统要由多个产品系列中的一个来配置时。</li>
<li>当你要强调一系列相关的产品对象的设计以便进行联合使用时。</li>
<li>当你提供一个产品类库，而只想显示它们的接口而不是实现时。</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>： 定义一个抽象工厂接口，具体工厂类实现该接口并创建一系列相关产品。</p>
<p>​	</p>
<p><strong>示例代码</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// 抽象产品类A(会有一系列具体产品继承产品类A)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">productA</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">productA</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 抽象产品类B(会有一系列具体产品继承产品类B)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">productB</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">productB</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体产品A1 -- 属于产品类A的产品,风格为1</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">productA1</span>:<span class="hljs-keyword">public</span> productA&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">productA1</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;使用产品类A的产品A1,风格为1&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体产品A1 -- 属于产品类A的产品,风格为2</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">productA2</span>:<span class="hljs-keyword">public</span> productA&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">productA2</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;使用产品类A的产品A2,风格为2&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br><br>&#125;;<br><br><span class="hljs-comment">// 具体产品B1 -- 属于产品类B的产品,风格为1</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">productB1</span>:<span class="hljs-keyword">public</span> productB&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">productB1</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;使用产品类B的产品B1,风格为1&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体产品B1 -- 属于产品类B的产品,风格为1</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">productB2</span>:<span class="hljs-keyword">public</span> productB&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">productB2</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;使用产品类B的产品B2,风格为2&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 抽象工厂类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">factory</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> productA* <span class="hljs-title">createproductA</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> productB* <span class="hljs-title">createproductB</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体工厂类1,专门用于生产风格为1的一系列产品</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">factory1</span>:<span class="hljs-keyword">public</span> factory&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">productA* <span class="hljs-title">createproductA</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">productA1</span>();<br>    &#125;<br>    <span class="hljs-function">productB* <span class="hljs-title">createproductB</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">productB1</span>();<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-comment">// 具体工厂类2,专门用于生产风格为2的一系列产品</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">factory2</span>:<span class="hljs-keyword">public</span> factory&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">productA* <span class="hljs-title">createproductA</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">productA2</span>();<br>    &#125;<br>    <span class="hljs-function">productB* <span class="hljs-title">createproductB</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">productB2</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">client</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    factory* m_factory;     <span class="hljs-comment">//工厂对象</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">client</span>(factory* fy)&#123;<br>        m_factory=fy;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">douse</span><span class="hljs-params">()</span></span>&#123;<br>        productA* pa=m_factory-&gt;<span class="hljs-built_in">createproductA</span>();<br>        productB* pb=m_factory-&gt;<span class="hljs-built_in">createproductB</span>();<br>        pa-&gt;<span class="hljs-built_in">use</span>();<br>        pb-&gt;<span class="hljs-built_in">use</span>();<br>        <span class="hljs-keyword">delete</span> pa;<br>        <span class="hljs-keyword">delete</span> pb;<br>    &#125;<br><br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    <span class="hljs-comment">// 我要使用风格为1的产品，这样我们的工厂类就只会使用对应的一系列产品</span><br>    factory1 fy1;<br>    <span class="hljs-function">client <span class="hljs-title">cli1</span><span class="hljs-params">(&amp;fy1)</span></span>;<br>    cli1.<span class="hljs-built_in">douse</span>();    <span class="hljs-comment">//只会生产同系列的产品</span><br>    factory2 fy2;<br>    <span class="hljs-function">client <span class="hljs-title">cli2</span><span class="hljs-params">(&amp;fy2)</span></span>;<br>    cli2.<span class="hljs-built_in">douse</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// 输出结果</span><br><span class="hljs-comment">/* || 使用产品类A的产品A1,风格为1</span><br><span class="hljs-comment">|| 使用产品类B的产品B1,风格为1</span><br><span class="hljs-comment">|| 使用产品类A的产品A2,风格为2</span><br><span class="hljs-comment">|| 使用产品类B的产品B2,风格为2</span><br><span class="hljs-comment">|| Exited with code 0 */</span><br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<p><strong>解析</strong>：</p>
<ol>
<li><strong>抽象产品</strong>：构成系列产品的一组不同但相关的产品声明接口</li>
<li><strong>具体产品</strong>：抽象产品的多重不同类型实现</li>
<li><strong>抽象工厂</strong>：声明类了彝族创建各种抽象产品的方法</li>
<li><strong>具体工厂</strong>：实现抽象工厂的构架方法</li>
<li><strong>客户端</strong>：只需通过抽象接口调用工厂和产品对象</li>
</ol>
<p>​	</p>
<p>​	</p>
<h2 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>建造者模式(Builder pattern)</code>：是一种对象创建型模式，旨在<strong>将一个复杂对象的构建过程与其表示分离</strong>，使得<strong>同样的构建过程可以创建不同的表示</strong>。这种模式通过逐步构建对象的各个部分，<strong>允许客户端通过指挥者（Director）或直接使用建造者接口来创建所需的对象</strong>。</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：当需要构建一个房屋时，房屋可能包含不同的组件，如地砖、衣柜、空调、游泳池等。直接在房屋类（<code>House</code>）中添加所有可能的参数会导致类的复杂性增加，特别是当需要创建具有不同参数组合的房屋时，可能需要大量的子类或复杂的构造函数，这既不方便扩展，也不利于维护。</p>
<p><strong>解决方案</strong>：采用建造者模式，将房屋的构建过程与其表示分离。通过分步骤构建房屋的各个部分，使得客户端可以灵活地选择需要的组件，而无需关心房屋的具体构建细节。</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>解决的问题</strong>：</p>
<ul>
<li><strong>创建复杂对象的分步骤构建</strong>： 当一个对象的创建过程涉及多个步骤，并且这些步骤需要按照特定的顺序执行时，建造者模式能够将这些步骤组织起来，使得创建过程更加清晰和灵活。</li>
<li><strong>同一构建过程创建不同表示</strong>： 通过不同的具体建造者，可以使用相同的构建过程来创建不同的对象表示。</li>
<li><strong>隐藏对象的创建细节</strong>： 客户端代码无需了解对象创建的具体步骤和内部结构，只需通过建造者接口进行操作。这提高了代码的封装性和可维护性。</li>
<li><strong>促进代码的可扩展性</strong>： 当需要添加新的对象类型时，只需创建新的具体建造者，而无需修改已有的构建过程或客户端代码，符合开闭原则。</li>
</ul>
<p>	</p>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>分离复杂构建过程和表示</strong>：使得构建过程独立于产品的具体表示。</li>
<li><strong>易于扩展</strong>：可以通过添加新的具体建造者来创建不同的产品表示，无需修改现有代码。</li>
<li><strong>提高代码的可读性和可维护性</strong>：将对象的构建过程封装起来，使代码更加清晰。</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>增加了系统的复杂性</strong>：引入了多个角色（建造者接口、具体建造者、指挥者等），增加了类的数量。</li>
<li><strong>对于简单对象的创建可能过于复杂</strong>：如果对象的创建过程简单，使用建造者模式可能显得冗余。</li>
<li><strong>产品差异不能过大</strong>：使用得到限制</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>示例代码</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-comment">// 产品类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">house</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    std::vector&lt;std::string&gt; m_parts;   <span class="hljs-comment">// 房屋组成部分</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setbase</span><span class="hljs-params">(std::string s)</span></span>&#123;<br>        m_parts.<span class="hljs-built_in">emplace_back</span>(s);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setgarage</span><span class="hljs-params">(std::string s)</span></span>&#123;<br>        m_parts.<span class="hljs-built_in">emplace_back</span>(s);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setpool</span><span class="hljs-params">(std::string s)</span></span>&#123;<br>        m_parts.<span class="hljs-built_in">emplace_back</span>(s);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">describe</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;House Details:\n&quot;</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span>&amp; s:m_parts)&#123;<br>            std::cout&lt;&lt;s&lt;&lt;std::endl;<br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 建造者接口</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">builder</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">builder</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">reset</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;     <span class="hljs-comment">//辅助使用，并非是建造者模式所需</span><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">buildbase</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>; <span class="hljs-comment">//建造房屋基础</span><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">buildgarage</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;   <span class="hljs-comment">//建造车库</span><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">buildpool</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>; <span class="hljs-comment">//建造游泳池</span><br>&#125;;<br><br><span class="hljs-comment">// 具体建造者 -- 简单房屋建造者</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">simplehousebuilder</span>:<span class="hljs-keyword">public</span> builder&#123;<br><span class="hljs-keyword">private</span>:<br>    house* simplehouse;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">simplehousebuilder</span>()&#123;<br>        simplehouse=<span class="hljs-keyword">new</span> <span class="hljs-built_in">house</span>();<br>    &#125;<br>    ~<span class="hljs-built_in">simplehousebuilder</span>()&#123;<br>        <span class="hljs-keyword">delete</span> simplehouse;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reset</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        simplehouse=<span class="hljs-keyword">new</span> <span class="hljs-built_in">house</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">buildbase</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        simplehouse-&gt;<span class="hljs-built_in">setbase</span>(<span class="hljs-string">&quot;simple basehouse&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">buildgarage</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        simplehouse-&gt;<span class="hljs-built_in">setgarage</span>(<span class="hljs-string">&quot;simple garage&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">buildpool</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        simplehouse-&gt;<span class="hljs-built_in">setpool</span>(<span class="hljs-string">&quot;simple swimming pool&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 返回产品，这个不需要放到建造者接口,因为返回产品类型不同</span><br>    <span class="hljs-function">house* <span class="hljs-title">getresult</span><span class="hljs-params">()</span></span>&#123;<br>        house* result=std::<span class="hljs-built_in">move</span>(simplehouse);   <span class="hljs-comment">//管理权交出</span><br>        <span class="hljs-built_in">reset</span>();<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-comment">// 具体建造者 -- 豪华房屋建造者</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">luxuryhousebuilder</span>:<span class="hljs-keyword">public</span> builder&#123;<br><span class="hljs-keyword">private</span>:<br>    house* luxuryhouse;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">luxuryhousebuilder</span>()&#123;<br>        luxuryhouse=<span class="hljs-keyword">new</span> <span class="hljs-built_in">house</span>();<br>    &#125;<br>    ~<span class="hljs-built_in">luxuryhousebuilder</span>()&#123;<br>        <span class="hljs-keyword">delete</span> luxuryhouse;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reset</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        luxuryhouse=<span class="hljs-keyword">new</span> <span class="hljs-built_in">house</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">buildbase</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        luxuryhouse-&gt;<span class="hljs-built_in">setbase</span>(<span class="hljs-string">&quot;luxury basehouse&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">buildgarage</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        luxuryhouse-&gt;<span class="hljs-built_in">setgarage</span>(<span class="hljs-string">&quot;luxury garage&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">buildpool</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        luxuryhouse-&gt;<span class="hljs-built_in">setpool</span>(<span class="hljs-string">&quot;luxury swimming pool&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 返回产品，这个不需要放到建造者接口,因为返回产品类型不同</span><br>    <span class="hljs-function">house* <span class="hljs-title">getresult</span><span class="hljs-params">()</span></span>&#123;<br>        house* result=luxuryhouse;   <span class="hljs-comment">//管理权交出</span><br>        <span class="hljs-built_in">reset</span>();<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 指挥者类，负责构建流程,可封装各种建造房屋方法(可扩展可复用)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">director</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    builder* m_builder;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setbuilder</span><span class="hljs-params">(builder* builder_)</span></span>&#123;<br>        m_builder=builder_;<br>    &#125;<br>    <span class="hljs-comment">// 建造不同类型房子</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">buildhouse</span><span class="hljs-params">()</span></span>&#123;<br>        m_builder-&gt;<span class="hljs-built_in">buildbase</span>();<br>        m_builder-&gt;<span class="hljs-built_in">buildgarage</span>();<br>        m_builder-&gt;<span class="hljs-built_in">buildpool</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    <span class="hljs-comment">// 无指挥者</span><br>    std::cout&lt;&lt;<span class="hljs-string">&quot;客户自己设计:\n&quot;</span>;<br>    simplehousebuilder* simplebuilder=<span class="hljs-keyword">new</span> <span class="hljs-built_in">simplehousebuilder</span>();<br>    simplebuilder-&gt;<span class="hljs-built_in">buildbase</span>();<br>    simplebuilder-&gt;<span class="hljs-built_in">buildgarage</span>();<br>    simplebuilder-&gt;<span class="hljs-built_in">buildpool</span>();<br>    house* simplehouse=simplebuilder-&gt;<span class="hljs-built_in">getresult</span>();<br>    simplehouse-&gt;<span class="hljs-built_in">describe</span>();<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;指挥者建造:\n&quot;</span>;<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;简单房子:\n&quot;</span>;<br>    director director_;<br>    director_.<span class="hljs-built_in">setbuilder</span>(simplebuilder);<br>    director_.<span class="hljs-built_in">buildhouse</span>();<br>    simplehouse=simplebuilder-&gt;<span class="hljs-built_in">getresult</span>();<br>    simplehouse-&gt;<span class="hljs-built_in">describe</span>();<br>    <span class="hljs-keyword">delete</span> simplehouse;<br>    <span class="hljs-keyword">delete</span> simplebuilder;<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;-----------------------\n&quot;</span>;<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;豪华房子:\n&quot;</span>;<br>    luxuryhousebuilder* luxurybuilder=<span class="hljs-keyword">new</span> <span class="hljs-built_in">luxuryhousebuilder</span>();<br>    director_.<span class="hljs-built_in">setbuilder</span>(luxurybuilder);<br>    director_.<span class="hljs-built_in">buildhouse</span>();<br>    house* luxuryhouse=luxurybuilder-&gt;<span class="hljs-built_in">getresult</span>();<br>    luxuryhouse-&gt;<span class="hljs-built_in">describe</span>();<br>    <span class="hljs-keyword">delete</span> luxuryhouse;<br>    <span class="hljs-keyword">delete</span> luxurybuilder;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// 输出结果</span><br><span class="hljs-comment">/* || 客户自己设计:</span><br><span class="hljs-comment">|| House Details:</span><br><span class="hljs-comment">|| simple basehouse</span><br><span class="hljs-comment">|| simple garage</span><br><span class="hljs-comment">|| simple swimming pool</span><br><span class="hljs-comment">|| 指挥者建造:</span><br><span class="hljs-comment">|| 简单房子:</span><br><span class="hljs-comment">|| House Details:</span><br><span class="hljs-comment">|| simple basehouse</span><br><span class="hljs-comment">|| simple garage</span><br><span class="hljs-comment">|| simple swimming pool</span><br><span class="hljs-comment">|| -----------------------</span><br><span class="hljs-comment">|| 豪华房子:</span><br><span class="hljs-comment">|| House Details:</span><br><span class="hljs-comment">|| luxury basehouse</span><br><span class="hljs-comment">|| luxury garage</span><br><span class="hljs-comment">|| luxury swimming pool</span><br><span class="hljs-comment">|| Exited with code 0 */</span><br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<p><strong>解析</strong>：</p>
<ol>
<li><strong>建造者</strong>：声明通用的产品构造步骤</li>
<li><strong>具体建造者</strong>：提供构造过程的不同实现，具体建造者也可以构造不遵循通用接口的产品</li>
<li><strong>产品</strong>：最终生成的对象，由不同建造者构造的产品无需属于同一类层次结构或接口</li>
<li><strong>指挥者</strong>：定义调用构造步骤的顺序，这样可以创建和复用特定的产品配置</li>
<li><strong>客户端</strong>：必须将某个建造者对象与指挥者类关联，一般情况下，只需通过指挥者类构造函数的参数进行一次性关联即可</li>
</ol>
<p>​	</p>
<p>​	</p>
<h2 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>原型模式(protoytpe pattern)</code>：是一种对象创建型模式，，旨在<strong>通过复制现有的实例来创建新的对象</strong>，而不是通过新建实例。</li>
<li><strong>定义</strong>：定义了一个用于创建对象的接口，通过拷贝现有的实例（原型），来生成新的对象。这种模式<strong>允许系统在运行时动态地创建新的对象，而无需依赖具体类的实例化过程</strong></li>
<li><strong>适用场景</strong>：适用于<strong>创建过程复杂、代价高昂或需要大量资源的对象</strong>，因为它能够<strong>通过克隆现有对象来节省创建新对象的时间和资源</strong>。</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：希望复制一个状态完全相同的对象。首先，新建一个相同的类的对象。然后，复制所有成员变量。但是，有时候不知道具体类型，而且成员变量可能是私有的(从外部复制对象并非总是可行的)</p>
<p><strong>解决方案</strong>：用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。即复制已有对象，而无需使代码依赖他们所属的类</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>解决的问题</strong>：</p>
<ul>
<li><strong>对象创建开销大</strong>：当创建一个对象需要耗费大量资源或时间（如复杂的初始化过程、大量的数据加载等）时，直接克隆一个现有对象比重新创建一个新对象更高效。</li>
<li><strong>动态类型</strong>：在某些情况下，程序在编译时无法确定需要创建的具体类类型，而原型模式允许在运行时通过克隆现有对象来创建所需类型的实例。</li>
<li><strong>避免依赖具体类</strong>：原型模式通过接口或抽象类进行对象的克隆，减少了代码对具体类的依赖，提高了系统的灵活性和可扩展性。</li>
<li><strong>配置对象</strong>：在需要根据用户输入或配置文件动态生成对象的场景中，原型模式可以通过克隆预配置好的原型对象来快速生成所需对象。</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ol>
<li><strong>性能优化</strong>：克隆对象通常比重新创建对象更高效，特别是当对象创建开销大时。</li>
<li><strong>灵活性和可扩展性</strong>：通过原型接口，可以轻松地增加新的具体原型类，而无需修改客户端代码。</li>
<li><strong>减少代码冗余</strong>：避免了重复的初始化代码，通过克隆现有对象简化了对象的创建过程。</li>
</ol>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ol>
<li><strong>实现复杂性</strong>：对于复杂对象，深拷贝（deep copy）可能需要额外的处理，以确保对象内部所有引用的对象也被正确克隆。</li>
<li><strong>资源消耗</strong>：虽然克隆比新建高效，但在某些情况下，频繁的克隆操作可能会消耗大量内存。</li>
<li><strong>隐藏类结构</strong>：客户端通过克隆获取对象，可能对对象的内部结构缺乏了解，增加了系统的复杂性。</li>
</ol>
<p>​	</p>
<p>​	</p>
<p><strong>示例代码</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-comment">// 原型接口(类似于抽象产品类和抽象工厂类结合在一起)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">protoytpe</span>&#123;<br><span class="hljs-keyword">protected</span>:<br>    std::string m_name=<span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">protoytpe</span>(<span class="hljs-type">const</span> std::string&amp; val):<span class="hljs-built_in">m_name</span>(val)&#123;&#125;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">protoytpe</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> protoytpe* <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;     <span class="hljs-comment">//用于克隆，也就是类似于抽象工厂类的生产</span><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">getname</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;     <span class="hljs-comment">//抽象产品类的方法</span><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">settype</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体原型类1</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">protoytpe1</span>:<span class="hljs-keyword">public</span> protoytpe&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> m_type1;    <span class="hljs-comment">//原型类1特有变量</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">protoytpe1</span>()&#123;&#125;<br>    <span class="hljs-built_in">protoytpe1</span>(<span class="hljs-type">const</span> std::string&amp; val,<span class="hljs-type">int</span> type):<span class="hljs-built_in">protoytpe</span>(val),<span class="hljs-built_in">m_type1</span>(type)&#123;&#125;<br>    <span class="hljs-function">protoytpe* <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">protoytpe1</span>(*<span class="hljs-keyword">this</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">getname</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;------------------------------&quot;</span>&lt;&lt;std::endl;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;protoytpe_type:&quot;</span>&lt;&lt;m_type1&lt;&lt;std::endl;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;protoytpe_name:&quot;</span>&lt;&lt;m_name&lt;&lt;std::endl;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;------------------------------&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">settype</span><span class="hljs-params">(<span class="hljs-type">int</span> type)</span> <span class="hljs-keyword">override</span></span>&#123;<br>        m_type1=type;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">//具体原型类2</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">protoytpe2</span>:<span class="hljs-keyword">public</span> protoytpe&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> m_type2;    <span class="hljs-comment">//原型类2特有变量</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">protoytpe2</span>()&#123;&#125;<br>    <span class="hljs-built_in">protoytpe2</span>(<span class="hljs-type">const</span> std::string&amp; val,<span class="hljs-type">int</span> type):<span class="hljs-built_in">protoytpe</span>(val),<span class="hljs-built_in">m_type2</span>(type)&#123;&#125;<br>    <span class="hljs-function">protoytpe* <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">protoytpe2</span>(*<span class="hljs-keyword">this</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">getname</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;------------------------------&quot;</span>&lt;&lt;std::endl;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;protoytpe_type:&quot;</span>&lt;&lt;m_type2&lt;&lt;std::endl;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;protoytpe_name:&quot;</span>&lt;&lt;m_name&lt;&lt;std::endl;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;------------------------------&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">settype</span><span class="hljs-params">(<span class="hljs-type">int</span> type)</span> <span class="hljs-keyword">override</span></span>&#123;<br>        m_type2=type;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    <span class="hljs-comment">// 创建具体原型对象</span><br>    <span class="hljs-function">protoytpe1 <span class="hljs-title">original1</span><span class="hljs-params">(<span class="hljs-string">&quot;Original1&quot;</span>, <span class="hljs-number">100</span>)</span></span>;<br>    <span class="hljs-function">protoytpe2 <span class="hljs-title">original2</span><span class="hljs-params">(<span class="hljs-string">&quot;Original2&quot;</span>, <span class="hljs-number">200</span>)</span></span>;<br><br>    <span class="hljs-comment">// 展示原型对象的属性</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;原型对象1:&quot;</span> &lt;&lt; std::endl;<br>    original1.<span class="hljs-built_in">getname</span>();<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;原型对象2:&quot;</span> &lt;&lt; std::endl;<br>    original2.<span class="hljs-built_in">getname</span>();<br><br>    <span class="hljs-comment">// 克隆具体原型对象</span><br>    protoytpe* clone1 = original1.<span class="hljs-built_in">clone</span>();<br>    protoytpe* clone2 = original2.<span class="hljs-built_in">clone</span>();<br><br>    <span class="hljs-comment">// 修改克隆对象的属性</span><br>    clone1-&gt;<span class="hljs-built_in">settype</span>(<span class="hljs-number">101</span>);<br>    clone2-&gt;<span class="hljs-built_in">settype</span>(<span class="hljs-number">201</span>);<br><br>    <span class="hljs-comment">// 展示克隆对象的属性</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;克隆对象1:&quot;</span> &lt;&lt; std::endl;<br>    clone1-&gt;<span class="hljs-built_in">getname</span>();<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;克隆对象2:&quot;</span> &lt;&lt; std::endl;<br>    clone2-&gt;<span class="hljs-built_in">getname</span>();<br><br>    <span class="hljs-comment">// 验证原型对象的属性是否未被修改</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;验证原型对象1是否未被修改:&quot;</span> &lt;&lt; std::endl;<br>    original1.<span class="hljs-built_in">getname</span>();<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;验证原型对象2是否未被修改:&quot;</span> &lt;&lt; std::endl;<br>    original2.<span class="hljs-built_in">getname</span>();<br><br>    <span class="hljs-comment">// 释放克隆对象的内存</span><br>    <span class="hljs-keyword">delete</span> clone1;<br>    <span class="hljs-keyword">delete</span> clone2;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// 输出结果</span><br><span class="hljs-comment">/* || 原型对象1:</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| protoytpe_type:100</span><br><span class="hljs-comment">|| protoytpe_name:Original1</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| 原型对象2:</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| protoytpe_type:200</span><br><span class="hljs-comment">|| protoytpe_name:Original2</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| 克隆对象1:</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| protoytpe_type:101</span><br><span class="hljs-comment">|| protoytpe_name:Original1</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| 克隆对象2:</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| protoytpe_type:201</span><br><span class="hljs-comment">|| protoytpe_name:Original2</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| 验证原型对象1是否未被修改:</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| protoytpe_type:100</span><br><span class="hljs-comment">|| protoytpe_name:Original1</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| 验证原型对象2是否未被修改:</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| protoytpe_type:200</span><br><span class="hljs-comment">|| protoytpe_name:Original2</span><br><span class="hljs-comment">|| ------------------------------</span><br><span class="hljs-comment">|| Exited with code 0 */</span><br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<p><strong>解析</strong>：</p>
<ol>
<li><strong>原型</strong>：接口将对克隆方法进行声明</li>
<li><strong>具体原型</strong>：类将实现克隆方法。除了将原始对象的数据复制到克隆体中之外，该方法有时还需处理克隆过程中的极端情况，例如克隆关联对象和梳理递归以来等等</li>
<li><strong>客户端</strong>：可以复制实现了原型接口的任何对象</li>
</ol>
<p>​	</p>
<p>​	</p>
<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>​	</p>
<p>​	</p>
<h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p><strong>概念</strong>：</p>
<ul>
<li><code>单例模式(Singleton pattern)</code>：是一种对象创建型模式，其<strong>主要目的是确保一个类只有一个实例，并提供一个全局访问点来获取该实例</strong>。单例模式在需要控制资源的访问或确保全局状态的一致性时非常有用</li>
<li><strong>定义</strong>：保证一个类仅有一个实例，并提供一个访问该实例的全局点。这意味着，<strong>无论系统中有多少个对象需要使用该类，都将共享同一个实例</strong>，因此我们单例类的构造函数必须对客户端代码隐藏，而提供一个静态方法来作为全局公共访问点来获取对象</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：对于一些类来说，只有一个实例是很重要的。例如数据库或其共享资源的访问权限。并且这个实例需要易于被访问</p>
<p><strong>解决方案</strong>：保证一个类只有一个实例，并提供一个访问它的全局访问点</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>解决的问题</strong>：</p>
<ul>
<li><strong>控制资源的访问</strong>：当某个资源（如数据库连接、日志文件）需要全局唯一时，单例模式可以确保对该资源的唯一访问，避免资源冲突和竞争条件。</li>
<li><strong>全局状态管理</strong>：在应用程序中需要维护一个全局状态或配置，如配置管理器、线程池等，单例模式确保这些管理器只有一个实例，保证状态的一致性。</li>
<li><strong>避免重复实例化</strong>：当创建对象的开销较大，且只需要一个实例时，使用单例模式可以避免不必要的重复实例化，节省资源和提高性能。</li>
<li><strong>实现全局对象</strong>：单例模式提供了一个全局访问点，便于在整个应用程序中访问该对象，而无需传递引用或指针。</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>确保唯一性</strong>：保证系统中只有一个实例，避免了资源冲突和不一致性。</li>
<li><strong>全局访问</strong>：提供了一个全局访问点，便于在整个应用程序中访问该实例。</li>
<li><strong>延迟实例化</strong>（如果实现了懒加载）：实例在首次使用时创建，节省了系统资源。</li>
<li><strong>易于实现</strong>：在大多数编程语言中，单例模式的实现相对简单。</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>违背单一职责原则</strong>：单例类既负责自己的业务逻辑，又负责管理其唯一实例，可能导致职责不清。</li>
<li><strong>难以测试</strong>：单例模式可能导致代码之间的紧密耦合，增加单元测试的复杂性。</li>
<li><strong>隐藏的依赖性</strong>：全局访问点可能隐藏类之间的依赖关系，降低代码的可维护性和可读性。</li>
<li><strong>并发问题</strong>：在多线程环境下，需要确保单例实例的创建是线程安全的，否则可能创建多个实例。</li>
</ul>
<p>​	</p>
<p>​	</p>
<h3 id="饿汉式"><a href="#饿汉式" class="headerlink" title="饿汉式"></a>饿汉式</h3><p><code>饿汉式单例</code>：<strong>在程序启动时就创建单例实例</strong>，线程安全但可能导致资源浪费</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>简单</strong></li>
<li><strong>线程安全</strong></li>
</ul>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>如果程序未使用单例就导致<strong>资源浪费</strong></li>
</ul>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// 饿汉式单例模式</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">singleton</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-comment">// 静态私有实例</span><br>    <span class="hljs-type">static</span> singleton instance;<br><br>    <span class="hljs-comment">// 私有构造函数,防止外部实例化</span><br>    <span class="hljs-built_in">singleton</span>()&#123;&#125;<br><br>    <span class="hljs-comment">// 禁用拷贝构造函数和赋值运算符</span><br>    <span class="hljs-built_in">singleton</span>(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br>    singleton&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 公共静态方法，提供访问点(获取实例)</span><br>    <span class="hljs-function"><span class="hljs-type">static</span> singleton&amp; <span class="hljs-title">getinstance</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br><br>    <span class="hljs-comment">// 测试函数</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">showmess</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;hello!&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 静态成员初始化</span><br>singleton singleton::instance;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    singleton &amp;s=singleton::<span class="hljs-built_in">getinstance</span>();<br>    s.<span class="hljs-built_in">showmess</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h3 id="懒汉式"><a href="#懒汉式" class="headerlink" title="懒汉式"></a>懒汉式</h3><p><code>懒汉式单例(不加锁)</code>：**在第一次使用时创建实例，节省资源(延迟加载)**。多线程下不安全</p>
<p><code>懒汉式单例(加锁)</code>：在第一次使用时创建实例，节省资源(延迟加载)。<strong>线程安全，但是性能较低，因为每次获取实例都需要加锁</strong></p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>延迟加载，节省资源</strong></li>
</ul>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>(未加锁)线程不安全</strong></li>
<li><strong>(加锁)性能较低</strong></li>
</ul>
<p>​	</p>
<p><strong>实现</strong>：</p>
<ul>
<li><p><code>未加锁</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// 懒汉式单例(未加锁)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">singleton</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-comment">// 静态私有指针</span><br>    <span class="hljs-type">static</span> singleton* instance;<br><br>    <span class="hljs-comment">// 私有构造函数</span><br>    <span class="hljs-built_in">singleton</span>()&#123;&#125;<br><br>    <span class="hljs-comment">// 禁用拷贝构造函数和赋值运算符</span><br>    <span class="hljs-built_in">singleton</span>(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br>    singleton&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 公共静态方法，提供访问点(获取单例实例)</span><br>    <span class="hljs-function"><span class="hljs-type">static</span> singleton* <span class="hljs-title">getinstance</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">if</span>(instance==<span class="hljs-literal">nullptr</span>)&#123;<br>            instance=<span class="hljs-keyword">new</span> <span class="hljs-built_in">singleton</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br><br>    <span class="hljs-comment">// 测试函数</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">showmess</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;hello!&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 静态成员初始化</span><br>singleton* singleton::instance=<span class="hljs-literal">nullptr</span>;<br><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    singleton* s=singleton::<span class="hljs-built_in">getinstance</span>();<br>    s-&gt;<span class="hljs-built_in">showmess</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><code>加锁</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><br><span class="hljs-comment">// 懒汉式单例(加锁)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">singleton</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-comment">// 静态私有指针</span><br>    <span class="hljs-type">static</span> singleton* instance;<br>    <span class="hljs-type">static</span> std::mutex mtx;<br><br>    <span class="hljs-comment">// 私有构造函数</span><br>    <span class="hljs-built_in">singleton</span>()&#123;&#125;<br><br>    <span class="hljs-comment">// 禁用拷贝构造和赋值运算符</span><br>    <span class="hljs-built_in">singleton</span>(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br>    singleton&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 公共静态方法，提供访问点(获取单例实例)</span><br>    <span class="hljs-function"><span class="hljs-type">static</span> singleton* <span class="hljs-title">getinstance</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;<br>        <span class="hljs-keyword">if</span>(instance==<span class="hljs-literal">nullptr</span>)&#123;<br>            instance=<span class="hljs-keyword">new</span> <span class="hljs-built_in">singleton</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br><br>    <span class="hljs-comment">// 测试函数</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">showmess</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;hello!&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 静态成员初始化</span><br>singleton* singleton::instance=<span class="hljs-literal">nullptr</span>;<br>std::mutex singleton::mtx;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    singleton* s=singleton::<span class="hljs-built_in">getinstance</span>();<br>    s-&gt;<span class="hljs-built_in">showmess</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<p>​	</p>
<p>​	</p>
<h3 id="双重检查锁定单例"><a href="#双重检查锁定单例" class="headerlink" title="双重检查锁定单例"></a>双重检查锁定单例</h3><p><code>双重检查锁定单例</code>：结合懒汉式和饿汉式的优点，<strong>减少锁的开销，线程安全</strong></p>
<blockquote>
<p><strong>问题</strong>：因为<strong>懒汉式的锁只有第一次有用，但是剩下的每次都要进行加锁，很浪费性能</strong></p>
<p><strong>解决方案</strong>：<strong>选择多加一次检查，可以避免后面每次加锁</strong></p>
</blockquote>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>延迟加载，节省资源</strong></li>
<li><strong>保证只使用了一次锁</strong>，大大减少性能消耗</li>
<li><strong>线程安全</strong></li>
</ul>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>实现复杂</li>
<li><strong>不稳定</strong>：某些编译器和架构下可能存在问题</li>
</ul>
<p>​	</p>
<p><strong>稳定问题</strong>：双重检查锁定(DLC)单例模式，避免在每次访问单例实例时都进行锁操作。但在实际实现中，双重检查锁定单例模式在某些编程语言（尤其是 C++）中存在一些显著的问题</p>
<p>​	</p>
<p><strong>双重检查锁定在C++中的问题</strong>：C++编译器和处理器可能会对<code>指令重排序</code>，以优化性能，这就代表着即使程序代码按顺序编写，实际执行的顺序可能不同。在双重检查锁定中，<strong>这种重排序可能导致单例实例在完全构造之前就被其他线程看到</strong></p>
<blockquote>
<p><code>具体问题</code>：</p>
<ul>
<li>当一个线程（线程 A）正在执行 <code>instance = new Singleton();</code> 时，可能会发生以下步骤：</li>
</ul>
<ol>
<li>分配内存。</li>
<li>初始化 <code>Singleton</code> 对象。</li>
<li>将 <code>instance</code> 指向新分配的内存。</li>
</ol>
<ul>
<li>由于指令重排序，步骤 3 可能会在步骤 2 之前完成。这意味着另一个线程（线程 B）可能会看到 <code>instance</code> 不为空，但 <code>Singleton</code> 对象尚未完全构造。</li>
</ul>
<p><code>结果</code>：</p>
<ul>
<li>线程 B 可能会获取一个部分构造的 <code>Singleton</code> 实例，导致未定义行为和潜在的崩溃。</li>
</ul>
<p><code>解决方案</code>：</p>
<ul>
<li>使用<code>std::call_once</code>和<code>std::once_flag</code>保证<code>instance = new Singleton()</code>代码块只执行一次即可</li>
<li><strong>推荐使用局部静态变量单例</strong></li>
</ul>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<ul>
<li><p><code>双重检查锁定单例</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><br><span class="hljs-comment">// 双重检查锁定单例</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">singleton</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-comment">// 静态私有指针</span><br>    <span class="hljs-type">static</span> singleton* instance;<br>    <span class="hljs-type">static</span> std::mutex mtx;<br><br>    <span class="hljs-comment">// 私有构造函数</span><br>    <span class="hljs-built_in">singleton</span>()&#123;&#125;<br><br>    <span class="hljs-comment">// 禁用拷贝构造函数和赋值运算符</span><br>    <span class="hljs-built_in">singleton</span>(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br>    singleton&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 公共静态方法，提供访问点(获取实例)</span><br>    <span class="hljs-function"><span class="hljs-type">static</span> singleton* <span class="hljs-title">getinstance</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">if</span>(instance==<span class="hljs-literal">nullptr</span>)&#123;      <span class="hljs-comment">//第一次检查</span><br>            <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;<br>            <span class="hljs-keyword">if</span>(instance==<span class="hljs-literal">nullptr</span>)&#123;      <span class="hljs-comment">//第二次检查</span><br>                instance=<span class="hljs-keyword">new</span> <span class="hljs-built_in">singleton</span>();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br><br>    <span class="hljs-comment">// 测试函数</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">showmess</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;hello!&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 静态成员初始化</span><br>singleton* singleton::instance=<span class="hljs-literal">nullptr</span>;<br>std::mutex singleton::mtx;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    singleton* s=singleton::<span class="hljs-built_in">getinstance</span>();<br>    s-&gt;<span class="hljs-built_in">showmess</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><code>使用call_once单例</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><br><span class="hljs-comment">// callonce单例</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">singleton</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-comment">// 静态私有指针</span><br>    <span class="hljs-type">static</span> singleton* instance;<br>    <span class="hljs-type">static</span> std::once_flag flag_;<br><br>    <span class="hljs-comment">// 私有构造函数</span><br>    <span class="hljs-built_in">singleton</span>()&#123;&#125;<br><br>    <span class="hljs-comment">// 禁用拷贝构造函数和赋值运算符</span><br>    <span class="hljs-built_in">singleton</span>(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br>    singleton&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 公共静态方法，提供访问点(获取实例)</span><br>    <span class="hljs-function"><span class="hljs-type">static</span> singleton* <span class="hljs-title">getinstance</span><span class="hljs-params">()</span></span>&#123;<br>        std::<span class="hljs-built_in">call_once</span>(flag_,[]()&#123;<br>            instance=<span class="hljs-keyword">new</span> <span class="hljs-built_in">singleton</span>();<br>        &#125;);<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br><br>    <span class="hljs-comment">// 测试函数</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">showmess</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;hello!&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 静态成员初始化</span><br>singleton* singleton::instance=<span class="hljs-literal">nullptr</span>;<br>std::once_flag singleton::flag_;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    singleton* s=singleton::<span class="hljs-built_in">getinstance</span>();<br>    s-&gt;<span class="hljs-built_in">showmess</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<p>​	</p>
<p>​	</p>
<h3 id="局部静态变量单例-推荐"><a href="#局部静态变量单例-推荐" class="headerlink" title="局部静态变量单例(推荐)"></a>局部静态变量单例(推荐)</h3><p><code>局部静态变量单例</code>：<strong>利用C++11的线程安全静态变量初始化，实现懒加载且线程安全(推荐使用)</strong></p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>线程安全</strong></li>
<li>延迟加载，<strong>节省资源</strong></li>
<li><strong>无锁，性能强</strong></li>
<li><strong>自动管理内存，无需手动释放</strong></li>
<li><strong>简洁且易于实现</strong></li>
</ul>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>C++版本要&gt;&#x3D;11</li>
</ul>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// 局部静态变量单例</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">singleton</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-comment">// 私有构造函数</span><br>    <span class="hljs-built_in">singleton</span>()&#123;&#125;<br><br>    <span class="hljs-comment">// 禁用拷贝构造函数和赋值运算符删除</span><br>    <span class="hljs-built_in">singleton</span>(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br>    singleton&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> singleton&amp;)=<span class="hljs-keyword">delete</span>;<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 公共静态方法，提供访问点</span><br>    <span class="hljs-function"><span class="hljs-type">static</span> singleton&amp; <span class="hljs-title">getinstance</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-type">static</span> singleton instance;  <span class="hljs-comment">// 局部静态变量，线程安全</span><br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br><br>    <span class="hljs-comment">// 测试函数</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">showmess</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;hello!&quot;</span>&lt;&lt;std::endl;<br>    &#125;<br><br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    singleton&amp; s=singleton::<span class="hljs-built_in">getinstance</span>();<br>    s.<span class="hljs-built_in">showmess</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>适配器模式(Adapter pattern)</code>是一种结构型设计模式，它<strong>允许不兼容的接口之间进行协作</strong>。通过引入一个适配器类，适配器模式<strong>将一个类的接口转换成客户端所期望的另一个接口，从而使得原本由于接口不兼容而无法一起工作的类可以协同工作</strong></li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：开发一款股票市场监测程序，会从不同来源下载XML格式的股票数据，然后向用户呈现出分析图表。但是，分析函数库只兼容JSON格式的数据</p>
<p><strong>解决方案</strong>：将一个类的接口转换为客户希望的另一个接口，使得原本不兼容的一些类可以一起工作。即创建一个适配器，这是一个特殊的对象，能够转换对象接口</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>解决问题</strong>：</p>
<ul>
<li><strong>接口不兼容</strong>：在多个类或系统之间进行集成时，可能会遇到接口不兼容的问题。适配器模式提供了一种解决方案，使得这些不兼容的接口可以无缝地工作在一起。</li>
<li><strong>代码重用</strong>：通过使用适配器模式，现有的类可以被复用而不需要修改。这样可以避免对已有代码的改动，从而降低维护成本和风险。</li>
<li><strong>灵活性和可扩展性</strong>：适配器模式允许在不修改客户端代码的情况下，添加新的适配者或更改适配的实现。这样使得系统更加灵活和易于扩展。</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li><p><strong>目标接口（Target）</strong>：客户端所期待的接口。</p>
</li>
<li><p><strong>适配者（Adapter）</strong>：将适配者的接口转换成目标接口。</p>
</li>
<li><p><strong>被适配类（Adaptee）</strong>：需要被适配的类，其接口与目标接口不兼容。</p>
</li>
<li><p><strong>客户端（Client）</strong>：使用目标接口的类。</p>
</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>单一职责原则</strong>：可以将接口或数据转换代码从程序主要业务逻辑中分离</li>
<li><strong>开闭原则</strong>：只要客户端代码通过客户端接口与适配器进行交互，就能在不修改现有客户端代码的情况下运行新类型接口，只需要增加新类型的适配器即可</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>代码复杂</strong>：代码整体复杂度增加，因为需要新增一系列接口和类，有时直接更改服务类使其与其他代码兼容会更简单</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-comment">// target接口，客户端要使用的服务</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">jsoninfo</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">jsoninfo</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">request</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;some json information...&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// adaptee类:客户端不兼容的接口，需要转换为target接口</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">xmlinfo</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">std::string <span class="hljs-title">xmlrequest</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;some xml information...&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// adapter：适配器，将adaptee包装，使其看起来是target接口</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">adapter</span>:<span class="hljs-keyword">public</span> jsoninfo&#123;<br><span class="hljs-keyword">private</span>:<br>    xmlinfo* m_adptee;    <span class="hljs-comment">//对象进行解决问题</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">adapter</span>(xmlinfo* adaptee):<span class="hljs-built_in">m_adptee</span>(adaptee)&#123;&#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">request</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::string str=m_adptee-&gt;<span class="hljs-built_in">xmlrequest</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;xml转换json适配结果:&quot;</span>+str;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">client</span><span class="hljs-params">(<span class="hljs-type">const</span> jsoninfo* info)</span></span>&#123;<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;股票分析软件运行json：&quot;</span>&lt;&lt;info-&gt;<span class="hljs-built_in">request</span>()&lt;&lt;std::endl;<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;--------------------------&quot;</span>&lt;&lt;std::endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    jsoninfo jsinfo;<br>    <span class="hljs-built_in">client</span>(&amp;jsinfo);<br>    xmlinfo xlinfo; <span class="hljs-comment">//无法直接用于client函数中</span><br>    <span class="hljs-comment">// 使用适配器</span><br>    <span class="hljs-function">adapter <span class="hljs-title">jsonadapter</span><span class="hljs-params">(&amp;xlinfo)</span></span>;<br>    <span class="hljs-built_in">client</span>(&amp;jsonadapter);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>桥接模式(Bridge pattern)</code>：是一种对象结构型设计模式，旨在<strong>将抽象部分与其实现部分分离，使它们可以独立地变化</strong>。通过这种方式，桥接模式允许在不影响其他部分的情况下，扩展或修改系统的抽象和实现部分，从而提高系统的灵活性和可维护性</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：假设你正在开发一个远程控制系统，用于控制不同品牌的电器（如电视、音响等）。不同品牌的电器有不同的操作接口和实现方式，而远程控制器需要能够控制这些电器而无需了解具体的实现细节</p>
<p><strong>解决方案</strong>：桥接模式可以将远程控制器（抽象部分）与电器的具体实现（实现部分）分离，使得远程控制器可以独立于电器品牌进行扩展。即<strong>使用组合的方式来替代继承</strong>，将一个类层次转化为多个相关的类层次，避免单个类层次的失控。在抽象和实现间架起一座桥梁</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**抽象部分(Abstraction)**：提供高层控制逻辑，依赖于完成底层实际工作的实现对象</li>
<li>**实现部分(Implementation)**：为所有具体实现声明通用接口</li>
<li>**具体实现(Concrete Implementations)**：特定于平台的实现代码</li>
<li>**扩展抽象(Refined Abstraction)**：提供控制逻辑的变体</li>
<li><strong>客户端</strong>：仅关心如何与抽象部分合作。但是，<strong>客户端需要将抽象对象与一个实现对象连接起来</strong></li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>分离抽象与实现</strong>：使两者可以独立变化，增强系统的灵活性。</li>
<li><strong>减少类的数量</strong>：避免了因多维度变化导致的类爆炸问题。</li>
<li><strong>提高可扩展性</strong>：易于在抽象和实现层面进行扩展。</li>
<li><strong>单一职责原则</strong>：抽象部分专注于处理高层逻辑，实现部分处理平台细节</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>对高内聚的类使用该模式可能会让代码更加复杂</li>
</ul>
<blockquote>
<p>高内聚：模块中的依赖关系很强</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// 实现部分</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">device</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">device</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">turnon</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">turnoff</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体实现</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">sonydevice</span>:<span class="hljs-keyword">public</span> device&#123;<br><span class="hljs-keyword">public</span>:<br>    ~<span class="hljs-built_in">sonydevice</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">turnon</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;sonydevice:开机...\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">turnoff</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;sonydevice:关机...\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;sonydevice:静音...\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">samsungdevice</span>:<span class="hljs-keyword">public</span> device&#123;<br><span class="hljs-keyword">public</span>:<br>    ~<span class="hljs-built_in">samsungdevice</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">turnon</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;samsungdevice:开机...\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">turnoff</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;samsungdevice:关机...\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;samsungdevice:静音...\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 抽象部分</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">remotecontroller</span>&#123;<br><span class="hljs-keyword">protected</span>:<br>    device* m_impl;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">remotecontroller</span>(device* dev):<span class="hljs-built_in">m_impl</span>(dev)&#123;&#125;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">remotecontroller</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">sendturnon</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;基础遥控器发出turnon命令:\n&quot;</span>;<br>        m_impl-&gt;<span class="hljs-built_in">turnon</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">sendturnoff</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;基础遥控器发出turnoff命令:\n&quot;</span>;<br>        m_impl-&gt;<span class="hljs-built_in">turnoff</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 扩展抽象</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">advanceremote</span>: <span class="hljs-keyword">public</span> remotecontroller&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">advanceremote</span>(device* dev):<span class="hljs-built_in">remotecontroller</span>(dev)&#123;&#125;<br>    ~<span class="hljs-built_in">advanceremote</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendturnon</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;高级遥控器发出turnon命令:\n&quot;</span>;<br>        m_impl-&gt;<span class="hljs-built_in">turnon</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendturnoff</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;高级遥控器发出turnoff命令:\n&quot;</span>;<br>        m_impl-&gt;<span class="hljs-built_in">turnoff</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendmute</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;高级遥控器发出mute命令:\n&quot;</span>;<br>        m_impl-&gt;<span class="hljs-built_in">mute</span>();<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    sonydevice sydev;<br>    <span class="hljs-function">remotecontroller <span class="hljs-title">brc</span><span class="hljs-params">(&amp;sydev)</span></span>;<br>    brc.<span class="hljs-built_in">sendturnon</span>();<br>    brc.<span class="hljs-built_in">sendturnoff</span>();<br><br>    samsungdevice ssdev;<br>    <span class="hljs-function">advanceremote <span class="hljs-title">arc</span><span class="hljs-params">(&amp;ssdev)</span></span>;<br>    arc.<span class="hljs-built_in">sendturnon</span>();<br>    arc.<span class="hljs-built_in">sendmute</span>();<br>    arc.<span class="hljs-built_in">sendturnoff</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>组合模式(Composite pattern)</code>：是一种对象结构型设计模式，旨在<strong>将对象组合成树形结构以表示“部分-整体”的层次结构</strong>。组合模式使得用户能够以统一的方式对待单个对象（叶子节点）和对象组合（组合节点），从而简化客户端代码的复杂性</li>
<li><code>透明式组合模式</code>：<strong>会将叶节点和组合节点各自特有的接口也一起声明在组件接口中</strong>，但是默认实现是抛出错误，这样防止非叶节点&#x2F;组合节点调用该方法</li>
<li><code>安全式模式</code>：<strong>组件接口中只包含叶节点和组合节点所共有的接口方法</strong></li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：在文件系统中，用户既可以对单个文件执行操作，也可以对整个文件夹及其包含的文件执行操作。如果不使用组合模式，客户端代码需要分别处理单个对象和组合对象，导致代码复杂且难以维护</p>
<p><strong>解决方案</strong>：将对象组成树形结构以表示”部分-整体”的层次结构。使得用户对单个对象和组合对象的使用具有一致性</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**组件(Component)**：定义对象的接口，声明叶节点和组合节点所共有的操作</li>
<li>**叶节点(Leaf)**：代表组合结构中的叶子对象，不能有子节点</li>
<li>**组合节点(Composite)**：代表组合对象，内部可包含子节点</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li>需要体现部分与整体的树状层次结构时，可以使用组合模式。</li>
<li>希望客户端忽略组合对象与单个对象的不同，用户将统一地使用组合结构中的所有对象。</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>一致处理：</strong> 客户端可以一致地对待单个对象和对象组合，减少了条件判断和复杂的处理逻辑。</li>
<li>可以利用多态和递归机制更方便地使用复杂树结构</li>
<li><strong>开闭原则</strong>：在组合体内加入新的对象，客户端不会更改源代码，可以一致地处理单个对象和组合对象。</li>
</ul>
<p>	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>设计上的复杂性：</strong> 对于简单的层次结构，使用组合模式可能会增加不必要的类和接口，导致系统设计复杂。</li>
<li><strong>不适合所有场景：</strong> 当对象层次结构不适合树形结构时，组合模式可能不适用。</li>
<li>对于功能差异较大的类，提供公共接口或许会有困难，在特定情况下，需要过度一般化组件接口，使其变得令人难以理解</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 安全式组合模式</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;list&gt;</span></span><br><br><span class="hljs-comment">// 组件接口 Component</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">filesystemcomponent</span>&#123;<br><span class="hljs-keyword">protected</span>:<br>    std::string m_name;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">filesystemcomponent</span>(<span class="hljs-type">const</span> std::string&amp; str):<span class="hljs-built_in">m_name</span>(str)&#123;&#125;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">filesystemcomponent</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">(<span class="hljs-type">int</span> idx=<span class="hljs-number">0</span>)</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;    <span class="hljs-comment">//叶节点和组合节点共有方法</span><br>    <span class="hljs-comment">// 以下是组合节点有的方法，透明式的组合模式会将这个方法一起定义在组件接口中</span><br>    <span class="hljs-comment">// 但是当非组合节点调用该接口就应该返回报错，同理，叶节点独有的接口也是这样</span><br>    <span class="hljs-comment">/* virtual void add(filesystemcomponent* component)&#123;</span><br><span class="hljs-comment">        throw std::runtime_error(&quot;Cannot add component&quot;);</span><br><span class="hljs-comment">    &#125;;</span><br><span class="hljs-comment">    virtual void remove(filesystemcomponent* component)&#123;</span><br><span class="hljs-comment">        throw std::runtime_error(&quot;Cannot remove component&quot;);</span><br><span class="hljs-comment">    &#125;; */</span><br>&#125;;<br><br><span class="hljs-comment">// 叶节点: file 文件类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">file</span>:<span class="hljs-keyword">public</span> filesystemcomponent&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">file</span>(<span class="hljs-type">const</span> std::string &amp;str):<span class="hljs-built_in">filesystemcomponent</span>(str)&#123;&#125;<br>    ~<span class="hljs-built_in">file</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">(<span class="hljs-type">int</span> idx=<span class="hljs-number">0</span>)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; idx; ++i) std::cout &lt;&lt; <span class="hljs-string">&quot;  &quot;</span>;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;- File: &quot;</span> &lt;&lt; m_name &lt;&lt; std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 组合节点：directory 文件夹类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">directory</span>:<span class="hljs-keyword">public</span> filesystemcomponent&#123;<br><span class="hljs-keyword">private</span>:<br>    std::list&lt;filesystemcomponent*&gt; children;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">directory</span>(<span class="hljs-type">const</span> std::string &amp;str):<span class="hljs-built_in">filesystemcomponent</span>(str)&#123;&#125;<br>    ~<span class="hljs-built_in">directory</span>()&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> child : children) &#123;<br>            <span class="hljs-keyword">delete</span> child;<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">(<span class="hljs-type">int</span> idx = <span class="hljs-number">0</span>)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; idx; ++i) std::cout &lt;&lt; <span class="hljs-string">&quot;  &quot;</span>;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;+ Directory: &quot;</span> &lt;&lt; m_name &lt;&lt; std::endl;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> child : children) &#123;<br>            child-&gt;<span class="hljs-built_in">display</span>(idx + <span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// 安全式组合模式，将特有方法定义在自己类中</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(filesystemcomponent* component)</span></span>&#123;<br>        children.<span class="hljs-built_in">emplace_back</span>(component);<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(filesystemcomponent* component)</span></span>&#123;<br>        children.<span class="hljs-built_in">remove</span>(component);<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    directory* root=<span class="hljs-keyword">new</span> <span class="hljs-built_in">directory</span>(<span class="hljs-string">&quot;root&quot;</span>);<br>    file* f1=<span class="hljs-keyword">new</span> <span class="hljs-built_in">file</span>(<span class="hljs-string">&quot;f1.txt&quot;</span>);<br>    file* f2=<span class="hljs-keyword">new</span> <span class="hljs-built_in">file</span>(<span class="hljs-string">&quot;f2.txt&quot;</span>);<br>    directory* subdir=<span class="hljs-keyword">new</span> <span class="hljs-built_in">directory</span>(<span class="hljs-string">&quot;subdir&quot;</span>);<br>    file* f3=<span class="hljs-keyword">new</span> <span class="hljs-built_in">file</span>(<span class="hljs-string">&quot;f3.txt&quot;</span>);<br>    root-&gt;<span class="hljs-built_in">add</span>(f1);<br>    root-&gt;<span class="hljs-built_in">add</span>(subdir);<br>    subdir-&gt;<span class="hljs-built_in">add</span>(f2);<br>    subdir-&gt;<span class="hljs-built_in">add</span>(f3);<br>    f1-&gt;<span class="hljs-built_in">display</span>();<br>    root-&gt;<span class="hljs-built_in">display</span>();<br>    <span class="hljs-keyword">delete</span> root;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="装饰模式"><a href="#装饰模式" class="headerlink" title="装饰模式"></a>装饰模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>装饰模式(Decorator pattern)</code>：是一种对象结构型设计模式，<strong>允许在不修改现有对象结构的情况下，动态地为对象添加新的功能</strong>。</li>
<li><code>做法</code>：通过<strong>创建一个装饰类包装原有的类，并在保持原有类接口的前提下，提供额外的功能</strong>，装饰模式实现了对对象功能的灵活扩展</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：饮料店订单系统，饮料有多种，并且可以选择加牛奶、冰淇淋、巧克力等配料</p>
<p><strong>解决方案</strong>：动态地给一个对象添加一些额外的职责。就增加功能来说，装饰模式相对于生成子类更为灵活。<strong>找出基本组件和可选层次</strong></p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**组件(Component)**：声明封装器和被封装对象的公用接口</li>
<li>**具体组件(Concrete Component)**：是被封装对象所属的类。它定义了基础行为，但装饰类可以改变这些行为</li>
<li><strong>基础装饰类(Base Decorator)<strong>：拥有指向被封装对象的引用成员变量。</strong>装饰基类会将所有操作委派给被封装的对象</strong></li>
<li>**具体装饰类(Concrete Decorators)**：定义了可动态添加到组件的额外行为。具体装饰类会重写装饰基类的方法，并在调用父类方法之前或之后进行额外的行为</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>解决的问题</strong>：</p>
<ul>
<li><p><strong>避免类爆炸</strong>：使用继承来扩展类功能时，每增加一个新功能，都需要创建一个新的子类，导致类的数量迅速增长（类爆炸问题）。</p>
</li>
<li><p><strong>动态功能添加</strong>：有时需要在运行时动态地为对象添加或撤销功能，继承机制无法满足这一需求，因为继承是在编译时确定的。</p>
</li>
<li><p><strong>保持单一职责</strong>：将不同功能分散到不同的装饰类中，可以保持每个类的职责单一，提升代码的可维护性和可扩展性。</p>
</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><p><strong>灵活性高</strong>：可以在运行时动态地组合不同的装饰器，灵活地为对象添加多种功能。</p>
</li>
<li><p><strong>遵循开闭原则</strong>：对扩展开放，对修改关闭。通过添加新的装饰类，不需要修改现有的类。</p>
</li>
<li><p><strong>增强单一职责</strong>：每个装饰器负责添加一种功能，保持类的职责单一。</p>
</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><p><strong>增加系统复杂性</strong>：装饰器的层次结构可能会变得复杂，增加理解和维护的难度。(例如，在封装器栈中删除特定封装器比较困难)</p>
</li>
<li><p>实现行为不受装饰栈顺序影响的装饰比较困难</p>
</li>
<li><p>各层的初始化配置代码看上去可能会很糟糕</p>
</li>
<li><p><strong>高数量的类</strong>：每种功能的装饰器都需要一个类，可能导致类的数量增加。</p>
</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-comment">// 组件类:饮料类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Beverage</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Beverage</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">operation</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体组件类:美式咖啡类(具体的被装饰类)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Americano</span>:<span class="hljs-keyword">public</span> Beverage&#123;<br><span class="hljs-keyword">public</span>:<br>    ~<span class="hljs-built_in">Americano</span>()&#123;&#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">operation</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;美式咖啡&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 装饰基类,基础部分(可能包括额外部分)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Basewrapper</span>:<span class="hljs-keyword">public</span> Beverage&#123;<br><span class="hljs-keyword">protected</span>:<br>    Beverage* m_beverage;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Basewrapper</span>(Beverage* beverage):<span class="hljs-built_in">m_beverage</span>(beverage)&#123;&#125;<br>    ~<span class="hljs-built_in">Basewrapper</span>()&#123;&#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">operation</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> m_beverage-&gt;<span class="hljs-built_in">operation</span>();     <span class="hljs-comment">//核心代码，不是用来被基类覆盖的</span><br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体装饰类:奶昔,额外部分,需要委托基类，完成基础部分</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Whip</span>:<span class="hljs-keyword">public</span> Basewrapper&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Whip</span>(Beverage* beverage):<span class="hljs-built_in">Basewrapper</span>(beverage)&#123;&#125;<br>    ~<span class="hljs-built_in">Whip</span>()&#123;&#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">operation</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;奶昔(&quot;</span>+Basewrapper::<span class="hljs-built_in">operation</span>()+<span class="hljs-string">&quot;)&quot;</span>; <span class="hljs-comment">//在基类的operation之前，之后都可以增加额外的操作</span><br>    &#125;<br>&#125;;<br><br><br><span class="hljs-comment">// 具体装饰类:摩卡,额外部分,需要委托基类，完成基础部分</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Moca</span>:<span class="hljs-keyword">public</span> Basewrapper&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Moca</span>(Beverage* beverage):<span class="hljs-built_in">Basewrapper</span>(beverage)&#123;&#125;<br>    ~<span class="hljs-built_in">Moca</span>()&#123;&#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">operation</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;摩卡(&quot;</span>+Basewrapper::<span class="hljs-built_in">operation</span>()+<span class="hljs-string">&quot;)&quot;</span>; <span class="hljs-comment">//在基类的operation之前，之后都可以增加额外的操作</span><br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">client</span><span class="hljs-params">(Beverage* bev)</span></span>&#123;<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;执行结果：&quot;</span>&lt;&lt;bev-&gt;<span class="hljs-built_in">operation</span>()&lt;&lt;std::endl;<br>&#125;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;来一杯美式咖啡\n&quot;</span>;<br>    Beverage* americano=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Americano</span>();<br><br>    std::cout&lt;&lt;<span class="hljs-string">&quot;来一杯双份摩卡+奶昔的美式咖啡\n&quot;</span>;<br>    Beverage* whip=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Whip</span>(americano);<br>    Beverage* moca1=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Moca</span>(whip);<br>    Beverage* moca2=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Moca</span>(moca1);<br>    <span class="hljs-built_in">client</span>(moca2);<br><br>    <span class="hljs-keyword">delete</span> americano;<br>    <span class="hljs-keyword">delete</span> whip;<br>    <span class="hljs-keyword">delete</span> moca1;<br>    <span class="hljs-keyword">delete</span> moca2;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>外观模式(Facade pattern)</code>：是一种对象结构型设计模式，它<strong>为复杂子系统提供一个统一的接口，从而使得子系统更容易使用</strong>。外观模式通过封装多个类的复杂性，向客户端提供一个简单的接口，减少了客户端与多个子系统之间的交互</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：假设我们有一个家庭影院系统，包括多个子系统（如音响、投影仪、DVD播放器等）。用户希望通过一个简单的接口来控制这些设备</p>
<p><strong>解决方案</strong>：为子系统中的一组接口提供一个一致的界面，外观模式定义了一个高层接口，这个接口使得子系统更加容易使用。<strong>开放用户真正关心的功能</strong></p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>解决的问题</strong>：</p>
<ul>
<li><p><strong>复杂性管理</strong>：客户端需要直接与多个子系统交互，导致代码复杂、难以维护。</p>
</li>
<li><p><strong>依赖性问题</strong>：客户端与多个子系统的紧耦合，增加了系统之间的依赖性，降低了系统的灵活性。</p>
</li>
<li><p><strong>学习曲线</strong>：新开发人员在理解复杂的子系统时，学习曲线较陡，增加了上手难度。</p>
</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li><strong>外观（Facade）</strong>：提供一个简单的接口来访问特定子系统功能的便捷方式，封装了复杂子系统的调用逻辑。</li>
<li>**附加外观(Additional Facade)**：可以避免多种不相关的功能污染单一外观，使其变成又一个复杂结构，客户端和其他外观都可使用附加外观</li>
<li><strong>子系统（Subsystem Classes）</strong>：实现系统的功能，但通常不对外暴露接口。客户端与这些类的交互通过外观进行(但客户端也可以直接操作子系统)。</li>
<li>**客户端(Client)**：使用外观代替对子系统对象的直接调用</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><p><strong>简化接口</strong>：为复杂的子系统提供简单的接口，使得客户端更容易使用。</p>
</li>
<li><p><strong>降低耦合</strong>：客户端与子系统之间的耦合度降低，增加了系统的灵活性和可维护性。</p>
</li>
<li><p><strong>集中管理</strong>：可以集中管理多个子系统，便于修改和扩展</p>
</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><p><strong>不适合所有场景</strong>：在某些情况下，外观模式可能会隐藏一些重要的子系统功能，导致灵活性降低。</p>
</li>
<li><p><strong>可能增加额外的复杂性</strong>：在某些情况下，外观类可能会成为庞大的类(可能成为与程序中所有类都耦合的上帝对象)，增加维护负担</p>
</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><br><span class="hljs-comment">// 子系统1</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">videosystem</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">std::string <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;视频系统：Ready!\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">play</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;视频系统：播放\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">operationx</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;视频系统：不常用的功能\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 子系统2</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">radiosystem</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">std::string <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;音频系统：Ready!\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">play</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;音频系统：播放\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">operationx</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;音频系统：不常用的功能\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">mute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;音频系统：静音!\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 外观</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">controller</span>&#123;<br><span class="hljs-keyword">protected</span>:<br>    videosystem* m_video;<br>    radiosystem* m_radio;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">controller</span>(videosystem* video=<span class="hljs-literal">nullptr</span>,radiosystem* radio=<span class="hljs-literal">nullptr</span>)&#123;<br>        m_video=video?video:<span class="hljs-keyword">new</span> <span class="hljs-built_in">videosystem</span>();<br>        m_radio=radio?radio:<span class="hljs-keyword">new</span> <span class="hljs-built_in">radiosystem</span>();<br>    &#125;<br>    ~<span class="hljs-built_in">controller</span>()&#123;<br>        <span class="hljs-keyword">delete</span> m_video;<br>        <span class="hljs-keyword">delete</span> m_radio;<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">start</span><span class="hljs-params">()</span></span>&#123;<br>        std::string str=<span class="hljs-string">&quot;控制器启动系统:\n&quot;</span>;<br>        str+=m_video-&gt;<span class="hljs-built_in">init</span>();<br>        str+=m_radio-&gt;<span class="hljs-built_in">init</span>();<br>        str+=<span class="hljs-string">&quot;控制器发送播放命令:\n&quot;</span>;<br>        str+=m_video-&gt;<span class="hljs-built_in">play</span>();<br>        str+=m_radio-&gt;<span class="hljs-built_in">play</span>();<br>        <span class="hljs-keyword">return</span> str;<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">mute</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> m_radio-&gt;<span class="hljs-built_in">mute</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    videosystem* video=<span class="hljs-keyword">new</span> <span class="hljs-built_in">videosystem</span>();<br>    radiosystem* radio=<span class="hljs-keyword">new</span> <span class="hljs-built_in">radiosystem</span>();<br>    <span class="hljs-function">controller <span class="hljs-title">ctler</span><span class="hljs-params">(video,radio)</span></span>;  <span class="hljs-comment">//外观对象，负责回收子系统</span><br>    std::cout&lt;&lt;ctler.<span class="hljs-built_in">start</span>();<br>    std::cout&lt;&lt;ctler.<span class="hljs-built_in">mute</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>享元模式(Flyweight pattern)</code>：是一种对象结构型设计模式，旨在<strong>通过共享对象来减少内存使用和提高性能，特别是在需要大量相似对象的情况下</strong>。享元模式通过将对象的状态分为可共享的内部状态和不可共享的外部状态，来实现对象的高效复用。</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：做一个车管所系统，将会产生大量的车辆实体，如果每一个实例都保存自己的所有信息，将会需要大量内存，甚至导致程序崩溃</p>
<p><strong>解决方案</strong>：运用共享技术有效的支持大量细粒度的对象，<strong>共享部分单独抽出来，特有部分保留给个体</strong></p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>解决的问题</strong>：</p>
<ul>
<li><p><strong>内存消耗</strong>：大量相似对象的创建会导致显著的内存开销。通过共享相同的对象，享元模式减少了内存使用。</p>
</li>
<li><p><strong>性能问题</strong>：频繁地创建和销毁对象会增加系统的负担，影响性能。享元模式通过复用对象，降低了对象创建的开销。</p>
</li>
<li><p><strong>管理复杂性</strong>：当对象数量庞大时，管理这些对象会变得复杂。享元模式提供了统一的管理机制，使得对象的创建和共享更加高效。</p>
</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li><p><strong>享元（Flyweight）</strong>：定义了可以共享的接口，通常用于实现可共享对象的公共部分。</p>
</li>
<li><p><strong>具体享元（Concrete Flyweight）</strong>：实现享元接口的具体类，包含共享的状态。</p>
</li>
<li><p><strong>外部状态（Extrinsic State）</strong>：享元对象不存储的状态，由客户端管理并传递给享元对象。外部状态可以是与上下文相关的数据</p>
</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><p><strong>减少内存消耗</strong>：通过共享相似对象，显著降低了内存使用。</p>
</li>
<li><p><strong>提高性能</strong>：减少对象的创建和销毁次数，提升了性能。</p>
</li>
<li><p><strong>灵活性</strong>：外部状态的引入使得享元对象更加灵活，可以根据需要调整。</p>
</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>增加复杂性</strong>：引入外部状态和共享机制，可能增加系统的复杂性。</li>
<li><strong>管理难度</strong>：需要有效管理共享对象的生命周期，确保其正确性。</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unordered_map&gt;</span></span><br><br><span class="hljs-comment">// 内部状态</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">shared_state</span> &#123;<br>    std::string brand;  <span class="hljs-comment">// 品牌</span><br>    std::string model;  <span class="hljs-comment">// 型号</span><br>&#125;;<br><br><span class="hljs-comment">// 外部状态</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">unique_state</span> &#123;<br>    std::string owner;  <span class="hljs-comment">// 所有人</span><br>    std::string num;    <span class="hljs-comment">// 车牌号</span><br>&#125;;<br><br><span class="hljs-comment">// 享元类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> &#123;<br><span class="hljs-keyword">private</span>:<br>    shared_state m_shared;  <span class="hljs-comment">// 共享的内部状态</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Vehicle</span>():<span class="hljs-built_in">m_shared</span>(&#123;<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>&#125;)&#123;&#125;<br>    <span class="hljs-built_in">Vehicle</span>(<span class="hljs-type">const</span> std::string&amp; b, <span class="hljs-type">const</span> std::string&amp; m) : <span class="hljs-built_in">m_shared</span>(&#123;b, m&#125;) &#123;&#125;<br><br>    <span class="hljs-comment">// 拷贝构造函数</span><br>    <span class="hljs-built_in">Vehicle</span>(<span class="hljs-type">const</span> Vehicle&amp; other) : <span class="hljs-built_in">m_shared</span>(other.m_shared) &#123;&#125;<br><br>    <span class="hljs-comment">// 展示内部状态的信息</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Brand: &quot;</span> &lt;&lt; m_shared.brand &lt;&lt; <span class="hljs-string">&quot;, Model: &quot;</span> &lt;&lt; m_shared.model &lt;&lt; std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 享元工厂</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">VehicleFactory</span> &#123;<br><span class="hljs-keyword">private</span>:<br>    std::unordered_map&lt;std::string, Vehicle&gt; vehicles; <span class="hljs-comment">// 存储享元对象</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">Vehicle&amp; <span class="hljs-title">getVehicle</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; brand, <span class="hljs-type">const</span> std::string&amp; model)</span> </span>&#123;<br>        std::string key = brand + <span class="hljs-string">&quot;_&quot;</span> + model;<br>        <span class="hljs-comment">// 如果车辆对象存在，则返回它，否则创建新的对象</span><br>        <span class="hljs-keyword">if</span> (vehicles.<span class="hljs-built_in">find</span>(key) == vehicles.<span class="hljs-built_in">end</span>()) &#123;<br>            vehicles[key] = <span class="hljs-built_in">Vehicle</span>(brand, model);<br>        &#125;<br>        <span class="hljs-keyword">return</span> vehicles[key];<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 车辆类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IndividualVehicle</span> &#123;<br><span class="hljs-keyword">private</span>:<br>    Vehicle vehicle;           <span class="hljs-comment">// 共享的享元对象</span><br>    unique_state m_unique;     <span class="hljs-comment">// 特有的外部状态</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">IndividualVehicle</span>(<span class="hljs-type">const</span> Vehicle&amp; v, <span class="hljs-type">const</span> std::string&amp; o, <span class="hljs-type">const</span> std::string&amp; n)<br>        : <span class="hljs-built_in">vehicle</span>(v), <span class="hljs-built_in">m_unique</span>(&#123;o, n&#125;) &#123;&#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>        vehicle.<span class="hljs-built_in">display</span>(); <span class="hljs-comment">// 显示共享部分</span><br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Owner: &quot;</span> &lt;&lt; m_unique.owner &lt;&lt; <span class="hljs-string">&quot;, num: &quot;</span> &lt;&lt; m_unique.num &lt;&lt; std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    VehicleFactory factory;<br><br>    <span class="hljs-comment">// 创建多个车辆实例</span><br>    <span class="hljs-function">IndividualVehicle <span class="hljs-title">car1</span><span class="hljs-params">(factory.getVehicle(<span class="hljs-string">&quot;Toyota&quot;</span>, <span class="hljs-string">&quot;Camry&quot;</span>), <span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;ABC123&quot;</span>)</span></span>;<br>    <span class="hljs-function">IndividualVehicle <span class="hljs-title">car2</span><span class="hljs-params">(factory.getVehicle(<span class="hljs-string">&quot;Toyota&quot;</span>, <span class="hljs-string">&quot;Camry&quot;</span>), <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;XYZ789&quot;</span>)</span></span>;<br>    <span class="hljs-function">IndividualVehicle <span class="hljs-title">car3</span><span class="hljs-params">(factory.getVehicle(<span class="hljs-string">&quot;Honda&quot;</span>, <span class="hljs-string">&quot;Civic&quot;</span>), <span class="hljs-string">&quot;Charlie&quot;</span>, <span class="hljs-string">&quot;LMN456&quot;</span>)</span></span>;<br><br>    <span class="hljs-comment">// 显示车辆信息</span><br>    car1.<span class="hljs-built_in">display</span>();<br>    car2.<span class="hljs-built_in">display</span>();<br>    car3.<span class="hljs-built_in">display</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>代理模式(Proxy pattern)</code>：是一种对象结构型设计模式，它为其他对象提供一种代理以控制对这个对象的访问。通过代理模式，<strong>客户端可以通过代理对象间接地访问目标对象，而不需要直接与目标对象交互</strong>。</li>
<li><strong>场景</strong>：这种模式在需要<strong>对目标对象的访问进行控制、延迟加载、记录日志、权限检查等场景</strong>下非常有用</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：系统需要访问数据库，但需要对数据的访问做一些优化，例如缓存查询结果、生成访问日志、访问控制。</p>
<p><strong>解决方案</strong>：为其他对象提供一种代理以控制这个对象的访问。即新建一个与原服务器对象接口相同的代理类，代理将自己伪装成数据库对象，对用户而言是透明的</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**服务接口(Service Interface)**：声明服务接口。代理须遵循该接口进行伪装。</li>
<li>**服务类(Service)**：提供了一些使用的业务逻辑</li>
<li>**代理类(Proxy)**：包含一个指向服务对象的引用成员变量，代理完成其任务(如延迟初始化、记录日志、访问控制和缓存等)后会将请求传递给服务对象</li>
<li>**客户端(Client)**：能通过同一接口与服务或代理进行交互，可在一切需要服务对象的代码中使用代理</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>透明性</strong>：可以在客户端毫无察觉的情况下控制服务对象</li>
<li>如果客户端对服务对象的生命周期没有特殊要求，可以对生命周期进行管理</li>
<li>即使服务对象还未准备好或不存在，代理也可以正常工作</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>增加系统复杂性</strong>：引入代理对象会增加系统的类的数量和复杂性，可能导致系统结构过于庞大</li>
<li><strong>性能影响</strong>：由于代理对象需要转发请求，并可能执行额外的操作，服务响应可能会延迟</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// 服务接口：真实的数据库和代理数据都依赖这个接口</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Database</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">request</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 服务类：真实数据库</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RealDatabase</span>:<span class="hljs-keyword">public</span> Database&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">request</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;真实数据库: 处理业务请求.\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 代理类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyDatabase</span>:<span class="hljs-keyword">public</span> Database&#123;<br><span class="hljs-keyword">private</span>:<br>    RealDatabase* m_rdb;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">check_access</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;代理数据库: 在发出请求之前，检查以下.\n&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">log</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;代理数据库: 处理日志.\n&quot;</span>;<br>    &#125;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">ProxyDatabase</span>(RealDatabase* rdb):<span class="hljs-built_in">m_rdb</span>(rdb)&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">request</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">check_access</span>())&#123;<br>            std::cout&lt;&lt;<span class="hljs-string">&quot;代理数据库: 数据库访问请求被驳回.\n&quot;</span>;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;代理数据库: 通过代理处理数据库请求.\n&quot;</span>;<br>        m_rdb-&gt;<span class="hljs-built_in">request</span>();<br>        <span class="hljs-built_in">log</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">client</span><span class="hljs-params">(<span class="hljs-type">const</span> Database&amp; database)</span></span>&#123;<br>    database.<span class="hljs-built_in">request</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    <span class="hljs-comment">// 无代理</span><br>    RealDatabase rdb;<br>    <span class="hljs-built_in">client</span>(rdb);<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;----------------&quot;</span>&lt;&lt;std::endl;<br>    <span class="hljs-comment">// 使用代理</span><br>    <span class="hljs-function">ProxyDatabase <span class="hljs-title">pdb</span><span class="hljs-params">(&amp;rdb)</span></span>;<br>    <span class="hljs-built_in">client</span>(pdb);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>责任链模式(Chain of Responsibility pattern)</code>：是一种对象行为型设计模式，旨在<strong>通过创建一条处理请求的链，使多个对象都有机会处理该请求，从而避免请求的发送者与接收者之间的耦合关系</strong>。请求在链上传递，直到有一个对象处理它为止。</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：开发一款故障保修系统，不同的业务员处理的故障不同，如何确保客户的维修请求得到妥善的处理(比方说打维修电话，客服开始可能并非人工而是ai,如果处理不了，就转人工，人工还处理不了交给更高的人处理)</p>
<p><strong>解决方案</strong>：使多个对象都有机会处理请求，从而避免请求的发送者和接受者之间的耦合关系。将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**处理者(Handler)**：声明了所有具体处理者的通用接口</li>
<li>**基础处理者(Base Handler)**：是一个可选的类，你可以将所有处理者共用的样本代码放置在其中，可以与处理者合并成抽象处理者类</li>
<li>**具体处理者(Concrete Handlers)**：包含处理请求的实际代码。每个处理者接收到请求后，都必须决定是否进行处理，以及是否沿着链传递请求</li>
<li>**客户端(Client)**：可根据程序逻辑一次性或者动态地生成链请求可发送给链上的任意一个处理者</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>灵活性</strong>：可以控制请求处理的顺序</li>
<li><strong>单一职责原则</strong>：你可对发起操作和执行操作的类进行解耦</li>
<li><strong>开闭原则</strong>：可以在不更改现有代码的情况下在程序中新增处理者</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>部分请求可能未被处理</li>
<li><strong>性能问题</strong>：如果责任链过长，可能会影响系统性能，因为请求需要经过多个处理者的检查。</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;list&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-comment">// 抽象处理者类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Handler</span> &#123;<br><span class="hljs-keyword">private</span>:<br>    Handler* m_next;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Handler</span>() : <span class="hljs-built_in">m_next</span>(<span class="hljs-literal">nullptr</span>) &#123;&#125;  <span class="hljs-comment">// 初始化 m_next 为 nullptr</span><br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Handler</span>() &#123;&#125;           <span class="hljs-comment">// 虚析构函数</span><br><br>    <span class="hljs-comment">// 设置下一个处理者</span><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> Handler* <span class="hljs-title">setnext</span><span class="hljs-params">(Handler* handler)</span> </span>&#123;<br>        m_next = handler;<br>        <span class="hljs-keyword">return</span> m_next;<br>    &#125;<br><br>    <span class="hljs-comment">// 处理请求的接口</span><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">handle</span><span class="hljs-params">(std::string request)</span> </span>&#123;<br>        <span class="hljs-comment">// 如果还有下一个，就传递给下一个对象</span><br>        <span class="hljs-keyword">if</span> (m_next) &#123;<br>            <span class="hljs-keyword">return</span> m_next-&gt;<span class="hljs-built_in">handle</span>(request);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体处理者，AI客服</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AIHandler</span> : <span class="hljs-keyword">public</span> Handler &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 重写 handle，将自己能处理的问题进行解决</span><br>    <span class="hljs-function">std::string <span class="hljs-title">handle</span><span class="hljs-params">(std::string request)</span> <span class="hljs-keyword">override</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (request == <span class="hljs-string">&quot;使用向导&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;AI客服: 我来处理-&quot;</span> + request + <span class="hljs-string">&quot;\n&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> Handler::<span class="hljs-built_in">handle</span>(request);<br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体处理者，人工客服</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HumanHandler</span> : <span class="hljs-keyword">public</span> Handler &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 重写 handle，将自己能处理的问题进行解决</span><br>    <span class="hljs-function">std::string <span class="hljs-title">handle</span><span class="hljs-params">(std::string request)</span> <span class="hljs-keyword">override</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (request == <span class="hljs-string">&quot;常见问题&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;人工客服: 我来处理-&quot;</span> + request + <span class="hljs-string">&quot;\n&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> Handler::<span class="hljs-built_in">handle</span>(request);<br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体处理者，专家</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ExpertHandler</span> : <span class="hljs-keyword">public</span> Handler &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 重写 handle，将自己能处理的问题进行解决</span><br>    <span class="hljs-function">std::string <span class="hljs-title">handle</span><span class="hljs-params">(std::string request)</span> <span class="hljs-keyword">override</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (request == <span class="hljs-string">&quot;疑难杂症&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;专家: 我来处理-&quot;</span> + request + <span class="hljs-string">&quot;\n&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> Handler::<span class="hljs-built_in">handle</span>(request);<br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">client</span><span class="hljs-params">(Handler&amp; handler)</span> </span>&#123;<br>    <span class="hljs-comment">// 模拟问题</span><br>    std::list&lt;std::string&gt; problems = &#123; <span class="hljs-string">&quot;使用向导&quot;</span>, <span class="hljs-string">&quot;疑难杂症&quot;</span>, <span class="hljs-string">&quot;常见问题&quot;</span>, <span class="hljs-string">&quot;无法解决问题&quot;</span> &#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; problem : problems) &#123;<br>        std::string res = handler.<span class="hljs-built_in">handle</span>(problem);<br>        <span class="hljs-keyword">if</span> (res.<span class="hljs-built_in">empty</span>()) &#123;<br>            std::cout &lt;&lt; <span class="hljs-string">&quot;处理结果: 无人能够处理该问题\n&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            std::cout &lt;&lt; <span class="hljs-string">&quot;处理结果: &quot;</span> &lt;&lt; res;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span> </span>&#123;<br>    AIHandler ai;<br>    HumanHandler human;<br>    ExpertHandler expert;<br><br>    <span class="hljs-comment">// 创建责任链</span><br>    ai.<span class="hljs-built_in">setnext</span>(&amp;human)-&gt;<span class="hljs-built_in">setnext</span>(&amp;expert);<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Chain: AI客服-&gt;人工客服-&gt;专家\n&quot;</span>;<br>    <span class="hljs-built_in">client</span>(ai);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>命令模式(Command pattern)</code>：是一种对象行为型设计模式，<strong>旨在将请求（操作）封装为对象，从而使你可以使用不同的请求、队列或日志来参数化其他对象，并支持可撤销的操作</strong>。</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：模拟小餐馆点餐，客户提交订单给服务员，服务员将需求提交给大厨，由大厨完成食物的准备工作</p>
<p><strong>解决方案</strong>：将一个请求封装为一个对象，从而可用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可撤销的操作</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**发送者&#x2F;调用者(Invoker)**：负责对请求进行初始化，包含命令对象的引用。负责调用命令对象执行请求</li>
<li>**命令(Command)**：定义命令的接口，通常包括执行操作的方法</li>
<li>**具体命令(Concrete Command)**：实现各种类型的请求(实现命令接口)。自身并不完成工作，而是委派给业务逻辑对象(调用接收者相应的操作来实现命令功能)</li>
<li>**接收者(Receiver)**：包含部分业务逻辑。知道如何执行与请求相关的操作，绝大部分命令只处理如果将请求传递到接收者，接收者会完成实际的工作</li>
<li>**客户端(Client)**：会创建并配置具体命令对象</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>单一职责原则</strong>：可以解耦触发和执行操作的类</li>
<li><strong>开闭原则</strong>：可以在不修改已有客户端代码的情况下在程序中创建新的命令</li>
<li>可以实现撤销和恢复功能</li>
<li><strong>延迟执行</strong>:可以实现操作的延迟执行</li>
<li>可以将一组简单命令组合成一个复杂命令</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>复杂性提高</strong>：引入了大量的命令类，可能会使系统变得复杂，尤其是在命令数量较多时</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><br><span class="hljs-comment">// 接收者:厨房，回顾复习单例模式(使用单例模式实现)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Kitchen</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-built_in">Kitchen</span>()&#123;&#125;<br>    <span class="hljs-built_in">Kitchen</span>(<span class="hljs-type">const</span> Kitchen&amp;)=<span class="hljs-keyword">delete</span>;<br>    Kitchen&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Kitchen&amp;)=<span class="hljs-keyword">delete</span>;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">static</span> Kitchen* <span class="hljs-title">getinstance</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-type">static</span> Kitchen* instance=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Kitchen</span>();<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">preparefood</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; food)</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;厨房: 正在准备(&quot;</span>&lt;&lt;food&lt;&lt;<span class="hljs-string">&quot;.)\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 命令类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Command</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Command</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体命令类:订单类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span>:<span class="hljs-keyword">public</span> Command&#123;<br><span class="hljs-keyword">private</span>:<br>    Kitchen* m_kitchen; <span class="hljs-comment">//receiver</span><br>    std::vector&lt;std::string&gt; m_foods;   <span class="hljs-comment">// 点的菜品</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Order</span>(Kitchen* kitchen,std::vector&lt;std::string&gt; foods):<span class="hljs-built_in">m_kitchen</span>(kitchen),<span class="hljs-built_in">m_foods</span>(foods)&#123;&#125;<br>    ~<span class="hljs-built_in">Order</span>()&#123;<br>        <span class="hljs-keyword">delete</span> m_kitchen;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;订单: 需要厨房进行处理...\n&quot;</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span>&amp; food:m_foods)&#123;<br>            m_kitchen-&gt;<span class="hljs-built_in">preparefood</span>(food);<br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 调用者/发送者类: 服务员</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Waitress</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    Command* m_command;<br><span class="hljs-keyword">public</span>:<br>    ~<span class="hljs-built_in">Waitress</span>()&#123;<br>        <span class="hljs-keyword">delete</span> m_command;<br>    &#125;<br>    <span class="hljs-comment">// 提交订单</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">orderup</span><span class="hljs-params">(Command* command)</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;服务员:...提交订单...\n&quot;</span>;<br>        m_command=command;<br>        m_command-&gt;<span class="hljs-built_in">execute</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 点餐</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">orderfood</span><span class="hljs-params">(Waitress&amp; waitress,std::vector&lt;std::string&gt; foods)</span></span>&#123;<br>        waitress.<span class="hljs-built_in">orderup</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Order</span>(Kitchen::<span class="hljs-built_in">getinstance</span>(),foods));<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    Client client;  <span class="hljs-comment">// 客户</span><br>    Waitress waitress;  <span class="hljs-comment">// 服务员</span><br>    client.<span class="hljs-built_in">orderfood</span>(waitress,&#123;<span class="hljs-string">&quot;波士顿大龙虾&quot;</span>,<span class="hljs-string">&quot;雪顶咖啡&quot;</span>&#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>迭代器模式(Iterator pattern)</code>：一种对象行为型设计模式，它<strong>允许你以一致的方式访问集合对象（如列表、数组、集合等）中的元素，而无需暴露集合的内部结构</strong>。换句话说，迭代器模式提供了一种顺序访问集合元素的机制，可以在不暴露集合的实现细节的情况下，遍历其元素。</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：两个餐厅要合并，虽然两家菜单系统类似，但底层使用的数据结构不同，如何能让客户端方便的遍历</p>
<p><strong>解决方案</strong>：提供一种方法顺序访问一个聚合对象中各个元素，而又不需暴露该对象的内部表示</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结 构</strong>：</p>
<ul>
<li>**迭代器(Iterator)**：声明了遍历集合所需的操作：获取下一个元素、是否有下一个元素等</li>
<li>**具体迭代器(Concrete Iterators)**：实现遍历集合的一种特定算法。迭代器对象必须跟踪自身遍历的进度</li>
<li>**集合(Collection)**：声明获取与集合兼容的迭代器的方法</li>
<li>**具体集合(Concrete Collections)**：在客户端请求迭代器时返回一个特定的具体迭代器类实体</li>
<li>**客户端(Client)**：通过集合和迭代器的接口与两者进行交互，允许同一客户端代码使用各种不同的集合和迭代器</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>单一职责原则</strong>：将庞大的遍历算法代码抽取为独立的类</li>
<li><strong>开闭原则</strong>：可实现新型的集合和迭代器，无需修改现有代码</li>
<li>可以并行遍历同一集合，因为每个迭代器对象都包含其自身的遍历状态，并可以暂停遍历并在需要的时候继续</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>如果程序只与简单的结合进行交互，应用该模式可能适得其反</li>
<li>对于某些特殊集合，使用迭代器可能比直接遍历的效率低</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;list&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-comment">// 迭代器类</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>,<span class="hljs-keyword">class</span> <span class="hljs-title class_">U</span>&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Iterator</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> std::list&lt;T&gt;::iterator Pointer;    <span class="hljs-comment">// 利用C++的迭代器</span><br>    <span class="hljs-built_in">Iterator</span>(U* p_container,<span class="hljs-type">bool</span> reverse=<span class="hljs-literal">false</span>):<span class="hljs-built_in">m_container</span>(p_container)&#123;&#125;<br>    <span class="hljs-comment">// 初始位置</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">first</span><span class="hljs-params">()</span></span>&#123;<br>        m_iter=m_container-&gt;m_data.<span class="hljs-built_in">begin</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">next</span><span class="hljs-params">()</span></span>&#123;<br>        m_iter++;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isend</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> (m_iter==m_container-&gt;m_data.<span class="hljs-built_in">end</span>());<br>    &#125;<br>    <span class="hljs-function">Pointer <span class="hljs-title">current</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> m_iter;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    U* m_container; <span class="hljs-comment">// 指向容器的指针</span><br>    Pointer m_iter;<br>&#125;;<br><br><span class="hljs-comment">// 容器:具体集合类</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Container</span>&#123;<br>    <span class="hljs-keyword">friend</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Iterator</span>&lt;T,Container&gt;;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">Iterator&lt;T,Container&gt;* <span class="hljs-title">createIterator</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Iterator</span>&lt;T,Container&gt;(<span class="hljs-keyword">this</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(T data)</span></span>&#123;<br>        m_data.<span class="hljs-built_in">push_back</span>(data);<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    std::list&lt;T&gt;m_data;<br>&#125;;<br><br><span class="hljs-comment">// 菜单类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MenuItem</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">MenuItem</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">setData</span><span class="hljs-params">(std::string data1,std::string data2=<span class="hljs-string">&quot;&quot;</span>)</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">data</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 饮料店类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Beverage</span>:<span class="hljs-keyword">public</span> MenuItem&#123;<br><span class="hljs-keyword">public</span>:<br>    ~<span class="hljs-built_in">Beverage</span>()&#123;&#125;<br>    <span class="hljs-built_in">Beverage</span>(std::string data1,std::string data2):<span class="hljs-built_in">m_data1</span>(data1),<span class="hljs-built_in">m_data2</span>(data2)&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">setData</span><span class="hljs-params">(std::string data1,std::string data2)</span> <span class="hljs-keyword">override</span></span>&#123;<br>        m_data1=data1;<br>        m_data2=data2;<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">data</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> m_data1+<span class="hljs-string">&quot;_&quot;</span>+m_data2;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    std::string m_data1;<br>    std::string m_data2;<br>&#125;;<br><br><span class="hljs-comment">// 披萨店</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Pizza</span>:<span class="hljs-keyword">public</span> MenuItem&#123;<br><span class="hljs-keyword">public</span>:<br>    ~<span class="hljs-built_in">Pizza</span>()&#123;&#125;<br>    <span class="hljs-built_in">Pizza</span>(std::string data):<span class="hljs-built_in">m_data</span>(data)&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setData</span><span class="hljs-params">(std::string data,std::string data2)</span> <span class="hljs-keyword">override</span></span>&#123;<br>        m_data=data;<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">data</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> m_data;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    std::string m_data;<br>&#125;;<br><br><span class="hljs-comment">// 客户端</span><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">client</span><span class="hljs-params">(T* iter)</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(iter-&gt;<span class="hljs-built_in">first</span>();!iter-&gt;<span class="hljs-built_in">isend</span>();iter-&gt;<span class="hljs-built_in">next</span>())&#123;<br>        std::cout&lt;&lt;iter-&gt;<span class="hljs-built_in">current</span>()-&gt;<span class="hljs-built_in">data</span>()&lt;&lt;std::endl;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    Container&lt;Beverage&gt; beverageMenu;<br>    <span class="hljs-function">Beverage <span class="hljs-title">coffee</span><span class="hljs-params">(<span class="hljs-string">&quot;美式&quot;</span>,<span class="hljs-string">&quot;奶茶&quot;</span>)</span>,<span class="hljs-title">bubbleTea</span><span class="hljs-params">(<span class="hljs-string">&quot;珍珠&quot;</span>,<span class="hljs-string">&quot;奶茶&quot;</span>)</span></span>;<br>    beverageMenu.<span class="hljs-built_in">add</span>(coffee);<br>    beverageMenu.<span class="hljs-built_in">add</span>(bubbleTea);<br><br>    Container&lt;Pizza&gt; pizzaMenu;<br>    <span class="hljs-function">Pizza <span class="hljs-title">a</span><span class="hljs-params">(<span class="hljs-string">&quot;意大利香肠&quot;</span>)</span>,<span class="hljs-title">b</span><span class="hljs-params">(<span class="hljs-string">&quot;海鲜披萨&quot;</span>)</span>,<span class="hljs-title">c</span><span class="hljs-params">(<span class="hljs-string">&quot;榴莲披萨&quot;</span>)</span></span>;<br>    pizzaMenu.<span class="hljs-built_in">add</span>(a);<br>    pizzaMenu.<span class="hljs-built_in">add</span>(b);<br>    pizzaMenu.<span class="hljs-built_in">add</span>(c);<br>    <br>    <span class="hljs-comment">// 遍历菜单</span><br>    std::cout&lt;&lt;<span class="hljs-string">&quot;Iterator用于遍历Beverage菜单：\n&quot;</span>;<br>    <span class="hljs-keyword">auto</span> it=beverageMenu.<span class="hljs-built_in">createIterator</span>();<br>    <span class="hljs-built_in">client</span>(it);<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;Iterator用于遍历Pizza菜单：\n&quot;</span>;<br>    <span class="hljs-keyword">auto</span> it2=beverageMenu.<span class="hljs-built_in">createIterator</span>();<br>    <span class="hljs-built_in">client</span>(it2);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>中介者模式(Mediator pattern)</code>：一种对象行为型设计模式，旨在<strong>通过一个中介对象来封装一系列对象之间的交互</strong>。中介者使各对象不需要显式地相互引用，从而使其耦合松散，并且可以独立地改变它们之间的交互</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：实现一个机场的起飞管理系统，如果由驾驶员们讨论谁先起飞，后果可能是灾难性的</p>
<p><strong>解决方案</strong>：用一个中介对象来封装一系列的对象交互。中介者使各对象不需要显示地相互引用，从而使得其耦合松散</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**组件(Component)**：各种包含业务逻辑的类，每个组件都有一个指向中介者的引用，可通过将其连接到不同的中介者使其内容能在其他程序中复用，类似于同事类</li>
<li>**中介者接口(Mediator)**：声明了与组件交流的方法，但通常仅包括一个通知方法</li>
<li>**具体中介者(Concrete Mediator)**：封装了多种组件间的关系，具体中介者通常会保存所有组件的引用并对其进行管理</li>
<li>组件并不知道其他组件的情况。如果组件内发生了重要事件，它只能通知中介者，中介者收到通知后能轻易地确定发送者。</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li>无需修改实际组件就能增加新的中介者</li>
<li>可以减轻应用中多个组件间的耦合情况</li>
<li>可以更方便地复用各个组件</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>一段时间后，中介者可能会演化成为上帝对象</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-comment">// 事先声明,工作人员类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Staff</span>;<br><br><span class="hljs-comment">// 中介者接口:机场塔台类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ControlTower</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">notify</span><span class="hljs-params">(Staff* sender,std::string event)</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 工作人员类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Staff</span>&#123;<br><span class="hljs-keyword">protected</span>:<br>    std::string m_name;<br>    ControlTower* m_controltower;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Staff</span>(std::string name,ControlTower* controltower=<span class="hljs-literal">nullptr</span>):<span class="hljs-built_in">m_name</span>(name),<span class="hljs-built_in">m_controltower</span>(controltower)&#123;&#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">name</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> m_name;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setMediator</span><span class="hljs-params">(ControlTower* controltower)</span></span>&#123;<br>        m_controltower=controltower;<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Pilot</span>:<span class="hljs-keyword">public</span> Staff&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Pilot</span>(std::string name):<span class="hljs-built_in">Staff</span>(name)&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">takeOff</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-built_in">name</span>()+<span class="hljs-string">&quot;:请求起飞.\n&quot;</span>;<br>        m_controltower-&gt;<span class="hljs-built_in">notify</span>(<span class="hljs-keyword">this</span>,<span class="hljs-string">&quot;起飞请求&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">copy</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-built_in">name</span>()+<span class="hljs-string">&quot;:收到.\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GroundGrew</span>:<span class="hljs-keyword">public</span> Staff&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">GroundGrew</span>(std::string name):<span class="hljs-built_in">Staff</span>(name)&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">takeOff</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-built_in">name</span>()+<span class="hljs-string">&quot;:请求维护.\n&quot;</span>;<br>        m_controltower-&gt;<span class="hljs-built_in">notify</span>(<span class="hljs-keyword">this</span>,<span class="hljs-string">&quot;维护请求&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">copy</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-built_in">name</span>()+<span class="hljs-string">&quot;:收到.\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-comment">// 具体中介者类:具体控制塔</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteControlTower</span>:<span class="hljs-keyword">public</span> ControlTower&#123;<br><span class="hljs-keyword">private</span>:<br>    Pilot* m_pilot1;<br>    Pilot* m_pilot2;<br>    GroundGrew* m_ground1;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">ConcreteControlTower</span>(Pilot* p1,Pilot* p2,GroundGrew* g1):<span class="hljs-built_in">m_pilot1</span>(p1),<span class="hljs-built_in">m_pilot2</span>(p2),<span class="hljs-built_in">m_ground1</span>(g1)&#123;<br>        m_pilot1-&gt;<span class="hljs-built_in">setMediator</span>(<span class="hljs-keyword">this</span>);<br>        m_pilot2-&gt;<span class="hljs-built_in">setMediator</span>(<span class="hljs-keyword">this</span>);<br>        m_ground1-&gt;<span class="hljs-built_in">setMediator</span>(<span class="hljs-keyword">this</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">notify</span><span class="hljs-params">(Staff* sender,std::string event)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;控制塔:收到&quot;</span>+sender-&gt;<span class="hljs-built_in">name</span>()+event&lt;&lt;std::endl;<br>        <span class="hljs-keyword">if</span>(event==<span class="hljs-string">&quot;起飞请求&quot;</span>)&#123;<br>            m_ground1-&gt;<span class="hljs-built_in">copy</span>();<br>            <span class="hljs-keyword">if</span>(sender!=m_pilot1) m_pilot1-&gt;<span class="hljs-built_in">copy</span>();<br>            <span class="hljs-keyword">if</span>(sender!=m_pilot2) m_pilot2-&gt;<span class="hljs-built_in">copy</span>();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(event==<span class="hljs-string">&quot;维护请求&quot;</span>)&#123;<br>            <span class="hljs-keyword">if</span>(sender!=m_pilot1) m_pilot1-&gt;<span class="hljs-built_in">copy</span>();<br>            <span class="hljs-keyword">if</span>(sender!=m_pilot2) m_pilot2-&gt;<span class="hljs-built_in">copy</span>();<br><br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    Pilot* p1=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Pilot</span>(<span class="hljs-string">&quot;空军一号&quot;</span>);<br>    Pilot* p2=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Pilot</span>(<span class="hljs-string">&quot;空军二号&quot;</span>);<br>    GroundGrew* g1=<span class="hljs-keyword">new</span> <span class="hljs-built_in">GroundGrew</span>(<span class="hljs-string">&quot;地勤1&quot;</span>);<br>    ConcreteControlTower* controltower=<span class="hljs-keyword">new</span> <span class="hljs-built_in">ConcreteControlTower</span>(p1,p2,g1);<br>    p1-&gt;<span class="hljs-built_in">takeOff</span>();<br>    g1-&gt;<span class="hljs-built_in">takeOff</span>();<br>    <span class="hljs-keyword">delete</span> p1;<br>    <span class="hljs-keyword">delete</span> p2;<br>    <span class="hljs-keyword">delete</span> g1;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="备忘录模式"><a href="#备忘录模式" class="headerlink" title="备忘录模式"></a>备忘录模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>备忘录模式(Memento pattern)</code>：是一种对象行为型设计模式，它<strong>允许在不暴露对象实现细节的情况下，保存和恢复对象的状态</strong>。简单来说，备忘录模式可以让你在某个时刻保存对象的状态，并在以后需要的时候恢复到这个状态。</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：实现一个游戏的存档功能，希望在保存状态的同时可以不破坏类的封装</p>
<p><strong>解决方案</strong>：在不破坏封装性的前提下，捕获一个对象的内部状态。并在该对象之外保留这个状态。这样以后就可将该对象恢复到原先保存的状态</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**原发器类(Originator)**：可以生成自身状态的快照(备忘录对象)，也可以在需要时通过快照恢复自身状态</li>
<li>**备忘录类(Memento)**：存储对象状态(快照)的对象，通常做法是将备忘录设为不可变的，并通过构造函数一次性传递数据</li>
<li>**负责人类(Caretaker)**：仅知道”何时”和”为何”创建原发器快照，以及何时恢复状态</li>
<li>可以通过友元，使得Memento中的状态只能被Originator所拿到</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li>可以在不破坏对象封装情况的前提下创建对象状态快照</li>
<li>可以通过负责人维护原发器状态历史记录，简化原发器代码</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>负责人必须跟踪原发器的生命周期，这样才能销毁启用的备忘录</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-comment">// Memento:存档</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Memento</span>&#123;<br>    <span class="hljs-keyword">friend</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hero</span>;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> m_state;<br>    std::string m_date;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Memento</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> state):<span class="hljs-built_in">m_state</span>(state)&#123;<br>        std::<span class="hljs-type">time_t</span> now=std::<span class="hljs-built_in">time</span>(<span class="hljs-number">0</span>);<br>        m_date=std::<span class="hljs-built_in">ctime</span>(&amp;now);<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">getdate</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> m_date;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// Originator:游戏英雄类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hero</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> m_state;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Hero</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> state):<span class="hljs-built_in">m_state</span>(state)&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;英雄:我的初始状态为:&quot;</span>&lt;&lt;m_state&lt;&lt;std::endl;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fight</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;英雄:被砍了一刀\n&quot;</span>;<br>        m_state-=<span class="hljs-built_in">rand</span>()%<span class="hljs-number">20</span>;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;当前状态为:&quot;</span>&lt;&lt;m_state&lt;&lt;std::endl;<br>    &#125;<br>    <span class="hljs-comment">// 保存状态</span><br>    <span class="hljs-function">Memento* <span class="hljs-title">save</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Memento</span>(m_state);<br>    &#125;<br><br>    <span class="hljs-comment">// 恢复状态</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">restore</span><span class="hljs-params">(Memento* memento)</span></span>&#123;<br>        m_state=memento-&gt;m_state;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;英雄:当前状态恢复为:&quot;</span>&lt;&lt;m_state&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-comment">// Caretaker</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Caretaker</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    Hero* m_hero;<br>    std::vector&lt;Memento*&gt; m_mementos;   <span class="hljs-comment">// 存档列表</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Caretaker</span>(Hero* hero):<span class="hljs-built_in">m_hero</span>(hero)&#123;&#125;<br>    ~<span class="hljs-built_in">Caretaker</span>()&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> item:m_mementos) <span class="hljs-keyword">delete</span> item;<br>    &#125;<br>    <span class="hljs-comment">// 创建存档</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">backup</span><span class="hljs-params">()</span></span>&#123;<br>         std::cout&lt;&lt;<span class="hljs-string">&quot;管理者:正在保存英雄状态...\n&quot;</span>;<br>        m_mementos.<span class="hljs-built_in">emplace_back</span>(m_hero-&gt;<span class="hljs-built_in">save</span>());<br>    &#125;<br>    <span class="hljs-comment">// 恢复存档</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">undo</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">if</span>(m_mementos.<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">return</span>;<br>        Memento* memento=m_mementos.<span class="hljs-built_in">back</span>();<br>        m_mementos.<span class="hljs-built_in">pop_back</span>();<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;管理者:英雄状态恢复为&quot;</span>&lt;&lt;memento-&gt;<span class="hljs-built_in">getdate</span>()&lt;&lt;std::endl;<br>        m_hero-&gt;<span class="hljs-built_in">restore</span>(memento);<br>        <span class="hljs-keyword">delete</span> memento;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    std::<span class="hljs-built_in">srand</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>&gt;(std::<span class="hljs-built_in">time</span>(<span class="hljs-literal">NULL</span>)));<br>    Hero* hero=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Hero</span>(<span class="hljs-number">100</span>);<br>    Caretaker* caretaker=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Caretaker</span>(hero);<br>    caretaker-&gt;<span class="hljs-built_in">backup</span>();<br>    hero-&gt;<span class="hljs-built_in">fight</span>();<br>    hero-&gt;<span class="hljs-built_in">fight</span>();<br>    caretaker-&gt;<span class="hljs-built_in">undo</span>();<br>    <span class="hljs-keyword">delete</span> hero;<br>    <span class="hljs-keyword">delete</span> caretaker;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>观察者模式(Observer pattern)</code>：是一种对象行为型设计模式，它定义了一种一对多的依赖关系，<strong>让多个观察者对象同时监听某一个主题对象。当主题对象的状态发生变化时，所有依赖于它的观察者都会得到通知并自动更新</strong>。这个模式使得主题与观察者之间的耦合度降低，从而提高系统的灵活性和可扩展性</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：开发一个购物平台，当商品缺货时如何处理？如果客户经常主动查看，无疑是浪费客户的时间。如果平台主动发送到货通知给所有客户，那么对于不需要的客户来说并不友好，缺货商品一多消息也容易泛滥</p>
<p><strong>解决方案</strong>：定义对象间的一种一对多关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到同志并自动更新</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**发布者&#x2F;主题接口(Publisher&#x2F;Subject)**：被观察对象，维护一系列观察者，提供注册、注销观察者的方法。会向其他对象发送值得关注的事件，支持订阅。当新事件发生时，发布者会遍历订阅者对象，调用通知方法。该方法是在订阅者接口中声明的</li>
<li>**具体发布者&#x2F;具体主题(ConcretePublisher&#x2F;ConcreteSubject)**：实现了主题接口，存储与核心业务相关的状态。当具体主题的状态发生变化时，会通知所有观察者</li>
<li>**订阅者接口&#x2F;观察者接口(Subscriber)**：声明了通知接口。多数情况下，该接口仅包含一个update更新方法</li>
<li>**具体订阅者&#x2F;具体观察者(Concrete Subscribers)**：执行一些操作来回应发布者的通知，订阅者通常需要一些上下文信息来正确地处理更新</li>
<li>**客户端(Client)**：会分别创建发布者和订阅者对象，然后为订阅者注册发布者更新</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>开闭原则</strong>：你无需修改发布者代码就能引入新的订阅者类(如果是发布者接口则可轻松引入发布者类)</li>
<li><strong>动态管理</strong>：可以在运行时建立对象之间的联系，动态地添加或移除观察者，无需修改主题的代码</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>通知顺序一致性</strong>：订阅者的通知顺序是随机的</li>
<li><strong>循环依赖</strong>：在实现观察者模式时，如果不当心，可能会导致循环依赖的问题，特别是当观察者和被观察者相互持有对方的引用时</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;list&gt;</span></span><br><br><span class="hljs-comment">// 订阅者/观察者接口</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IObserver</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; message)</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 发布者/主题接口</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ISubject</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">attach</span><span class="hljs-params">(IObserver* observer)</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">detach</span><span class="hljs-params">(IObserver* observer)</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">noify</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体主题/发布者:Mate50手机商品</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mate50</span>:<span class="hljs-keyword">public</span> ISubject&#123;<br><span class="hljs-keyword">private</span>:<br>    std::list&lt;IObserver*&gt; m_observerlist;<br>    std::string m_message;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">attach</span><span class="hljs-params">(IObserver *observer)</span> <span class="hljs-keyword">override</span></span>&#123;<br>        m_observerlist.<span class="hljs-built_in">emplace_back</span>(observer);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">detach</span><span class="hljs-params">(IObserver *observer)</span> <span class="hljs-keyword">override</span></span>&#123;<br>        m_observerlist.<span class="hljs-built_in">remove</span>(observer);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">noify</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> &amp;ob:m_observerlist)&#123;<br>            ob-&gt;<span class="hljs-built_in">update</span>(m_message);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">createmess</span><span class="hljs-params">(std::string message=<span class="hljs-string">&quot;&quot;</span>)</span></span>&#123;<br>        m_message=message;<br>        <span class="hljs-built_in">noify</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体订阅者/观察者:对Mate50感兴趣的顾客</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Customer</span>:<span class="hljs-keyword">public</span> IObserver&#123;<br><span class="hljs-keyword">private</span>:<br>    ISubject* m_mate50;<br>    std::string m_message;<br>    <span class="hljs-type">int</span> m_numer;    <span class="hljs-comment">// 顾客编号</span><br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> m_static_num;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Customer</span>(ISubject* subject):<span class="hljs-built_in">m_mate50</span>(subject)&#123;<br>        m_mate50-&gt;<span class="hljs-built_in">attach</span>(<span class="hljs-keyword">this</span>);<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;我是&quot;</span>&lt;&lt;++Customer::m_static_num&lt;&lt;<span class="hljs-string">&quot;号订阅者.\n&quot;</span>;<br>        m_numer=m_static_num;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string &amp;message)</span> <span class="hljs-keyword">override</span></span>&#123;<br>        m_message=message;<br>        <span class="hljs-built_in">printinfo</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printinfo</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;m_numer&lt;&lt;<span class="hljs-string">&quot;号订阅者:接收到新的消息:&quot;</span>+m_message;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span></span>&#123;<br>        m_mate50-&gt;<span class="hljs-built_in">detach</span>(<span class="hljs-keyword">this</span>);<br>        std::cout&lt;&lt;m_numer&lt;&lt;<span class="hljs-string">&quot;号订阅者:从列表中移除.\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-type">int</span> Customer::m_static_num=<span class="hljs-number">0</span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    Mate50* mate50=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Mate50</span>();<br>    Customer* c1=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Customer</span>(mate50);<br>    Customer* c2=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Customer</span>(mate50);<br>    Customer* c3=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Customer</span>(mate50);<br>    Customer* c4;<br>    mate50-&gt;<span class="hljs-built_in">createmess</span>(<span class="hljs-string">&quot;Mate50即将到店...\n&quot;</span>);<br>    c4=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Customer</span>(mate50);<br>    mate50-&gt;<span class="hljs-built_in">createmess</span>(<span class="hljs-string">&quot;Mate50明天到店...\n&quot;</span>);<br>    c2-&gt;<span class="hljs-built_in">remove</span>();<br>    mate50-&gt;<span class="hljs-built_in">createmess</span>(<span class="hljs-string">&quot;Mate50即将售完...\n&quot;</span>);<br>    <span class="hljs-keyword">delete</span> mate50;<br>    <span class="hljs-keyword">delete</span> c1;<br>    <span class="hljs-keyword">delete</span> c2;<br>    <span class="hljs-keyword">delete</span> c3;<br>    <span class="hljs-keyword">delete</span> c4;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>状态模式(State pattern)</code>：是一种对象行为型设计模式，它允许一个对象在其内部状态变化时，改变其行为。换句话说，<strong>状态模式使得对象在不同的状态下，表现出不同的行为，而无需在代码中使用条件语句来切换状态</strong></li>
<li><code>核心思想</code>：将一个对象的状态抽象成不同的状态类，<strong>当对象的状态发生变化时，直接切换到相应的状态类，通过状态类来实现行为的切换</strong>。每个状态类都代表对象的某种状态，状态的转换是通过状态对象之间的切换来完成的</li>
<li><code>作用</code>：避免了大量的条件判断语句，简化状态机的处理代码，增加系统的可扩展性</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：开发一个糖果贩卖机，当投入硬币按下按钮，糖果机将掉落一枚糖果，当没有投入硬币，直接按下按钮，将会得到请投币的提示(如果有多种状态，并且需要后期扩展)</p>
<p><strong>解决方案</strong>：允许一个对象在其内部状态发生改变时改变它的行为</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**上下文(Context)**：上下文持有当前的状态，并且提供切换状态的方法。上下文的行为会随着状态的变化而发生改变</li>
<li>**状态接口(State)**：声明特定于状态的方法，用于封装具体状态类的行为</li>
<li><strong>具体状态</strong>：实现状态接口，定义不同状态下具体行为</li>
</ul>
<blockquote>
<p><strong>注意</strong>：上下文和具体状态都可以设置上下文的下一个状态，并通过替换连接到上下文的状态对象来完成实际的状态转换</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>单一职责原则</strong>：将与特定状态相关的代码放在单独的类中</li>
<li><strong>开闭原则</strong>：无需修改已有状态类和上下文就能引入新状态</li>
<li><strong>简化代码</strong>：通过消除臃肿的状态机条件语句简化上下文代码</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>过度设计</strong>：如果状态机只有很少的几个状态，或者很少发生改变，那么应用该模式可能会显得小题大做</li>
<li><strong>类数量增加</strong>：状态模式会引入很多状态类，可能导致系统中类的数量显著增加，从而增加了系统的复杂性</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CandyMachine</span>;<br><br><span class="hljs-comment">// 状态接口</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>&#123;<br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-comment">// CandyMachine* m_candymachine;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">/* void setcontext(CandyMachine* candymachine)&#123;</span><br><span class="hljs-comment">        m_candymachine=candymachine;</span><br><span class="hljs-comment">    &#125; */</span><br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">State</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">getcandy</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">returncoin</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">putcoin</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体状态类:未投币状态</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NoCoinState</span>:<span class="hljs-keyword">public</span> State&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">getcandy</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;请先投币.\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">returncoin</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;你并没有投币.\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">putcoin</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;投币成功.\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HaveCoinState</span>:<span class="hljs-keyword">public</span> State&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">getcandy</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;糖果投放中....\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">returncoin</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;硬币退回中....\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">putcoin</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;重复投币.\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 上下文类:糖果机类，保存所有会出现的状态以及当前状态，并提供切换状态方法</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CandyMachine</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    State* m_curstate;<br>    State* m_havecoin;<br>    State* m_nocoin;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">CandyMachine</span>()&#123;<br>        m_havecoin=<span class="hljs-keyword">new</span> <span class="hljs-built_in">HaveCoinState</span>();<br>        m_nocoin=<span class="hljs-keyword">new</span> <span class="hljs-built_in">NoCoinState</span>();<br>        m_curstate=m_nocoin;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;糖果机:当前状态为&quot;</span>&lt;&lt;<span class="hljs-built_in">typeid</span>(*m_curstate).<span class="hljs-built_in">name</span>()&lt;&lt;std::endl;<br>    &#125;<br>    ~<span class="hljs-built_in">CandyMachine</span>()&#123;<br>        <span class="hljs-keyword">delete</span> m_nocoin;<br>        <span class="hljs-keyword">delete</span> m_havecoin;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">putcoin</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;糖果机:putcoin\n&quot;</span>;<br>        m_curstate-&gt;<span class="hljs-built_in">putcoin</span>();<br>        <span class="hljs-built_in">transit</span>(m_havecoin);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">getcandy</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;糖果机:getcandy\n&quot;</span>;<br>        m_curstate-&gt;<span class="hljs-built_in">getcandy</span>();<br>        <span class="hljs-built_in">transit</span>(m_nocoin);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">returncoin</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;糖果机:returncoin\n&quot;</span>;<br>        m_curstate-&gt;<span class="hljs-built_in">returncoin</span>();<br>        <span class="hljs-built_in">transit</span>(m_nocoin);<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">transit</span><span class="hljs-params">(State* state)</span></span>&#123;<br>        m_curstate=state;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;糖果机:切换状态为&quot;</span>&lt;&lt;<span class="hljs-built_in">typeid</span>(*m_curstate).<span class="hljs-built_in">name</span>()&lt;&lt;std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    CandyMachine* candymachine=<span class="hljs-keyword">new</span> <span class="hljs-built_in">CandyMachine</span>();<br>    candymachine-&gt;<span class="hljs-built_in">getcandy</span>();<br>    candymachine-&gt;<span class="hljs-built_in">returncoin</span>();<br>    candymachine-&gt;<span class="hljs-built_in">putcoin</span>();<br>    candymachine-&gt;<span class="hljs-built_in">getcandy</span>();<br>    candymachine-&gt;<span class="hljs-built_in">returncoin</span>();<br>    <span class="hljs-keyword">delete</span> candymachine;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>策略模式(Strategy pattern)</code>：是一种对象行为型设计模式，它定义了一系列算法，并使得它们可以相互替换。策略模式使得算法的变化独立于使用算法的客户端。换句话说，<strong>策略模式允许你在运行时选择不同的算法来完成某个任务，从而避免了在代码中大量的条件语句</strong></li>
<li><code>核心思想</code>：将算法封装在独立的策略类中，通过上下文(Context)对象来控制算法的切换，使得客户端能够灵活地选择不同的策略，而不需要修改客户端代码</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：做一款打斗游戏，玩家使用的英雄使用不同的武器将会产生不同的损伤效果</p>
<p><strong>解决方案</strong>：定义一系列算法，把他们一个个封装起来。并且使它们可以相互替换。使得算法可独立于使用它的客户而变化</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>区分</strong>：</p>
<ul>
<li><code>状态模式</code>：状态模式的本质是在<strong>对象内部状态改变时，改变其行为</strong>，也就是说状态模式允许对象根据当前内部状态的不同，而表现出不同的行为</li>
<li><code>策略模式</code>：策略模式的本质是在运行中可以选择不同的算法，也就是说<strong>相同的任务，策略模式允许对象选择不同的算法来进行执行这个任务，不同的算法所得出的结果不同</strong></li>
<li><code>区分</code>：<strong>策略模式是改变的是算法或行为，状态模式是改变其内部状态(间接改变行为)，策略模式是外部控制改变行为，而状态模式是内部改变状态以改变行为</strong></li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**上下文(Context)**：维护指向具体策略的引用，并通过该对象来执行具体的算法(上下文通常会根据外部条件来选择使用哪个具体策略)。</li>
<li>**策略接口(Strategy)**：所有具体策略的通用接口，定义了所有支持的算法或行为(所有具体策略类都需要实现这个接口)</li>
<li>**具体策略(Concrete Strategies)**：实现了上下文所用算法(策略接口)的不同变体</li>
<li>**客户端(Client)**：会创建一个特定策略对象并将其传递给上下文，上下文则会提供一个设置器以便客户端在运行时替换相关联的策略</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>动态选择</strong>：可在运行时切换对象内的算法</li>
<li><strong>代码隔离</strong>：可将算法的实现和使用算法的代码隔离</li>
<li><strong>组合代替</strong>：可使用组合代替继承</li>
<li><strong>开闭原则</strong>：无需对上下文进行修改就能够引入新的策略</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>过度设计</strong>：如果算法极少发生改变，那么没有任何理由引入新的类和接口，这样只会让程序过于复杂</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// Strategy接口:武器类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Weapon</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Weapon</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">fightAlgorithm</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体Strategy类:匕首类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dagger</span>:<span class="hljs-keyword">public</span> Weapon&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">std::string <span class="hljs-title">fightAlgorithm</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;使用匕首计算损伤.\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体Strategy类:斧头类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Axe</span>:<span class="hljs-keyword">public</span> Weapon&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">std::string <span class="hljs-title">fightAlgorithm</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;使用斧头计算损伤.\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// Context类:英雄类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hero</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    Weapon* m_weapon;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Hero</span>(Weapon* weapon=<span class="hljs-literal">nullptr</span>):<span class="hljs-built_in">m_weapon</span>(weapon)&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setWeapon</span><span class="hljs-params">(Weapon* weapon)</span></span>&#123;<br>        m_weapon=weapon;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fight</span><span class="hljs-params">()</span></span>&#123;<br>        std::cout&lt;&lt;m_weapon-&gt;<span class="hljs-built_in">fightAlgorithm</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;客户端:英雄使用匕首攻击.\n&quot;</span>;<br>    Dagger dagger;<br>    <span class="hljs-function">Hero <span class="hljs-title">hero</span><span class="hljs-params">(&amp;dagger)</span></span>;<br>    hero.<span class="hljs-built_in">fight</span>();<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;客户端:英雄使用斧头攻击.\n&quot;</span>;<br>    Axe axe;<br>    hero.<span class="hljs-built_in">setWeapon</span>(&amp;axe);<br>    hero.<span class="hljs-built_in">fight</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>模板方法模式(Template Method pattern)</code>：是一种类行为型设计模式，它定义了一个算法的骨架，将一些步骤的实现推迟到子类中。<strong>模板方法模式让子类可以在不改变算法结构的情况下，重定义算法中的某些步骤</strong></li>
<li>工厂方法是模板方法的一种特例</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：做一款数据挖掘的程序，需要支持不同格式的数据文件，虽然文件格式不同，实现步骤基本一致</p>
<p><strong>解决方案</strong>：定义一个算法骨架，而将一些步骤延迟到子类。模板方法使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**抽象类(AbstractClass)**：定义一个模板方法，控制算法的执行顺序，模板方法通常是一个 <strong>final</strong> 方法，防止子类修改它的执行流程。模板方法中包含一些抽象步骤，这些步骤由子类去实现。</li>
<li>**具体类(ConcreteClass)**：继承抽象类，提供实现细节，重写抽象步骤，继承并完成模板方法中的抽象部分</li>
<li>**模板方法(Template Method)**：抽象类中定义的公共算法流程，由具体子类实现特定的步骤</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>代码复用</strong>：大部分算法结构在父类中实现，子类只需要实现某些步骤，从而避免了重复代码</li>
<li><strong>控制算法顺序</strong>：父类可以控制算法的结构和顺序，子类只能修改某些具体步骤，保证了算法的一致性</li>
<li><strong>开闭原则</strong>：通过让子类扩展或实现某些步骤，而不是修改父类的结构，实现了对扩展的开放，对修改的封闭</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>维护困难</strong>：模板方法中的步骤越多，其维护工作就可能会越困难</li>
<li><strong>限制灵活性</strong>：子类只能扩展或修改父类定义的步骤，无法自由改变算法结构，因此模板方法模式不适用于所有情况</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-comment">// 抽象类:数据采集类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataMiner</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 模板方法</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mineData</span><span class="hljs-params">(std::string path)</span></span>&#123;<br>        <span class="hljs-built_in">openfile</span>(path);<br>        <span class="hljs-built_in">extractData</span>();<br>        <span class="hljs-built_in">makereport</span>();<br>        <span class="hljs-built_in">hook1</span>();<br>        <span class="hljs-built_in">closefile</span>();<br>    &#125;<br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">openfile</span><span class="hljs-params">(std::string path)</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">extractData</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;DataMiner:从字符串中提取相关数据.\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">makereport</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;DataMiner:生成数据分析报告.\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">closefile</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">hook1</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;&#125;<br><span class="hljs-keyword">protected</span>:<br>    std::string m_str=<span class="hljs-string">&quot;&quot;</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体类:pdf数据采集类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PDFDataMiner</span>:<span class="hljs-keyword">public</span> DataMiner&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">openfile</span><span class="hljs-params">(std::string path)</span> <span class="hljs-keyword">override</span></span>&#123;<br>        m_str=<span class="hljs-string">&quot;openfile(path)&quot;</span>;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;PDFDataMiner:打开PDF文件，转换为字符串序列.\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">closefile</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;PDFDataMiner:关闭PDF文件.\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体类:pdf数据采集类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WordDataMiner</span>:<span class="hljs-keyword">public</span> DataMiner&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">openfile</span><span class="hljs-params">(std::string path)</span> <span class="hljs-keyword">override</span></span>&#123;<br>        m_str=<span class="hljs-string">&quot;openfile(path)&quot;</span>;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;WordDataMiner:打开Word文件，转换为字符串序列.\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">closefile</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;WordDataMiner:关闭Word文件.\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">hook1</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;WordDataMiner:给Word文件添加水印.\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端代码</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">client</span><span class="hljs-params">(DataMiner* dataminer,std::string path)</span></span>&#123;<br>    dataminer-&gt;<span class="hljs-built_in">mineData</span>(path);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    PDFDataMiner pdfdataminer;<br>    <span class="hljs-built_in">client</span>(&amp;pdfdataminer,<span class="hljs-string">&quot;aa.pdf&quot;</span>);<br>    WordDataMiner worddataminer;<br>    <span class="hljs-built_in">client</span>(&amp;worddataminer,<span class="hljs-string">&quot;bb.doc&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>访问者模式(Visitor pattern)</code>：是一种对象行为型设计模式，其核心思想是将<strong>对一组对象的操作从对象结构中分离出来，放入到访问者对象中</strong>。通过这种方式，你可以在<strong>不修改元素类的情况下，向元素添加新的操作</strong></li>
<li><code>具体操作</code>：具体来说，访问者模式提供了一个 <strong>访问者（Visitor）</strong> 类，通过这个访问者类来访问一组元素对象。每个元素对象会通过 <code>accept()</code> 方法接收访问者，从而触发访问者的操作方法。访问者模式让你可以在不改变元素类的前提下，添加新的操作</li>
</ul>
<blockquote>
<p><strong>例子</strong></p>
<p><strong>问题</strong>：做一款生成冰激凌和雪糕的程序，现在希望为其添加糖霜，巧克力粉</p>
<p><strong>解决方案</strong>：保证元素类不变，为元素类定义作用于该元素类的新操作</p>
</blockquote>
<p>​	</p>
<p>​	</p>
<p><strong>结构</strong>：</p>
<ul>
<li>**访问者接口(Visitor)**：声明了一系列以对象结构的具体元素为参数的访问者方法</li>
<li>**具体访问者类(Concrete Visitor)**：会为不同的具体元素类实现相同行为的不同版本</li>
<li>**元素接口(Element)**：声明了一个方法来”接收”访问者(允许访问者访问该元素)</li>
<li>**具体元素(Concrete Element)**：实现元素接口的接收方法，根据当前元素类将其调用重定向到相应访问者的方法</li>
<li>**客户端(Client)**：通常会作为集合或其他复杂对象(例如一个组合树)的代表，</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>操作集中管理</strong>：所有操作都在访问者类中进行，这样避免了每个元素类都实现重复的操作</li>
<li><strong>开闭原则</strong>：在不修改元素类情况下，添加新的操作(访问者)</li>
<li>如果对象结构比较复杂，比如树形结构或多层次结构，它可以遍历整个对象结构，对每个元素进行相应的操作</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>元素类扩展困难</strong>：访问者模式的前提就是元素类不变，如果要添加新的元素类，所有访问者类都得修改，添加对新元素的支持</li>
<li><strong>不适用频繁变化元素结构</strong>：如果元素种类频繁变化(增加和删除)，都需要更新所有的访问者类</li>
</ul>
<p>​	</p>
<p>​	</p>
<p><strong>实现</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IceCream</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Popsicle</span>;<br><br><span class="hljs-comment">// 访问者接口</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Visitor</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">visitIce</span><span class="hljs-params">(<span class="hljs-type">const</span> IceCream* elem)</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">visitPopsicle</span><span class="hljs-params">(<span class="hljs-type">const</span> Popsicle* elem)</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 元素接口</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Component</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">accept</span><span class="hljs-params">(Visitor* visitor)</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 具体元素类:冰激凌类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IceCream</span>:<span class="hljs-keyword">public</span> Component&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">accept</span><span class="hljs-params">(Visitor *visitor)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        visitor-&gt;<span class="hljs-built_in">visitIce</span>(<span class="hljs-keyword">this</span>);<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">getIce</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;冰激凌&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体元素类:雪糕类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Popsicle</span>:<span class="hljs-keyword">public</span> Component&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">accept</span><span class="hljs-params">(Visitor *visitor)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        visitor-&gt;<span class="hljs-built_in">visitPopsicle</span>(<span class="hljs-keyword">this</span>);<br>    &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">getPopsicle</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;雪糕&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体访问者类:糖霜类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Frosting</span>:<span class="hljs-keyword">public</span> Visitor&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">visitIce</span><span class="hljs-params">(<span class="hljs-type">const</span> IceCream *elem)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;elem-&gt;<span class="hljs-built_in">getIce</span>()&lt;&lt;<span class="hljs-string">&quot;+糖霜\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">visitPopsicle</span><span class="hljs-params">(<span class="hljs-type">const</span> Popsicle *elem)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;elem-&gt;<span class="hljs-built_in">getPopsicle</span>()&lt;&lt;<span class="hljs-string">&quot;+糖霜\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 具体访问者类:巧克力类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Chocolate</span>:<span class="hljs-keyword">public</span> Visitor&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">visitIce</span><span class="hljs-params">(<span class="hljs-type">const</span> IceCream *elem)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;elem-&gt;<span class="hljs-built_in">getIce</span>()&lt;&lt;<span class="hljs-string">&quot;+巧克力\n&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">visitPopsicle</span><span class="hljs-params">(<span class="hljs-type">const</span> Popsicle *elem)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>&#123;<br>        std::cout&lt;&lt;elem-&gt;<span class="hljs-built_in">getPopsicle</span>()&lt;&lt;<span class="hljs-string">&quot;+巧克力\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 客户端</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">client</span><span class="hljs-params">(std::vector&lt;Component*&gt; component,Visitor* visitor)</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span>&amp; it:component)&#123;<br>        it-&gt;<span class="hljs-built_in">accept</span>(visitor);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    std::vector&lt;Component*&gt; components=&#123;<span class="hljs-keyword">new</span> IceCream,<span class="hljs-keyword">new</span> Popsicle,<span class="hljs-keyword">new</span> Popsicle&#125;;<br>    Frosting frosting;<br>    <span class="hljs-built_in">client</span>(components,&amp;frosting);<br>    Chocolate chocolate;<br>    <span class="hljs-built_in">client</span>(components,&amp;chocolate);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it:components) <span class="hljs-keyword">delete</span> it;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	</p>
<p>​	</p>
<h2 id="MVC模式"><a href="#MVC模式" class="headerlink" title="MVC模式"></a>MVC模式</h2><p>​	</p>
<p>​	</p>
<p><strong>概念</strong>：</p>
<ul>
<li><code>MVC模式</code>：是一种经典的设计模式，可以理解为一种复合型设计模式，常用于开发<strong>图形用户界面(GUI)应用程序</strong>。分为Model、View和Control部分，每个部分负责不同的功能，从而实现应用程序的<strong>分层架构</strong></li>
<li><code>组成</code>：<ul>
<li><strong>Model(模型)<strong>：</strong>负责处理数据、状态和应用业务逻辑</strong>，只提供数据接口，通常包含应用程序的核心类和数据结构</li>
<li><strong>View(视图)<strong>：显示模型的数据，并根据用户的交互更新界面，表示用户界面，用于展示数据给用户，视图通常不直接处理数据或业务逻辑，而是</strong>负责展示数据</strong></li>
<li><strong>Control(控制器)<strong>：</strong>处理用户的请求，协调模型和视图之间的交互</strong>。作为用户输入和视图之间的中介，控制器接收用户的输入，并调用模型和视图进行相应的操作。控制器会根据用户的行为更新模型，模型的更新又会通过视图进行展示</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202411161127986.png" srcset="/img/loading.gif" lazyload alt="image-20241116110141194"></p>
<p>​	</p>
<p>​	</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>​	</p>
<p>​	</p>
<table>
<thead>
<tr>
<th align="center">范围 &#x2F; 类型</th>
<th align="center">创建型</th>
<th align="center">结构型</th>
<th align="center">行为型</th>
</tr>
</thead>
<tbody><tr>
<td align="center">类</td>
<td align="center">工厂方法</td>
<td align="center">适配器(类)</td>
<td align="center">模板方法</td>
</tr>
<tr>
<td align="center">对象</td>
<td align="center">抽象工厂,建造者,原型,单例</td>
<td align="center">适配器(对象),桥接,组合,装饰,外观,享元,代理</td>
<td align="center">责任链,命令,迭代器,中介者,备忘录,观察者,状态,策略,访问者</td>
</tr>
</tbody></table>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="category-chain-item">设计模式</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/C/" class="print-no-link">#C++</a>
      
        <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="print-no-link">#设计模式</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>设计模式(C++)</div>
      <div>https://moonfordream.github.io/posts/设计模式-C/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Moon</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年11月16日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/VScode%E9%85%8D%E7%BD%AE/" title="VScode配置">
                        <span class="hidden-mobile">VScode配置</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="twikoo"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/twikoo/1.6.8/twikoo.all.min.js', function() {
        var options = Object.assign(
          {"envId":"https://moon-twikoo.netlify.app/.netlify/functions/twikoo","region":"ap-shanghai","path":"window.location.pathname"},
          {
            el: '#twikoo',
            path: 'window.location.pathname',
            onCommentLoaded: function() {
              Fluid.utils.listenDOMLoaded(function() {
                var imgSelector = '#twikoo .tk-content img:not(.tk-owo-emotion)';
                Fluid.plugins.imageCaption(imgSelector);
                Fluid.plugins.fancyBox(imgSelector);
              });
            }
          }
        )
        twikoo.init(options)
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/MoonforDream" target="_blank" rel="nofollow noopener"><span>Moon</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/js/scrollAnimation.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
