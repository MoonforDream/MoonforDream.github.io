

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405190208396.jpg">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405190208396.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Moon">
  <meta name="keywords" content="">
  
    <meta name="description" content="该笔记记录了Django框架的语法学习以及开发">
<meta property="og:type" content="article">
<meta property="og:title" content="Django框架学习与开发">
<meta property="og:url" content="https://moonfordream.github.io/posts/Django%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E4%B8%8E%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="Moon&#39;s Blog">
<meta property="og:description" content="该笔记记录了Django框架的语法学习以及开发">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511957.bmp">
<meta property="og:image" content="https://moonfordream.github.io/study/images/capture_20230314000410869.bmp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511959.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511960.bmp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511961.bmp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511962.bmp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511963.bmp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511964.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511965.png">
<meta property="article:published_time" content="2024-05-19T07:06:22.000Z">
<meta property="article:modified_time" content="2024-05-20T02:57:09.627Z">
<meta property="article:author" content="Moon">
<meta property="article:tag" content="Django">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511957.bmp">
  
  
  
  <title>Django框架学习与开发 - Moon&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"moonfordream.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Moon&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405190159278.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Django框架学习与开发"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-05-19 15:06" pubdate>
          2024年5月19日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          24k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          204 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Django框架学习与开发</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Django学习"><a href="#Django学习" class="headerlink" title="Django学习"></a>Django学习</h1><h2 id="常用命令："><a href="#常用命令：" class="headerlink" title="常用命令："></a>常用命令：</h2><h3 id="1、新建一个项目"><a href="#1、新建一个项目" class="headerlink" title="1、新建一个项目"></a><strong>1、新建一个项目</strong></h3>  <figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis">django-<span class="hljs-literal">admin</span> startproject 项目名<br></code></pre></td></tr></table></figure>



<h3 id="2、新建app-一个项目可以有多个app，通用的app也可以在多个项目中使用"><a href="#2、新建app-一个项目可以有多个app，通用的app也可以在多个项目中使用" class="headerlink" title="2、新建app (一个项目可以有多个app，通用的app也可以在多个项目中使用)"></a>2、新建app (一个项目可以有多个app，通用的app也可以在多个项目中使用)</h3>   <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> startapp app名   <br>   或者  django-admin.<span class="hljs-keyword">py</span> startapp app名<br></code></pre></td></tr></table></figure>



<h3 id="3、创建数据库表-或-更改数据库表或字段-可在SQL等数据库中创建与models-py代码对应的表"><a href="#3、创建数据库表-或-更改数据库表或字段-可在SQL等数据库中创建与models-py代码对应的表" class="headerlink" title="3、创建数据库表 或 更改数据库表或字段(可在SQL等数据库中创建与models.py代码对应的表)"></a>3、创建数据库表 或 更改数据库表或字段(可在SQL等数据库中创建与models.py代码对应的表)</h3><p>   <strong>创建更改的文件</strong></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> makemigrations<br></code></pre></td></tr></table></figure>

<p>   <strong>将生成的py文件应用到数据库</strong></p>
   <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> migrate<br></code></pre></td></tr></table></figure>

<h3 id="4、运行Django自带开发服务器"><a href="#4、运行Django自带开发服务器" class="headerlink" title="4、运行Django自带开发服务器"></a>4、运行Django自带开发服务器</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> runserver<br></code></pre></td></tr></table></figure>


<p>   <strong>公网访问：</strong></p>
   <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">python</span> manage.py runserver <span class="hljs-number">0.0.0.0:8000</span><br></code></pre></td></tr></table></figure>

<p><strong>本地访问：</strong></p>
   <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> runserver<br>   <span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> runserver <span class="hljs-number">8000</span><br>   <span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> runserver <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8000</span><br></code></pre></td></tr></table></figure>



<h3 id="5、清空数据库"><a href="#5、清空数据库" class="headerlink" title="5、清空数据库"></a>5、清空数据库</h3>   <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> flush<br></code></pre></td></tr></table></figure>



<h3 id="6、创建超级管理员"><a href="#6、创建超级管理员" class="headerlink" title="6、创建超级管理员"></a>6、创建超级管理员</h3><p>在创建前，得先执行<strong>python manage.py migrate</strong></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> createsuperuser<br></code></pre></td></tr></table></figure>


<p>   <strong>修改用户密码</strong></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> changepassword username<br></code></pre></td></tr></table></figure>



<h3 id="7、导入导出数据"><a href="#7、导入导出数据" class="headerlink" title="7、导入导出数据"></a>7、导入导出数据</h3><p>​      导入：</p>
  <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> loaddata app名.json<br></code></pre></td></tr></table></figure>

<p>   导出：</p>
   <figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">python manage.py dumpdata <span class="hljs-keyword">app</span>名 &gt;<span class="hljs-keyword">app</span>名.json<br></code></pre></td></tr></table></figure>

<h3 id="8、django-项目环境终端"><a href="#8、django-项目环境终端" class="headerlink" title="8、django 项目环境终端"></a>8、django 项目环境终端</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"> <span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> <span class="hljs-keyword">shell</span><br></code></pre></td></tr></table></figure>

<h3 id="9、数据库命令行"><a href="#9、数据库命令行" class="headerlink" title="9、数据库命令行"></a>9、数据库命令行</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> dbshell<br></code></pre></td></tr></table></figure>





<h2 id="视图层："><a href="#视图层：" class="headerlink" title="视图层："></a>视图层：</h2><h3 id="1-base64编码："><a href="#1-base64编码：" class="headerlink" title="1.base64编码："></a>1.base64编码：</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> base64,json<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    data=&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;uid&quot;</span>:<span class="hljs-number">10001</span>&#125;<br>    data_json=json.dumps(data).encode()<br>    <span class="hljs-built_in">print</span>(data_json) <span class="hljs-comment">#b&#x27;&#123;&quot;name&quot;: &quot;root&quot;, &quot;uid&quot;: 10001&#125;&#x27;</span><br>    <span class="hljs-comment">#编码，把二进制转换成编码字符</span><br>    base_data=base64.b64encode(data_json)<br>    <span class="hljs-built_in">print</span>(base_data)  <span class="hljs-comment">#b&#x27;eyJuYW1lIjogInJvb3QiLCAidWlkIjogMTAwMDF9&#x27;</span><br><br>    <span class="hljs-comment">#解码，把编码字符转换成二进制</span><br>    data1=<span class="hljs-string">&quot;eyJuYW1lIjogInJvb3QiLCAidWlkIjogMTAwMDF9&quot;</span><br>    bytes_data=base64.b64decode(data1).decode()<br>    <span class="hljs-comment">#转换成字符串</span><br>    <span class="hljs-built_in">print</span>(bytes_data)<br>    <span class="hljs-comment">#转换成字典</span><br>    dict_data=json.loads(bytes_data)<br>    <span class="hljs-built_in">print</span>(dict_data)<br></code></pre></td></tr></table></figure>



<h3 id="2-uuid"><a href="#2-uuid" class="headerlink" title="2.uuid :"></a>2.uuid :</h3><p> <strong>uuid - 匹配一个格式化的 UUID 。</strong><br><strong>为了防止多个 URL 映射到同一个页面，必须包含破折号并且字符都为小写。比如，075194d3-6885-417e-a8a8-6c931e272f00。返回	一个 UUID 实例。</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment">#通用唯一识别码，用于表示一个产品的生产码的时候使用</span><br>    <span class="hljs-comment">#在web开发中，uuid是非常常用的随机字符串，往往见于url地址上用于区分唯一，在用户信息表中用于区分唯一</span><br>    <span class="hljs-built_in">print</span>(uuid.uuid1())   <span class="hljs-comment">#1cdd50f0-6637-11ed-808e-709cd10a9410</span><br>   <span class="hljs-comment">#print(uuid.uuid3())</span><br>    <span class="hljs-built_in">print</span>(uuid.uuid4())<br>   <span class="hljs-comment">#print(uuid.uuid5())</span><br>   <span class="hljs-comment">#uuid3和uuid5都需要传入参数才能生成识别码</span><br></code></pre></td></tr></table></figure>



<h3 id="3-读取django配置："><a href="#3-读取django配置：" class="headerlink" title="3.读取django配置："></a>3.读取django配置：</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs PY"><span class="hljs-keyword">from</span> django.conf <span class="hljs-keyword">import</span> settings<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo3</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#读取django系统的配置,需要通过django.conf.settings对象来读取</span><br>    <span class="hljs-built_in">print</span>(settings.DEBUG)<br>    <span class="hljs-built_in">print</span>(settings.INSTALLED_APPS)<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;ok&#x27;</span>)<br></code></pre></td></tr></table></figure>



<h3 id="4-关于request对象："><a href="#4-关于request对象：" class="headerlink" title="4.关于request对象："></a>4.关于request对象：</h3><p><strong>request 是当用户请求django时，由wsgi.py中的application Web应用对象，会自动帮我们解析http请求的文本内容，并把对应的对象，赋值给request对象的.</strong><br><strong>request 对象是 django.core.handers.wsgi.WSGIRequest请求处理类的实例对象</strong><br><strong>WSGIRequest的父类是django.http.request.HttpRequest</strong><br><strong>在日常开发中，我们在django视图中使用request里面的绝大部分的属性方法都是继承于HttpRequest</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.core.handers.wsgi <span class="hljs-keyword">import</span> WSGIRequest<br><span class="hljs-keyword">from</span> django.http.request <span class="hljs-keyword">import</span> HttpRequest<br></code></pre></td></tr></table></figure>



<h3 id="5-会话控制："><a href="#5-会话控制：" class="headerlink" title="5.会话控制："></a>5.会话控制：</h3><p>从打开浏览器访问一个网站，到关闭浏览器结束此次访问，称之为一次会话</p>
<p>HTTP协议是无状态的，导致会话状态难以保持</p>
<p>Cookies和Session就是为了保持会话状态而诞生的两个存储技术</p>
<p><strong>Cookies</strong></p>
<p>cookies是保存在客户端浏览器上的存储空间，然后可以通过浏览器的开发者工具的application可以查看cookies的值</p>
<ul>
<li>cookies在浏览器上是以键-值对的形式进行存储的，键和值都是以ASCII字符串的形式存储(不能是中文字符串)</li>
<li>存储的数据带有生命周期</li>
<li>cookies中的数据是按域存储隔离的，不同的域之间无法访问</li>
<li>cookies的内部的数据会在每次访问此网址时都会携带到服务器端，如果cookies过大会降低响应速度</li>
</ul>
<p><strong>Session</strong></p>
<p>session是在服务器上开辟一段空间用于保留浏览器和服务器交互时的重要数据</p>
<p>实现方式：</p>
<ul>
<li>使用session需要在浏览器客户端启动cookie，且在cookie中存储sessionid</li>
<li>每个客户端都可以在服务器端有一个独立的Session</li>
<li>注意：不同的请求者之间不会共享这个数据，与请求者一一对应</li>
</ul>
<h4 id="实现会话控制的几种技术类型："><a href="#实现会话控制的几种技术类型：" class="headerlink" title="实现会话控制的几种技术类型："></a><strong>实现会话控制的几种技术类型：</strong></h4><ol>
<li><em><strong>url地址栏记录用户身份的参数[少见，很古老的技术了]</strong></em></li>
<li><em><strong>cookie：在浏览器中由浏览器自动读写保存用户信息的一种小文件，能够存储的数据有限。10M左右[过时了，谷歌在2021年开始慢慢关闭这个cookie技术]</strong></em></li>
<li><em><strong>session：在服务端中保存用户信息的一种小文件，能够存储的数据有限，根据服务端配置而定（需要掌握）</strong></em></li>
<li><em><strong>token令牌：就是一段可以记录和识别用户身份的字符串，通过客户端语言[js&#x2F;安卓&#x2F;ios]保存在客户端的一种技术</strong></em></li>
</ol>
<h4 id="cookie-了解就行-："><a href="#cookie-了解就行-：" class="headerlink" title="cookie(了解就行)："></a>cookie(了解就行)：</h4><h5 id="1-response-set-cookie-的参数列表："><a href="#1-response-set-cookie-的参数列表：" class="headerlink" title="1.**response.set_cookie()的参数列表："></a>1.**response.set_cookie()的参数列表：</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">*key，   变量名*<br>*value，变量值*<br>*max_age,   有效时间，单位:秒*<br><span class="hljs-number">*e</span>xpire，     过期的时间戳，单位也为秒[时间戳表示从1970-01-01 00:00:00至今的总秒数]*<br>*<span class="hljs-attribute">path</span>=None,    当前cookie是否只能在指定公共路径下使用，None表示在同一个域名下，任意路径都可以使用*<br><span class="hljs-number">*d</span><span class="hljs-attribute">omain</span>=None，  当前cookie是否只能在指定同一段域名下使用，None表示在当前服务器所在域名下使用*<br>*<span class="hljs-attribute">secure</span>=<span class="hljs-literal">False</span>，  当前cookie是否只能在https协议下使用，<span class="hljs-literal">False</span>表示在http协议下也能使用*<br>*<span class="hljs-attribute">httponly</span>=<span class="hljs-literal">False</span>，   当前cookie是否只能在http协议下使用，<span class="hljs-literal">False</span>表示在其他协议下也可以使用*<br></code></pre></td></tr></table></figure>



<h5 id="2-设置cookie"><a href="#2-设置cookie" class="headerlink" title="2.设置cookie:"></a>2.设置cookie:</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">setcookie</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#设置cookie</span><br>    response=HttpResponse(<span class="hljs-string">&#x27;OK&#x27;</span>)<br>    <span class="hljs-string">&#x27;&#x27;&#x27;通过http响应，设置cookie   </span><br><span class="hljs-string">    key，变量名</span><br><span class="hljs-string">    value，变量值</span><br><span class="hljs-string">    max_age,有效时间，单位:秒</span><br><span class="hljs-string">    expire，过期的时间戳，单位也为秒</span><br><span class="hljs-string">    # 如果cookie没有设置有效期，则默认当前cookie的有效期为本次会话时间内</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    response.set_cookie(key=<span class="hljs-string">&quot;name&quot;</span>,value=<span class="hljs-string">&quot;xiaoming&quot;</span>,max_age=<span class="hljs-number">30</span>)<br>    <span class="hljs-keyword">return</span> response<br><br></code></pre></td></tr></table></figure>



<h5 id="3-获取cookie"><a href="#3-获取cookie" class="headerlink" title="3.获取cookie:"></a>3.获取cookie:</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">getcookie</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#获取所有cookie</span><br>    <span class="hljs-string">&quot;&quot;&quot;因为cookie是由浏览器自动保管的，所以一旦客户端浏览器存在当前域名的cookie，</span><br><span class="hljs-string">    在每次客户端请求服务器时，浏览器都会自动把cookie附加请求头里面</span><br><span class="hljs-string">    在django中，可以通过request.COOKIES进行获取请求头中的cookie</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(request.COOKIES)<br>    <span class="hljs-comment">#获取指定变量名的cookie,尽量不使用中括号</span><br>    <span class="hljs-built_in">print</span>(request.COOKIES.get(<span class="hljs-string">&quot;name&quot;</span>))<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;hello&#x27;</span>)<br></code></pre></td></tr></table></figure>



<h5 id="4-删除cookie"><a href="#4-删除cookie" class="headerlink" title="4.删除cookie:"></a>4.删除cookie:</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">delcookie</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#删除cookie</span><br>    <span class="hljs-string">&quot;&quot;&quot;因为cookie是保存在客户端中的数据，因此在服务端中没有直接删除cookie的操作</span><br><span class="hljs-string">    一般的删除cookie操作是通过设置当前变量的值为任意值，同时设置当前变量的有效期为0</span><br><span class="hljs-string">    这样浏览器接收到响应的信息后，就会自动删除</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    response=HttpResponse(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>    <span class="hljs-comment">#默认，通过set_cookie删除cookie变量，仅仅删除一个，如果要批量删除，则通过遍历request.COOKIES来完成</span><br>    response.set_cookie(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,max_age=<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure>



<h4 id="session"><a href="#session" class="headerlink" title="session:"></a>session:</h4><h5 id="1-设置session"><a href="#1-设置session" class="headerlink" title="1.设置session:"></a>1.设置session:</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_session</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#设置session</span><br>    <span class="hljs-built_in">print</span>(request.session)<br>    request.session[<span class="hljs-string">&quot;uname&quot;</span>]=<span class="hljs-string">&quot;root&quot;</span><br>    request.session[<span class="hljs-string">&quot;uid&quot;</span>]=<span class="hljs-string">&quot;10001&quot;</span><br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;设置session数据&quot;</span>)<br><br></code></pre></td></tr></table></figure>



<h5 id="2-获取session数据"><a href="#2-获取session数据" class="headerlink" title="2.获取session数据:"></a>2.获取session数据:</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_session</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#获取所有session</span><br>    <span class="hljs-built_in">print</span>(request.session.items())  <span class="hljs-comment"># dict_items([(&#x27;uname&#x27;, &#x27;root&#x27;), (&#x27;uid&#x27;, &#x27;10001&#x27;)])</span><br>    <span class="hljs-comment">#获取指定变量的session数据</span><br>    <span class="hljs-built_in">print</span>(request.session.get(<span class="hljs-string">&quot;uid&quot;</span>))<br>    <span class="hljs-comment">#获取session数据的有效期，默认值是两周</span><br>    <span class="hljs-built_in">print</span>(request.session.get_session_cookie_age())<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;获取session数据&quot;</span>)<br></code></pre></td></tr></table></figure>



<h5 id="3-删除session"><a href="#3-删除session" class="headerlink" title="3.删除session:"></a>3.删除session:</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">del_session</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#删除session中指定变量的数据</span><br>    <span class="hljs-keyword">try</span>:<br>        request.session.pop(<span class="hljs-string">&quot;uid&quot;</span>)             <span class="hljs-comment">#防止一起使用报错</span><br>    <span class="hljs-keyword">except</span> KeyError:<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-comment">#删除当前域名下所有的session数据</span><br>    request.session.clear()<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;删除session数据&quot;</span>)<br></code></pre></td></tr></table></figure>





<h3 id="6-获取http请求数据"><a href="#6-获取http请求数据" class="headerlink" title="6.获取http请求数据:"></a>6.获取http请求数据:</h3><h4 id="1-获取查询字符串："><a href="#1-获取查询字符串：" class="headerlink" title="1.获取查询字符串："></a>1.获取查询字符串：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index2</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#查看request对象提供的属性</span><br>    <span class="hljs-built_in">print</span>(request)<br>    <span class="hljs-comment">#获取当前对象的属性和方法</span><br>    <span class="hljs-built_in">print</span>(request.__dir__())<br>    <span class="hljs-comment">#获取查询字符串，返回字典，GET是一个属性方法，被cached_property是django内部用于优化性能的一种方法</span><br>    <span class="hljs-built_in">print</span>(request.GET)<br>    <span class="hljs-string">&#x27;&#x27;&#x27;打印效果:&lt;QueryDict: &#123;&#x27;name&#x27;: [&#x27;xiaoming&#x27;], &#x27;password&#x27;: [&#x27;123456&#x27;]&#125;&gt;</span><br><span class="hljs-string">              QueryDict为参数集对象，因此对于QueryDict参数集的操作，我们完全可以基于字典的操作进行操作</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment">#获取查询字符串指定参数的单个值,直接使用中括号来获取数据，不存在的键会报错，所以我们可以用get</span><br>    <span class="hljs-built_in">print</span>(request.GET[<span class="hljs-string">&#x27;name&#x27;</span>])<br>    <span class="hljs-built_in">print</span>(request.GET.get(<span class="hljs-string">&#x27;name&#x27;</span>))<br>    <span class="hljs-comment">#如果查询字符串的参数有多个值，则需要使用getlist方法来获取数据</span><br>    <span class="hljs-built_in">print</span>(request.GET.getlist(<span class="hljs-string">&#x27;lve&#x27;</span>))<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;ok&#x27;</span>)<br></code></pre></td></tr></table></figure>



<h4 id="2-获取请求体数据："><a href="#2-获取请求体数据：" class="headerlink" title="2.获取请求体数据："></a>2.获取请求体数据：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index3</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#获取请求体数据</span><br>    <span class="hljs-string">&quot;&quot;&quot;只有post/put/patch具有请求体&quot;&quot;&quot;</span><br>    <span class="hljs-comment">#接收客户端提交的html表单数据</span><br>    <span class="hljs-built_in">print</span>(request.POST)<br>    <span class="hljs-comment">#request.POST无法接收上传文件，上传需要使用单独的属性来接收:request.FILES</span><br>    <span class="hljs-built_in">print</span>(request.FILES)          <span class="hljs-comment">#获取所有上传文件</span><br>    <span class="hljs-built_in">print</span>(request.FILES.get(<span class="hljs-string">&#x27;avatar&#x27;</span>))      <span class="hljs-comment">#这是一个文件上传处理对象</span><br>    <span class="hljs-comment">#上传文件</span><br>    <span class="hljs-comment">#import os</span><br>    <span class="hljs-comment">#avatar=request.FILES.get(&#x27;avatar&#x27;)</span><br>    <span class="hljs-comment">#with open(f&quot;&#123;os.path.dirname(__file__)&#125;/avatar.bmp&quot;,&#x27;wb+&#x27;) as f:</span><br>       <span class="hljs-comment"># f.write(avatar.read())</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;要获取表单以外的请求体数据，使用request.POST是行不通的，可以使用request.body来获取原生的请求体数据&#x27;&#x27;&#x27;</span><br>    <span class="hljs-built_in">print</span>(request.body)<br>    <span class="hljs-comment">#处理上传过来的json数据</span><br>    <span class="hljs-keyword">import</span> json<br>    <span class="hljs-built_in">print</span>(json.loads(request.body))<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;ok&#x27;</span>)<br></code></pre></td></tr></table></figure>



<h4 id="3-获取请求头数据："><a href="#3-获取请求头数据：" class="headerlink" title="3.获取请求头数据："></a>3.获取请求头数据：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index4</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#获取http请求头</span><br>    <span class="hljs-built_in">print</span>(request.META)     <span class="hljs-comment">#获取原生的请求头数据</span><br>    <span class="hljs-built_in">print</span>(request.headers)<br>    <span class="hljs-comment">#获取自定义的请求头，属于客户端开发人员自己声明的请求头</span><br>    <span class="hljs-built_in">print</span>(request.headers.get(<span class="hljs-string">&quot;company&quot;</span>))<br>    <span class="hljs-comment">#获取内部请求头</span><br>    <span class="hljs-built_in">print</span>(request.META.get(<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>))<br>    <span class="hljs-comment">#获取所有自定义的请求头，django会自动把客户端提交过来的请求头的参数名转换</span><br>    <span class="hljs-built_in">print</span>(request.META.get(<span class="hljs-string">&quot;HTTP_COMPANY&quot;</span>))<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;hello&#x27;</span>)<br></code></pre></td></tr></table></figure>



<h3 id="7-路由绑定："><a href="#7-路由绑定：" class="headerlink" title="7.路由绑定："></a>7.路由绑定：</h3><p><strong>当我们创建的视图和应用程序越来越多时，我们就需要用到include来进行路由绑定，使得我们不容易弄混</strong><br><strong>include用法:</strong><br><strong>#前提是你得在子目录中有建立存储关于子目录相关的url地址</strong><br><strong>在urls.py文件的urlpatterns写入:</strong><br><strong>from django.urls import path,include       #要导入include的包</strong><br><strong>例子模板：path(“公共url地址(又叫路由前缀)”,include(“子应用目录名.路由模块”))</strong></p>
<h4 id="1-路由进阶："><a href="#1-路由进阶：" class="headerlink" title="1.路由进阶："></a>1.路由进阶：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span>  path  普通路由，又是一个字符串路由<br><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> re_path   正则路由，会把url地址看成一个正则模式与客户端的请求url地址进行正则匹配<br><span class="hljs-comment">#正则路由</span><br>re_path(<span class="hljs-string">&quot;^profile/(?P&lt;pk&gt;[0-9]+)/moblie/(?P&lt;moblie&gt;1[3-9]\d&#123;9&#125;)/$&quot;</span>,views.profile),  <span class="hljs-comment">#?P&lt;&gt;是给正则表达式起别名</span><br>应用正则路由的视图函数:<br>例子：<span class="hljs-comment">#django中要求正则的路由中&lt;&gt;中的变量名，要作为参数传入视图函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">profile</span>(<span class="hljs-params">request,pk,moblie</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;pk=<span class="hljs-subst">&#123;pk&#125;</span>,moblie=<span class="hljs-subst">&#123;moblie&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;pk.type=<span class="hljs-subst">&#123;<span class="hljs-built_in">type</span>(pk)&#125;</span>,moblie.type<span class="hljs-subst">&#123;<span class="hljs-built_in">type</span>(moblie)&#125;</span>&quot;</span>)  <span class="hljs-comment">#pk.type=&lt;class &#x27;str&#x27;&gt;,moblie.type&lt;class &#x27;str&#x27;&gt;,为字符串类型</span><br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;获取用户信息&#x27;</span>)<br><br></code></pre></td></tr></table></figure>



<h4 id="2-路径转换器-内置的"><a href="#2-路径转换器-内置的" class="headerlink" title="2.路径转换器(内置的):"></a>2.路径转换器(内置的):</h4><ol>
<li><em>str - 匹配除了 ‘&#x2F;‘ 之外的非空字符串。如果表达式内不包含转换器，则会默认匹配字符串。</em></li>
<li><em>int - 匹配 0 或任何正整数。返回一个 int 。</em></li>
<li><em>slug - 匹配任意由 ASCII 字母或数字以及连字符和下划线组成的短标签。比如，building-your-1st-django-site 。</em></li>
<li><em>uuid - 匹配一个格式化的 UUID 。为了防止多个 URL 映射到同一个页面，必须包含破折号并且字符都为小写。比如，075194d3-6885-417e-a8a8-6c931e272f00。返回一个 UUID 实例。</em></li>
<li><em>path - 匹配非空字段，包括路径分隔符 ‘&#x2F;‘ 。它允许你匹配完整的 URL 路径而不是像 str 那样匹配 URL 的一部分。</em></li>
</ol>
<h5 id="1-在子路由文件下添加路由"><a href="#1-在子路由文件下添加路由" class="headerlink" title="(1).在子路由文件下添加路由:"></a>(1).在子路由文件下添加路由:</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#路由转换器  &lt;转换器调用别名:路径参数变量名&gt;</span><br>   path(<span class="hljs-string">&#x27;demo1/&lt;int:num&gt;&#x27;</span>,views.demo1),<br></code></pre></td></tr></table></figure>

<h5 id="2-视图层实例"><a href="#2-视图层实例" class="headerlink" title="(2).视图层实例:"></a>(2).视图层实例:</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo1</span>(<span class="hljs-params">request,num</span>):<br>    <span class="hljs-comment">#路由转换器  内置转换器</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;num=<span class="hljs-subst">&#123;num&#125;</span>,num_type=<span class="hljs-subst">&#123;<span class="hljs-built_in">type</span>(num)&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;ok&quot;</span>)<br></code></pre></td></tr></table></figure>



<h4 id="3-注册自定义的路径转换器"><a href="#3-注册自定义的路径转换器" class="headerlink" title="3.注册自定义的路径转换器:"></a>3.注册自定义的路径转换器:</h4><h5 id="1-在目录下写入注册自定义转换器"><a href="#1-在目录下写入注册自定义转换器" class="headerlink" title="(1).在目录下写入注册自定义转换器:"></a>(1).在目录下写入注册自定义转换器:</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.urls.converters <span class="hljs-keyword">import</span> StringConverter,register_converter<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MobileConverter</span>(<span class="hljs-title class_ inherited__">StringConverter</span>):<br>    regex = <span class="hljs-string">&#x27;1[3-9]\d&#123;9&#125;&#x27;</span><br><br>register_converter(MobileConverter,<span class="hljs-string">&#x27;mob&#x27;</span>)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">class MobileConverter(Object):</span><br><span class="hljs-string">    regex = &#x27;1[3-9]\d&#123;9&#125;&#x27;</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    def to_python(self,value):</span><br><span class="hljs-string">        #把路由上面的内容转换成python数据，并转换类型</span><br><span class="hljs-string">        #将匹配结果传递到视图内部时使用</span><br><span class="hljs-string">        return value</span><br><span class="hljs-string">        </span><br><span class="hljs-string">    def to_url(self,value):</span><br><span class="hljs-string">    #将匹配结果用于反向解析传值时使用</span><br><span class="hljs-string">        return value</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>



<h5 id="2-在目录中的urls-py文件进行导入自定义路由转换器，进行编写变量"><a href="#2-在目录中的urls-py文件进行导入自定义路由转换器，进行编写变量" class="headerlink" title="(2).在目录中的urls.py文件进行导入自定义路由转换器，进行编写变量:"></a>(2).在目录中的urls.py文件进行导入自定义路由转换器，进行编写变量:</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#自定义路由转换器</span><br>    path(<span class="hljs-string">&#x27;demo2/&lt;mob:mobile&gt;&#x27;</span>,views.demo2),<br></code></pre></td></tr></table></figure>



<h5 id="3-在视图层中编写视图函数使用自定义的路由转换器"><a href="#3-在视图层中编写视图函数使用自定义的路由转换器" class="headerlink" title="(3).在视图层中编写视图函数使用自定义的路由转换器:"></a>(3).在视图层中编写视图函数使用自定义的路由转换器:</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo2</span>(<span class="hljs-params">request,mobile</span>):<br>    <span class="hljs-comment">#自定义路由器</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;mobile=<span class="hljs-subst">&#123;mobile&#125;</span>,mobile.type=<span class="hljs-subst">&#123;<span class="hljs-built_in">type</span>(mobile)&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;ok&quot;</span>)<br></code></pre></td></tr></table></figure>



<h3 id="8-限制http请求"><a href="#8-限制http请求" class="headerlink" title="8.限制http请求:"></a>8.限制http请求:</h3><p><strong>常用的http请求：</strong></p>
<table>
<thead>
<tr>
<th align="center">1</th>
<th align="center">post</th>
<th align="center">添加&#x2F;上传</th>
</tr>
</thead>
<tbody><tr>
<td align="center">2</td>
<td align="center">get</td>
<td align="center">获取&#x2F;下载</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">put&#x2F;patch</td>
<td align="center">修改，其中put表示修改整体数据，而patch表示修改部分数据</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">delete</td>
<td align="center">删除&#x2F;废弃</td>
</tr>
</tbody></table>
<p><strong>可以限制http请求方法，来防止其他请求访问视图</strong></p>
<ul>
<li>网页中的状态代码一般应该显示2xx的数字表示ok</li>
<li>1xx表示特殊情况，表示请求没完成</li>
<li>3xx表示该页面被别人跳转了</li>
<li>4xx表示我们的客户端请求有问题</li>
<li>5xx表示我们请求的服务端出错了</li>
</ul>
<p><strong>例子：</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.views.decorators.http <span class="hljs-keyword">import</span> require_http_methods<br><span class="hljs-meta">@require_http_methods(<span class="hljs-params">[<span class="hljs-string">&quot;DELETE&quot;</span>]</span>)            </span><span class="hljs-comment">#请求方法要大写</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">drop</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-built_in">print</span>(request.method)      <span class="hljs-comment">#获取本次客户端的http请求方法</span><br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;删除数据&quot;</span><br></code></pre></td></tr></table></figure>



<h3 id="9-响应数据："><a href="#9-响应数据：" class="headerlink" title="9.响应数据："></a>9.响应数据：</h3><h4 id="1-响应html内容："><a href="#1-响应html内容：" class="headerlink" title="1.响应html内容："></a>1.响应html内容：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index5</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#响应html内容</span><br>    <span class="hljs-keyword">return</span> HttpResponse(content=<span class="hljs-string">&#x27;&lt;h1&gt;ok&lt;/h1&gt;&#x27;</span>,status=<span class="hljs-number">201</span>)  <span class="hljs-comment">#status为状态码，可以规定进入页面的状态码</span><br></code></pre></td></tr></table></figure>

<h4 id="2-响应json数据："><a href="#2-响应json数据：" class="headerlink" title="2.响应json数据："></a>2.响应json数据：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> django.http.response <span class="hljs-keyword">import</span> JsonResponse<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index6</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#响应json数据</span><br>    data=&#123;<br>        <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;xiaoming&quot;</span>,<br>        <span class="hljs-string">&quot;sex&quot;</span>:<span class="hljs-literal">True</span>,<br>        <span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">16</span><br>    &#125;<br>    <span class="hljs-comment">#data=json.dumps(data)</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;返回json数据，可以通过HttpResponse的属性:content_type来执行的MIME格式</span><br><span class="hljs-string">       content_type的默认值为  text/html</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment">#return HttpResponse(content=data,content_type=&quot;application/json&quot;)</span><br>    <span class="hljs-comment">#在django中HttpResponse提供了非常多的子类，其中就有一个子类，专门用于返回json数据的</span><br>    <span class="hljs-comment">#from django.http.response.JsonResponse</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;利用JsonResponse来返回json数据&#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment">#return JsonResponse(data=data)   #使用JsonResponse直接通过data属性设置数据即可，不需要设置content_type</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;JsonResponse返回非字典数据&#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment"># dt=[1,2,3]</span><br>    <span class="hljs-comment"># #当然，JsonResponse只能返回部分python内置的数据类型。如果是复杂的对象，资源是无法返回的。</span><br>    <span class="hljs-comment"># return JsonResponse(dt,safe=False)    #要想把非字典数据返回的话，需要把safe属性值改为False</span><br><br>    <span class="hljs-string">&#x27;&#x27;&#x27;关于JsonResponse返回中文等多字节数据时的编码问题&#x27;&#x27;&#x27;</span><br>    dt=&#123;<br>        <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;小明&quot;</span>,<br>        <span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">16</span><br>    &#125;<br>    <span class="hljs-comment"># 解决中文乱码问题，用json_dumps_params=&#123;&#x27;ensure_ascii&#x27;:False&#125;属性</span><br>    <span class="hljs-comment">#但是会不安全，在部分不支持中文的网络或服务器的环境下，容易出现乱码导致数据丢失</span><br>    <span class="hljs-keyword">return</span> JsonResponse(data=dt,json_dumps_params=&#123;<span class="hljs-string">&#x27;ensure_ascii&#x27;</span>:<span class="hljs-literal">False</span>&#125;)<br></code></pre></td></tr></table></figure>

<h4 id="3-返回图片信息："><a href="#3-返回图片信息：" class="headerlink" title="3.返回图片信息："></a>3.返回图片信息：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index7</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#返回图片信息</span><br>    <span class="hljs-comment">#web开发当中常见的图片格式: png,jpg(jpeg),gif,webp,svg,ico</span><br>    data=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;1.png&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>).read()<br>    <span class="hljs-keyword">return</span> HttpResponse(content=data,content_type=<span class="hljs-string">&#x27;image/png&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h4 id="4-下载文件信息："><a href="#4-下载文件信息：" class="headerlink" title="4.下载文件信息："></a>4.下载文件信息：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index8</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#下载文件信息</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;day.zip&quot;</span>,<span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>           data=f.read()<br>   <span class="hljs-keyword">return</span> HttpResponse(content=data,content_type=<span class="hljs-string">&#x27;application/zip&#x27;</span>)<br>    response=HttpResponse(content=data,content_type=<span class="hljs-string">&#x27;application/zip&#x27;</span>)<br>   给响应对象设置自定义响应头<br>    response[<span class="hljs-string">&#x27;company&#x27;</span>]=<span class="hljs-string">&quot;python310&quot;</span><br>   <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure>

<h4 id="5-页面跳转："><a href="#5-页面跳转：" class="headerlink" title="5.页面跳转："></a>5.页面跳转：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> redirect<br><span class="hljs-keyword">from</span> django.http.response <span class="hljs-keyword">import</span> HttpResponseRedirect<br><span class="hljs-comment">#redirect 页面跳转函数</span><br><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> reverse<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index9</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;页面跳转&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># #往站外跳转</span><br>     <span class="hljs-keyword">return</span> redirect(to=<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>)     <span class="hljs-comment">#地址必须加上协议,如http协议</span><br>    <span class="hljs-keyword">return</span> HttpResponseRedirect(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>)    <span class="hljs-comment">#也可以用这种方法，得导HttpResponseRedirect包</span><br></code></pre></td></tr></table></figure>

<h4 id="6-站内跳转："><a href="#6-站内跳转：" class="headerlink" title="6.站内跳转："></a>6.站内跳转：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#return redirect(to=&#x27;/home/index6&#x27;)</span><br>    <span class="hljs-comment">#reverse表示对视图进行逆向解析，获取当前视图名称对应的路由地址，也叫反向解析函数</span><br>    <span class="hljs-comment">#路由的path(&quot;url路径&quot;,视图函数,name=&quot;路由别名&quot;)</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;跳转到当前子应用下的指定路由别名对应的视图&#x27;&#x27;&#x27;</span><br>    <span class="hljs-keyword">return</span> redirect(reverse(<span class="hljs-string">&quot;index6&quot;</span>)) <span class="hljs-comment">#reverse的参数值就是视图名称在路由中的name参数，也叫路由别名</span><br><br>    <span class="hljs-comment"># &#x27;&#x27;&#x27;跳转到其他子应用下的指定路由别名对应的视图&#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment"># #congdangqian/home/index9 跳转到/user/info里面</span><br>    <span class="hljs-comment"># return redirect(&quot;/user/info&quot;)</span><br>    <span class="hljs-comment">#需要给子应用的路由前缀起一个别名，再结合子路由的别名进行跳转,再总路由中的include方法下给子路由的namespace赋值。</span><br>    <span class="hljs-comment">#例子:return redirect(reverse(&quot;us:user.info&quot;))      且需要在子路由文件中给app_name赋值</span><br></code></pre></td></tr></table></figure>



<h2 id="模板层："><a href="#模板层：" class="headerlink" title="模板层："></a>模板层：</h2><h3 id="1-django的数据库操作"><a href="#1-django的数据库操作" class="headerlink" title="1.django的数据库操作:"></a>1.django的数据库操作:</h3><h4 id="1，得先在命令行或者数据库图形化工具下进行创建用于django项目的数据库"><a href="#1，得先在命令行或者数据库图形化工具下进行创建用于django项目的数据库" class="headerlink" title="1，得先在命令行或者数据库图形化工具下进行创建用于django项目的数据库"></a>1，得先在命令行或者数据库图形化工具下进行创建用于django项目的数据库</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">###前提是得在djdemo的settings下设置数据库配置</span><br><span class="hljs-comment">#数据库配置</span><br>DATABASES = &#123;<br>    <span class="hljs-string">&#x27;default&#x27;</span>: &#123;<br>        <span class="hljs-string">&#x27;ENGINE&#x27;</span>: <span class="hljs-string">&#x27;django.db.backends.mysql&#x27;</span>,<br>        <span class="hljs-string">&#x27;NAME&#x27;</span>: <span class="hljs-string">&#x27;register_info&#x27;</span>,<br>        <span class="hljs-string">&#x27;USER&#x27;</span>:<span class="hljs-string">&#x27;root&#x27;</span>,<br>        <span class="hljs-string">&#x27;PASSWORD&#x27;</span>:<span class="hljs-string">&#x27;Acky16140563.&#x27;</span>,<br>        <span class="hljs-string">&#x27;HOST&#x27;</span>:<span class="hljs-string">&#x27;localhost&#x27;</span>,<br>        <span class="hljs-string">&#x27;POST&#x27;</span>:<span class="hljs-string">&#x27;3306&#x27;</span>,<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="2，得在model文件下定义数据库中的表类："><a href="#2，得在model文件下定义数据库中的表类：" class="headerlink" title="2，得在model文件下定义数据库中的表类："></a>2，得在model文件下定义数据库中的表类：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models<br><br><span class="hljs-comment"># Create your models here.</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RegisterUser</span>(models.Model):<br>    reg_username=models.CharField(max_length=<span class="hljs-number">100</span>,blank=<span class="hljs-literal">False</span>)<br>    reg_password=models.CharField(max_length=<span class="hljs-number">100</span>,blank=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure>

<h4 id="3-进行数据表的生成和迁移"><a href="#3-进行数据表的生成和迁移" class="headerlink" title="3.进行数据表的生成和迁移"></a>3.进行数据表的生成和迁移</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">###需要在终端上输入：</span><br> python manage.py makemigrations   <span class="hljs-comment">#在刚建的数据库中建立名为app_name的表</span><br>python manage.py migrate    <span class="hljs-comment">#把刚刚在model文件下定义的类的信息转换成数据库表中的列</span><br></code></pre></td></tr></table></figure>



<h3 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h3><ul>
<li><p><strong>‘’’ 变量 ‘’’：</strong><br><strong></strong></p>
</li>
<li><p><strong>‘’’ 注释 ‘’’：</strong></p>
<hr>
</li>
<li><p><strong>多行注释：</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;% comment %&#125;  注释开始语<br>	中间为注释<br>&#123;% endcomment %&#125;   注释结束语<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>‘’’ 标签 ‘’’：</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;% 标签名 %&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="模板层中显示变量"><a href="#模板层中显示变量" class="headerlink" title="模板层中显示变量"></a>模板层中显示变量</h4><p>视图层代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index2</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;模板中显示变量&quot;&quot;&quot;</span><br>    data1=(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)<br>    data2=[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]<br>    <span class="hljs-keyword">return</span> render(request,<span class="hljs-string">&#x27;index2.html&#x27;</span>,<span class="hljs-built_in">locals</span>())<br><br></code></pre></td></tr></table></figure>



<p>html代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>模板变量<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>data1=&#123;&#123; data1.1 &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>   &#123;# 获取元组的索引位置元素 django中的双花括号不能写小括号、中括号 #&#125;<br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>data2=&#123;&#123; data2|last &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>  &#123;# 过滤器，获取元组、列表最后一个元素，不能使用-1，只能使用过滤器 #&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<h4 id="if判断标签语法"><a href="#if判断标签语法" class="headerlink" title="if判断标签语法"></a>if判断标签语法</h4><p>视图层代码:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index4</span>(<span class="hljs-params">request</span>):<br>    book_list1=[<br>        &#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-number">10001</span>,<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;张三&quot;</span>&#125;,<br>        &#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-number">10002</span>,<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;李四&quot;</span>&#125;<br>    ]<br>    <span class="hljs-keyword">return</span> render(request,<span class="hljs-string">&#x27;index4.html&#x27;</span>,<span class="hljs-built_in">locals</span>())<br><br></code></pre></td></tr></table></figure>

<p>html代码:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">table</span>&#123;</span><br><span class="language-css">            <span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid red;</span><br><span class="language-css">            <span class="hljs-attribute">border-collapse</span>:collapse;</span><br><span class="language-css">            <span class="hljs-attribute">width</span>:<span class="hljs-number">800px</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">td</span>&#123;</span><br><span class="language-css">            <span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid red;</span><br><span class="language-css">            <span class="hljs-attribute">text-align</span>:center;</span><br><span class="language-css">        &#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>序号<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>编号<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        &#123;% for book in book_list1 %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; forloop.counter &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    //revcounter 为倒序计数<br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123;book.id&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123;book.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        &#123;% endfor %&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure>



<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;&#123; forloop.last &#125;&#125;<br>&#123;&#123; forloop.first &#125;&#125;  //进行标记判断，当是计数器为最后一个或者第一个时的返回值应该为true。<br><br>#取余<br>&#123;&#123;% if forloop.counter|divisibleby:2 %&#125;&#125;   //取余用到过滤器divisibleby:取余数；<br><br>#字典在循环中无法自行解包，  &#123;&#123;% for key,value in book_dict.items %&#125;&#125;;<br>#items 后面加上reversed进行左右变量的转换（反向循环字典或列表，元组）<br><br>#forloop.parentloop  //在嵌套循环中，指向当前循环的上级循环<br></code></pre></td></tr></table></figure>



<h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><p>过滤器本质就是函数[可以是python函数，也可以是开发者自定义函数]</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#单个无参数过滤器，变量默认作为过滤器的第一个参数，过滤器中return的内容作为结果被输出</span><br>&#123;&#123; 变量| 过滤器 &#125;&#125;<br><br><span class="hljs-comment">#单个有参数过滤器，参数1是变量，英文冒号后面跟着的参数按顺序依次使用英文逗号排列(默认过滤器除了变量，只有一个参数)</span><br>&#123;&#123; 变量|过滤器:参数<span class="hljs-number">2</span>&#125;&#125;<br><br><span class="hljs-comment">#多个无参数过滤器，每个|(竖杠)左边内容作为右边过滤器的默认第一参数</span><br>&#123;&#123; 变量|过滤器|过滤器<span class="hljs-number">2</span>|过滤器<span class="hljs-number">3</span>|.... &#125;&#125;<br><br><span class="hljs-comment">#多个有参数过滤器，每个过滤器的参数1是竖杠作为结果，最后一个过滤器返回结果被输出</span><br>&#123;&#123; 变量|过滤器<span class="hljs-number">1</span>:参数<span class="hljs-number">2</span> |过滤器<span class="hljs-number">2</span>:参数<span class="hljs-number">2</span> |.... &#125;&#125;<br></code></pre></td></tr></table></figure>



<p>filter(过滤器)本质就是一个函数，这种函数，允许我们直接在模板中使用。使用过滤器的情况一般就是希望在模板中对数据进行格式化处理或对数据进行规范输出和调整</p>
<p>文档：<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/3.2/ref/templates/builtins/#ref-templates-builitins-tags">https://docs.djangoproject.com/zh-hans/3.2/ref/templates/builtins/#ref-templates-builitins-tags</a></p>
<h5 id="内置过滤器"><a href="#内置过滤器" class="headerlink" title="内置过滤器"></a>内置过滤器</h5><p><strong>safe</strong>：</p>
<p>safe声明当前视图提供的数据中，html代码不需要进行实体字符转义 </p>
<p>如果来自客户端的留言等信息，在是否使用safe时，一定要考虑清楚，可以提前清楚script等不安全的标签</p>
<p>视图层代码</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index5</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;内置过滤器&#x27;&#x27;&#x27;</span><br>    content1=<span class="hljs-string">&quot;&gt;&quot;</span><br>    <span class="hljs-keyword">return</span> render(request,<span class="hljs-string">&#x27;index5.html&#x27;</span>,<span class="hljs-built_in">locals</span>())<br></code></pre></td></tr></table></figure>



<p>html代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    &#123;&#123; content1 &#125;&#125;<br>    &#123;&#123; content1 | safe &#125;&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>内置过滤器</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html">|      过滤器       |                    用法                    |              代码               |<br>| :---------------: | :----------------------------------------: | :-----------------------------: |<br>|       last        |        获取列表/元组的最后一个成员         |         &#123;&#123;list| last&#125;&#125;         |<br>|       first       |         获取列表/元组的第一个成员          |        &#123;&#123;list| first&#125;&#125;        |<br>|    **length**     |             **获取数据的长度**             |       &#123;&#123;list| length&#125;&#125;        |<br>|    **default**    |  **当变量没有值的情况下，系统输出默认值**  |   &#123;&#123;str| default=&quot;默认值&quot;&#125;&#125;   |<br>|     **safe**      | **让系统不要对内容的html代码进行实体转义** |     &#123;&#123;htmlcontent| safe&#125;&#125;     |<br>|       upper       |                字母转换大写                |        &#123;&#123;str| upper&#125;&#125;         |<br>|       lower       |               字母转换成小写               |        &#123;&#123;str| lower&#125;&#125;         |<br>|       title       |          每个单词首字母转换成大写          |        &#123;&#123;str| title&#125;&#125;         |<br>|     **date**      |            **日期时间格式转换**            |   &#123;&#123;value| date:&quot;D d M Y&quot;&#125;&#125;   |<br>|        cut        |        从内容中截取掉同样字符的内容        |    &#123;&#123;content| cut:&quot;helo&quot;&#125;&#125;    |<br>|      escape       |    把内容中的html特殊符号转换成实体字符    |      &#123;&#123;content| escape&#125;&#125;      |<br>|  filesizeformat   |       把文件大小的数值转换成单位表示       | &#123;&#123;filesize s| filesizeformat&#125;&#125; |<br>|     **join**      |           **按指定字符拼接内容**           |      &#123;&#123;list| join(&quot;-&quot;)&#125;&#125;       |<br>|      random       |              随机提取某个成员              |        &#123;&#123;list| random&#125;&#125;        |<br>|       slice       |               按切片提取成员               |      &#123;&#123;list| slice&quot;:-2&quot;&#125;&#125;      |<br>| **truncatechars** |           **按字符长度截取内容**           | &#123;&#123;content| truncatechars:30&#125;&#125;  |<br>|   truncatewords   |             按单词长度截取内容             | &#123;&#123;content| truncatewords:30&#125;&#125;  |<br><br></code></pre></td></tr></table></figure>



<p>示例代码：</p>
<p>视图层代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.utils <span class="hljs-keyword">import</span> timezone<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index5</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;内置过滤器&#x27;&#x27;&#x27;</span><br>    content1=<span class="hljs-string">&quot;&gt;&quot;</span><br>    content2=<span class="hljs-string">&quot;&lt;hello&gt;&quot;</span><br>    now=timezone.now()<br>    filesize=<span class="hljs-number">123456789</span><br>    area=[<span class="hljs-string">&#x27;河北省&#x27;</span>,<span class="hljs-string">&#x27;石家庄&#x27;</span>,<span class="hljs-string">&#x27;裕华区&#x27;</span>]<br>    menu=[<span class="hljs-string">&#x27;首页&#x27;</span>,<span class="hljs-string">&#x27;商品列表&#x27;</span>,<span class="hljs-string">&#x27;分类&#x27;</span>,<span class="hljs-string">&#x27;商品标题&#x27;</span>]<br>    <span class="hljs-keyword">return</span> render(request,<span class="hljs-string">&#x27;index5.html&#x27;</span>,<span class="hljs-built_in">locals</span>())<br></code></pre></td></tr></table></figure>



<p>html代码:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-class">.img</span>&#123;</span><br><span class="language-css">            max-weight: <span class="hljs-number">400px</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    &#123;&#123; content1 &#125;&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123; content1 | safe &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    &#123;&#123; title | default:&quot;hello&quot;  &#125;&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><br>    &#123;&#123; content2| escape &#125;&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123; now | date:&quot;Y\-M\-D H:i:s&quot;&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><br>    &#123;&#123;filesize| filesizeformat&#125;&#125;<br>    &#123;&#123;area | join:&quot;-&quot;&#125;&#125;<br>    &#123;&#123;menu| join:&quot;/&quot;&#125;&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123;area| random &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h5><p>customer filter</p>
<p>要声明自定义过滤器并且能在模板中正常使用，需要3个步骤。</p>
<ol>
<li><p>确保当前需要使用过滤器的子应用已经注册到了INSTALLED_APPS中。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py">INSTALLED_APPS = [<br>    <span class="hljs-string">&#x27;django.contrib.admin&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.auth&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.contenttypes&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.sessions&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.messages&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.staticfiles&#x27;</span>,<br>    <span class="hljs-string">&#x27;home&#x27;</span>,<br>    <span class="hljs-string">&#x27;user&#x27;</span>,<br>    <span class="hljs-string">&#x27;tem&#x27;</span>,   <span class="hljs-comment">#模板引擎</span><br>    <span class="hljs-string">&#x27;login&#x27;</span>,<br>]<br></code></pre></td></tr></table></figure>


</li>
<li><p>编写过滤器，过滤器必须在子应用下的templatetags包(如果子应用目录下没有，就自己创建)里面创建对应的python文件中。tem.templatetags.my_filters.py的代码如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django <span class="hljs-keyword">import</span> template<br><br>register=template.Library()<br><br><span class="hljs-comment">#自定义过滤器</span><br><span class="hljs-comment">#@register.filter(&quot;过滤器别名&quot;)</span><br><span class="hljs-meta">@register.filter(<span class="hljs-params"><span class="hljs-string">&quot;mobile&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">moblie_filter</span>(<span class="hljs-params">content,flag=<span class="hljs-string">&quot;****&quot;</span></span>):  <span class="hljs-comment">#过滤器必须要有一个以上的参数，提供给模板调用</span><br>    <span class="hljs-keyword">return</span> content[:<span class="hljs-number">3</span>]+flag+content[-<span class="hljs-number">3</span>:]<br><span class="hljs-comment">#必须要有返回值，否则模板中没有内容显示</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>在模板中通过load标签加载当前子应用已经声明的过滤器函数，load标签的使用最好写在模板的第一行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;% load my_filter %&#125;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123; content3 | mobile:&quot;新年快乐&quot; &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> &#123;# 传入变量给过滤器中进行自定义更换隐私字符 #&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h4><h5 id="模板分离"><a href="#模板分离" class="headerlink" title="模板分离"></a>模板分离</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">django中提供了&#123;% include &quot;模板文件名&quot; %&#125;标签模板分离技术<br></code></pre></td></tr></table></figure>

<p>视图层代码</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index6</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;模板分离-文章列表页面&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">return</span> render(request,<span class="hljs-string">&#x27;index6.html&#x27;</span>,<span class="hljs-built_in">locals</span>())<br></code></pre></td></tr></table></figure>

<p>模板层:</p>
<ul>
<li>公共页面代码（header）</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.header</span>&#123;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>:<span class="hljs-number">88px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">background-color</span>: aquamarine;</span><br><span class="language-css">    &#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span><br>        公共的头部html代码<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>分离的独特内容页面代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;% include &quot;header.html&quot; %&#125;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.main</span>&#123;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>:<span class="hljs-number">200px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">text-align</span>: center;</span><br><span class="language-css">        <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#f00</span>;</span><br><span class="language-css">    &#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;main&quot;</span>&gt;</span><br>        列表页独有的内容<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p>其实模板分离，这种方式，虽然达到了页面代码复用的效果，但是由此也会带来大量的碎片化模板，导致维护模板的成本上升。</p>
<p>因此，大部分框架中除了提供这种模板分离技术以外，还并行的提供了<strong>模板继承</strong>给开发者。</p>
<h5 id="模板继承-主要使用"><a href="#模板继承-主要使用" class="headerlink" title="模板继承(主要使用)"></a>模板继承(主要使用)</h5><p>模板继承可以用block标签把该文件页面独有的代码(子模板)继承公共部分(父模版)，这样就不用因为公共部分(父模版)的随意变化导致的文件过多</p>
<ol>
<li><p>显示子模版的时候，继承父模板的公共内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;% extends &quot;base.html&quot; %&#125; &#123;# base.html 为父模板 #&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>视图层代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index7</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;模板继承-用户页面&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> render(request,<span class="hljs-string">&#x27;index7.html&#x27;</span>,<span class="hljs-built_in">locals</span>())<br></code></pre></td></tr></table></figure>


</li>
<li><p>模板层代码：</p>
<p>父模板：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-class">.header</span>&#123;</span><br><span class="language-css">            <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;</span><br><span class="language-css">            <span class="hljs-attribute">background-color</span>: orange;</span><br><span class="language-css">            <span class="hljs-attribute">text-align</span>: center;</span><br><span class="language-css">        &#125;</span><br><span class="language-css">        <span class="hljs-selector-class">.main</span>&#123;</span><br><span class="language-css">            <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;</span><br><span class="language-css">            <span class="hljs-attribute">background-color</span>: lightsteelblue;</span><br><span class="language-css">            <span class="hljs-attribute">text-align</span>: center;</span><br><span class="language-css">        &#125;</span><br><span class="language-css">        <span class="hljs-selector-class">.footer</span>&#123;</span><br><span class="language-css">            <span class="hljs-attribute">height</span>: <span class="hljs-number">15px</span>;</span><br><span class="language-css">            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ff0</span>;</span><br><span class="language-css">            <span class="hljs-attribute">text-align</span>: center;</span><br><span class="language-css">        &#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span><br>        公共头部<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;main&quot;</span>&gt;</span><br>        &#123;% block  main %&#125;  &#123;# 子模版可以通过声明block的变量名进行覆盖这片区域 #&#125;<br>            主体内容<br>        &#123;% endblock main %&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer&quot;</span>&gt;</span><br>        公共脚部<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>子模版:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;% extends &quot;base.html&quot; %&#125;<br>&#123;% block main %&#125;<br>    index7.html的主题内容<br>&#123;% endblock main %&#125;<br></code></pre></td></tr></table></figure>

<p><em><strong>也可以在父模板中用block标签写出默认值内容，然后再在子模版中用block标签把独特的内容将默认值覆盖，也可以用block进行标记，然后如果需要添加内容，也可以通过block添加内容</strong></em></p>
</li>
<li><p>block.super</p>
<p>block标签中的super可以进行在block标签中引用没被覆盖时的内容(必须得用两个{})</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;% extends &quot;base.html&quot; %&#125;<br>&#123;% block main %&#125;<br>&lt;-- 可以通过&#123;&#123;block.super&#125;&#125;重新获取被覆盖的父模板内容 --&gt;<br>    &#123;&#123; block.super &#125;&#125;<br>    index7.html的主题内容<br>&#123;% endblock main %&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;main&quot;</span>&gt;</span><br>        &#123;% block  main %&#125;  &#123;# 子模版可以通过block的名字进行覆盖这片区域 #&#125;<br>            主体内容<br>        &#123;% endblock main %&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="使用模板层的三个步骤"><a href="#使用模板层的三个步骤" class="headerlink" title="使用模板层的三个步骤"></a>使用模板层的三个步骤</h3><p>django框架中使用模板引擎把视图中的数据更好的展示给客户端，需要三个步骤：</p>
<ul>
<li>在项目配置文件中指定保存模板文件的模板目录。(一般模板目录都是设置在项目根目录或者主应用目录下)</li>
<li>在视图中基于django提供的渲染函数绑定模板文件和需要展示的数据变量</li>
<li>在模板目录下创建对应的模板文件，并根据模板引擎内置的模板语法，填写输出视图传递过来的数据</li>
</ul>
<h4 id="1-配置模板目录"><a href="#1-配置模板目录" class="headerlink" title="1.配置模板目录:"></a>1.配置模板目录:</h4><ul>
<li><p><strong>手动在djdemo中创建一个普通目录templates</strong></p>
</li>
<li><p><strong>然后在settings.py中的模板引擎配置TEMPLATES中模板目录列表’DIRS’中添加templates的路径，用BASE_DIR&#x2F;进行拼接</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-string">&#x27;DIRS&#x27;</span>: [<br>            BASE_DIR/<span class="hljs-string">&#x27;templates&#x27;</span>,<br>        ],<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>在子应用定义列表INSTALLED_APPS 中注册子应用</strong></p>
</li>
</ul>
<h4 id="2-绑定模板文件"><a href="#2-绑定模板文件" class="headerlink" title="2.绑定模板文件:"></a>2.绑定模板文件:</h4><ul>
<li><p><strong>在子应用目录下手动创建urls.py子路由文件，并往里面写入几行代码:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path,re_path<br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views<br><br>urlpatterns=[<br>    <br>]<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>在总路由文件中写入子路由文件变量</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">path(<span class="hljs-string">&#x27;tem/&#x27;</span>,include(<span class="hljs-string">&#x27;tem.urls&#x27;</span>))<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>创建一个存储模板(html)文件的目录，并根据模板引擎内置的模板语法，填写输出视图传递过来的数据</strong><br><strong>模板文件:</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    &#123;# django模板中的注释内容 #&#125;<br>    &#123;&#123; title &#125;&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>视图函数编写</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render<br><span class="hljs-keyword">from</span> django.template.loader <span class="hljs-keyword">import</span> get_template<br><span class="hljs-keyword">from</span> django.http.response <span class="hljs-keyword">import</span> HttpResponse<br><span class="hljs-comment"># Create your views here.</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index1</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#模板引擎的基本使用</span><br>    data=&#123;&#125;<br>    title=<span class="hljs-string">&quot;模板引擎的基本使用&quot;</span><br>    data[<span class="hljs-string">&quot;title&quot;</span>]=title<br>    <span class="hljs-comment">#return render(request,&quot;index1.html&quot;,context=&#123;&quot;title&quot;:title&#125;)</span><br>    <span class="hljs-comment">#return render(request,&quot;index1.html&quot;,data)</span><br>    <span class="hljs-comment">#return render(request,&quot;index1.html&quot;,locals())  #通过locals()获取当前函数中所有信息，收集成一个字典，并传参给模板</span><br>    <span class="hljs-comment">#基于settings,py中配置的模板引擎获取DIRS配置的模板文件，转换成Template模板对象</span><br>    template=get_template(<span class="hljs-string">&quot;index1.html&quot;</span>)<br>    <span class="hljs-comment">#调用模板对象提供的render函数，把本次客户端的请求对象和视图中数据data传参到模板文件中，进行渲染</span><br>    <span class="hljs-comment">#将来如果要对模板中的内容进行数据缓存[cache],可以对content进行保存起来，将来如果直接读取content的话，</span><br>    <span class="hljs-comment"># 则django就不需要操作数据库或者进行渲染，因为模板渲染的过程就是正则替换的过程</span><br>    content=template.render(data,request)<br>    <span class="hljs-keyword">return</span> HttpResponse(content)<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h3><p>开发中在开启了debug模式时，django可以通过配置，允许用户通过对应的url地址访问django的静态文件。(必须手动创建)</p>
<p>settings.py 中代码:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py">STATIC_URL = <span class="hljs-string">&#x27;/static/&#x27;</span><br>STATICFILES_DIRS = ( os.path.join(BASE_DIR,<span class="hljs-string">&#x27;static&#x27;</span>), )<br>或者：<br>STATICFILES_DIRS = [ BASE_DIR / <span class="hljs-string">&#x27;static&#x27;</span> ]<br></code></pre></td></tr></table></figure>

<p>注意:<br>项目上线以后，关闭debug模式时，django默认是不提供静态文件的访问支持，项目部署的时候，我们会通过收集静态文件使用nginx这种web服务器来提供静态文件的访问支持。</p>
<h2 id="视图进阶"><a href="#视图进阶" class="headerlink" title="视图进阶"></a>视图进阶</h2><p>新建一给子应用，cbv。接下来在这个子应用下面，我们学习类视图的操作。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> startapp cbv<br></code></pre></td></tr></table></figure>

<p>在setting.py配置文件中注册子应用，setting.py, 代码:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py">INSTALLED_APPS=[<br>    <span class="hljs-comment">#....省略</span><br>    <span class="hljs-string">&quot;cbv&quot;</span>,<br>]<br></code></pre></td></tr></table></figure>



<p>创建子应用的路由文件，cbv.urls,代码:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path <br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views<br>urlpatterns=[<br><br>]<br></code></pre></td></tr></table></figure>

<p>在总路由中进行子路由文件的注册。 ‘djdemo.urls ‘,代码</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">path(<span class="hljs-string">&quot;cbv/&quot;</span>,include(<span class="hljs-string">&quot;cbv.urls&quot;</span>))<br></code></pre></td></tr></table></figure>





<h3 id="类视图"><a href="#类视图" class="headerlink" title="类视图"></a>类视图</h3><p>Class Base View，简称”CBV”，与我们之前编写的视图函数不同，类视图是类的结构编写视图代码的。可以让我们实现相关业务代码的整合。同时还在函数视图的基础上，可以实现对于客户端访问的http请求进行分流和限制。</p>
<h4 id="类视图的基本定义"><a href="#类视图的基本定义" class="headerlink" title="类视图的基本定义"></a>类视图的基本定义</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render<br><span class="hljs-comment"># Create your views here.</span><br><span class="hljs-comment">#1.类视图必须直接或间接继承于django.views.View</span><br><span class="hljs-comment">#2.在django的类视图中，所有提供给外界用户访问的视图方法名必须是http请求动作的小写名称</span><br><span class="hljs-comment">#  也就是说，方法名只能是 get,post,put,patch,delete ...</span><br><span class="hljs-comment">#3.使用类视图，可以有效的减少路由绑定代码</span><br><span class="hljs-comment">#  3.1 可以直接通过视图方法名就可以达到限制客户端访问当前视图方法的http请求</span><br><span class="hljs-comment">#  3.2 客户端访问对应的URL地址就会来到视图类中，访问这个地址所使用的http请求，就是将来视图类自动执行的方法</span><br><span class="hljs-comment">#  3.3 有了类视图，我们可以把多个函数视图的公共代码进行抽离或者封装成一个函数进行调用，有利于代码复用</span><br><span class="hljs-comment">#4. 同一个视图类中，方法名不能出现重复</span><br><span class="hljs-keyword">from</span> django.views <span class="hljs-keyword">import</span> View<br><span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexView</span>(<span class="hljs-title class_ inherited__">View</span>):<br>    <span class="hljs-comment">#类视图的公共方法/公共属性</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ret</span>(<span class="hljs-params">self,request,data</span>):<br>        <span class="hljs-built_in">print</span>(request.method) <span class="hljs-comment">#在类视图中，不仅可以通过视图方法中的参数，接收路由传递过来的请求对象，还可以通过self.request来获取客户端路由转发过来的请求对象</span><br>        <span class="hljs-keyword">return</span> HttpResponse(data)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self,request</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;只允许通过get请求访问，建议编写读取数据的页面，例如：首页，列表页。。。&quot;&quot;&quot;</span><br>        <span class="hljs-comment">#视图中的视图方法,与原来的函数视图中的代码是一模一样的。原来怎么写的，现在就怎么写</span><br>        <span class="hljs-keyword">return</span> self.ret(request,<span class="hljs-string">&#x27;hello&#x27;</span>)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self,request</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;只允许通过post请求访问，一般用于上传，添加数据的页面&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> self.ret(request,<span class="hljs-string">&#x27;hello&#x27;</span>)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">put</span>(<span class="hljs-params">self,request</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;只允许通过put请求访问，一般用于修改，更新数据的页面&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> self.ret(request, <span class="hljs-string">&#x27;hello&#x27;</span>)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">self,request</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;只允许通过patch请求访问，一般用于修改，更新数据的页面&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> self.ret(request, <span class="hljs-string">&#x27;hello&#x27;</span>)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">self,request</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;只允许用delete请求访问，一般用于处理删除数据的页面&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> self.ret(request, <span class="hljs-string">&#x27;hello&#x27;</span>)<br></code></pre></td></tr></table></figure>



<h4 id="类视图的路由绑定"><a href="#类视图的路由绑定" class="headerlink" title="类视图的路由绑定"></a>类视图的路由绑定</h4><p>调用as_view的本质，就是调用内部的view视图函数	</p>
<p>进入内部通过dispatch函数进行路由分发，通过请求方法，获取到请求的视图函数的同名方法</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path<br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views<br><span class="hljs-comment">#在django中，路由只识别函数视图，对于类视图，我们必须要通过as_view()帮我们把类的视图方法转换成函数视图</span><br>urlpatterns=[<br>    <span class="hljs-comment">#path(&#x27;index/&#x27;,views.IndexView.as_view())</span><br>    <span class="hljs-comment">#as_view()帮我们把类的视图方法转换成函数视图</span><br>    path(<span class="hljs-string">&#x27;index/&#x27;</span>,views.IndexView.as_view())<br>]<br></code></pre></td></tr></table></figure>



<h3 id="视图基类的基本使用"><a href="#视图基类的基本使用" class="headerlink" title="视图基类的基本使用"></a>视图基类的基本使用</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">自定义基类视图</span><br><span class="hljs-string">视图基类，可以专门封装一些公共的属性或者方法，提供给将来开发的时候，用于完成特定业务的。</span><br><span class="hljs-string">这也可以封装成一个个视图基类，然后让具体的视图类直接继承，就不需要重复编写这些代码</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiView</span>(<span class="hljs-title class_ inherited__">View</span>):<br>    <span class="hljs-comment"># 可以把没有参数的类方法，转换成普通属性来调用</span><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">data</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;用于接受并转换json数据成字典&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># print(self.request.META)</span><br>        ct = self.request.META.get(<span class="hljs-string">&quot;CONTENT_TYPE&quot;</span>)<br>        <span class="hljs-comment"># print(f&quot;ct=&#123;ct&#125;&quot;)</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;multipart/form-data&#x27;</span> <span class="hljs-keyword">in</span> ct:<br>            <span class="hljs-string">&quot;&quot;&quot;表单上传数据(允许上传文件)&quot;&quot;&quot;</span><br>            <span class="hljs-keyword">return</span> self.request.POST.<span class="hljs-built_in">dict</span>()<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span> <span class="hljs-keyword">in</span> ct:<br>            <span class="hljs-string">&quot;&quot;&quot;表单上传数据&quot;&quot;&quot;</span><br>            <span class="hljs-keyword">return</span> self.request.POST.<span class="hljs-built_in">dict</span>()<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;application/json&#x27;</span> <span class="hljs-keyword">in</span> ct:<br>            <span class="hljs-keyword">try</span>:<br>                data = json.loads(self.request.body)<br>                <span class="hljs-keyword">return</span> data<br>            <span class="hljs-keyword">except</span> Exception:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HomeView</span>(<span class="hljs-title class_ inherited__">ApiView</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self,request</span>):<br>        <span class="hljs-built_in">print</span>(self.data)<br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;ok&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">put</span>(<span class="hljs-params">self,request</span>):<br>        <span class="hljs-built_in">print</span>(self.data)<br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;ok&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">self,request</span>):<br>        <span class="hljs-built_in">print</span>(self.data)<br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;ok&quot;</span>)<br></code></pre></td></tr></table></figure>



<h4 id="视图基类的相关扩展"><a href="#视图基类的相关扩展" class="headerlink" title="视图基类的相关扩展"></a>视图基类的相关扩展</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py">在django提供的视图类View使用中，还提供了一些视图子类。<br>不过这块内容需要结合diango的数据库操作才可以使用，所以我们后面再来学习。<br>视图子类是django为了方便开发者快速提供基于不同http请求视图而提供的。<br><br><span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView,DetailView,CreateView,UpdateView,DeleteView<br><br>ListView: 列表视图，可以通过get请求访问，用于展示列表数据，内置了分页功能<br>DetailView: 详情视图，可以通过get请求访问，用于展示单个数据<br>CreateView: 添加视图，可以通过get/post请求访问，用于添加单个数据<br>UpdateView: 更新视图，可以通过get/post请求访问，用于更新单个数据<br>DeleteView: 删除视图，可以通过get请求访问，用于删除单个数据<br></code></pre></td></tr></table></figure>





<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><p>MiddleWare，是通过Django请求&#x2F;响应处理的钩子框架。它是一个轻量级的、低级的“插件”系统，用于全局改变Django的输入输出。[输入指代的就是客户端向服务端django发送数据，输出指代django根据客户端要求处理数据的结果返回给客户端]</p>
<p>钩子就是编程开发的一个术语，hook，钩子可以理解为一段代码(要么是类，要么是函数)，它的作用就类似日常生活中墙上的钩子，不需要的时候，挂在墙上不会占用房子的空间，但是需要的时候我们可以把一些物件挂在上面。</p>
<p>这种中间件在平时不使用情况下不会耗费任何的性能，如果编写了中间件以后，可以在特定的条件下，全局执行！！</p>
<p>文档:<a href="">https://docs.djangoproject.com/zh-hans/3.2/topics/http/middleware</a></p>
<h3 id="内置中间件"><a href="#内置中间件" class="headerlink" title="内置中间件"></a>内置中间件</h3><p>django框架内部声明了很多的中间件，这些中间件有着各种各样的用途，有些没有被使用，有些被默认开启使用了。而被开始使用的中间件，都是settings.py的MIDDLEWARE中注册使用的</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#中间件,全局的钩子，django在接收请求和响应数据都会自动的执行一遍这里的代码。</span><br>MIDDLEWARE = [<br>    <span class="hljs-string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>, <span class="hljs-comment">#安全监测相关的中间件，防止页面过期，js跨站脚本攻击xss</span><br>  <span class="hljs-string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>, <span class="hljs-comment">#session加密和读取和保存session相关</span><br>    <span class="hljs-string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>, <span class="hljs-comment">#通用中间件，用于给url进行重写，自动给URL后面加上/</span><br>    <span class="hljs-string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>, <span class="hljs-comment">#防止网站遭到csrf攻击</span><br>    <span class="hljs-string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>, <span class="hljs-comment">#用户认证的中间件</span><br>    <span class="hljs-string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>, <span class="hljs-comment">#错误提示信息的中间件【提示错误信息，一次性提示】</span><br>    <span class="hljs-string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>, <span class="hljs-comment">#用于防止点击劫持攻击的iframe标签</span><br>]<br></code></pre></td></tr></table></figure>

<h3 id="Csrf攻击"><a href="#Csrf攻击" class="headerlink" title="Csrf攻击"></a>Csrf攻击</h3><p>跨站请求伪造，Cross-site request forgery，利用用户在不知情的情况下实现伪造表单提交给服务端进行攻击的手段。</p>
<p><strong>csrf攻击原理</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511957.bmp" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>django中提供了一个Csrfmiddleware的中间件给开发者用于防止网站用户遭到这种攻击收发。</p>
<p>中间件主要是每次客户端通过post，patch，put等方式提交数据操作时，判断当前表单是否是隐藏了一个csrf_token的随机字符串令牌。如果有这个随机字符串。则中间件则会判断这个随机字符串是否由服务端提供的。</p>
<p>我们开发者只需要在每一个表单页面中，内置一个隐藏的输入框里面填写csrf_token则可以让当前页面的表单顺利提交数据到后台</p>
<blockquote>
<p>csrf_token的生成是每次都是基于服务端的密钥进行随机生成的，所以如果没有密钥的情况下，则生成的随机token令牌则会轻易被django识别到。</p>
</blockquote>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="hljs-template-variable">&#123;&#123;csrf_token&#125;&#125;</span><span class="language-xml">  #可以获取csrf的token，但是是会显现在页面中</span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">csrf_token</span></span> %&#125;</span><span class="language-xml"> #可以获取csrf的token，这个是隐形的，不会显现在屏幕中</span><br><span class="language-xml">在视图函数中可以通过request.user可以获取当前登录该后台的用户名</span><br><span class="language-xml"></span><br><span class="language-xml">将来我们使用ajax以json的方式提交数据，则不能使用</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">csrf_token</span></span> %&#125;</span><span class="language-xml">,只能使用</span><span class="hljs-template-variable">&#123;&#123; csrf_token &#125;&#125;</span><span class="language-xml">在json数据里面了</span><br></code></pre></td></tr></table></figure>







<h3 id="GZIP压缩"><a href="#GZIP压缩" class="headerlink" title="GZIP压缩"></a>GZIP压缩</h3><p>压缩所有现代浏览器的响应，节省宽带和传输时间</p>
<p>注意，GzipMiddleware目前被认为是一种安全风险，并且容易TSL&#x2F;SSL提供的保护无效的攻击。</p>
<p>setting.py，代码:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#中间件,全局的钩子，django在接收请求和响应数据都会自动的执行一遍这里的代码。</span><br>MIDDLEWARE = [<br>    <span class="hljs-string">&#x27;django.middleware.gzip.GZipMiddleware&#x27;</span>, <span class="hljs-comment">#实际工作中，我们往往采用web服务器来实现gzip压缩</span><br>    <span class="hljs-string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,<br>]<br></code></pre></td></tr></table></figure>



<h3 id="自定义中间件"><a href="#自定义中间件" class="headerlink" title="自定义中间件"></a>自定义中间件</h3><p>django中提供了2种不同的中间件声明方式。主要在django1.9或者2.0出现</p>
<h4 id="函数式中间件"><a href="#函数式中间件" class="headerlink" title="函数式中间件"></a>函数式中间件</h4><p>在项目的主应用目录下创建一个专门存放中间件函数的模块 主应用djdemo&#x2F;my_middleware.py 代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py">MIDDLEWARE = [<br>    <span class="hljs-string">&#x27;django.middleware.gzip.GZipMiddleware&#x27;</span>, <span class="hljs-comment">#实际工作中，我们往往采用web服务器来实现gzip压缩</span><br>    <span class="hljs-string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;djdemo.my_middleware.user_source_middleware&#x27;</span>,  <span class="hljs-comment">#注册自己的中间件[不管是函数式中间件还是类中间件都是这样注册的]</span><br>]<br></code></pre></td></tr></table></figure>

<p>因为中间件一旦注册了以后，会在全局生效，所以我们访问任何一个视图都可以看到中间件执行的过程。</p>
<h4 id="类中间件"><a href="#类中间件" class="headerlink" title="类中间件"></a>类中间件</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.utils.deprecation <span class="hljs-keyword">import</span> MiddlewareMixin  <span class="hljs-comment">#混入类，一般用于声明类的公共部分代码或公共属性的</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomMiddleware</span>(<span class="hljs-title class_ inherited__">MiddlewareMixin</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_request</span>(<span class="hljs-params">self,request</span>):<br>        <span class="hljs-comment">#方法名是固定的，该方法会在用户请求访问路由解析完成以后，调用试图之前自动执行</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[类中间件] 客户端ip地址=&quot;</span>, request.META.get(<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>))  <span class="hljs-comment"># 获取本次客户端的请求地址</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[类中间件] 1.process_request在路由解析以后，产生request对象，视图执行之前，会执行这个方法&quot;</span>)<br>        <span class="hljs-comment">#用途:权限，路由分发，cdn，用户身份识别，白名单，黑名单....</span><br>        <span class="hljs-comment">#注意，此方法不能使用return，使用则会报错！！！</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_view</span>(<span class="hljs-params">self,request,view_func,view_args,view_kwagrs</span>):<br>        <span class="hljs-comment">#用途: 进行缓存处理，识别参数，根据参数查询是否建立缓存</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[类中间件] 2.process_view在视图中接受了参数以后，没有执行内部代码之前&quot;</span>)<br>        <span class="hljs-comment">#可以返回response对象，如果返回reponse对象以后，则当前对应的视图函数将不会执行</span><br>        <span class="hljs-comment">#return HttpResponse(&quot;ok&quot;)</span><br>        <span class="hljs-comment">#也可以不返回response，则默认返回None，django就会自动执行视图函数</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_response</span>(<span class="hljs-params">self,request,response</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[类中间件] 4.process_response在视图执行之后，才执行的&quot;</span>)<br>        <span class="hljs-comment">#用途: 记录操作历史，记录访问历史，修改返回给客户端的数据，建立缓存</span><br>        <span class="hljs-comment">#必须返回response对象，否则报错！！</span><br>        <span class="hljs-keyword">return</span> response<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_exception</span>(<span class="hljs-params">self,request,exception</span>):<br>        <span class="hljs-built_in">print</span>(exception)<br>        <span class="hljs-comment">#用途: 进行异常的处理或者记录错误日志</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3. process_exception会在视图执行发生异常的时候才会执行&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_template_response</span>(<span class="hljs-params">self,request,response</span>):   <span class="hljs-comment">#知道一下就行了</span><br>        <span class="hljs-comment">#用途: 建立页面缓存</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;5.process_template_response只有在视图调用了模板之后，才会执行！！！&quot;</span>)<br>        <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure>



<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>常用数据库两大阵营:</p>
<ol>
<li><p>关系数据库[RDB]: 数据库中存储数据的表之间存在某种内在的关联关系，因为这种关系，所以我们称这一类型数据为关系型数据库。</p>
<p>共同的特点: 都使用了SQL语句进行数据库操作。</p>
<p>常见的数据库: mysql[MariaDB], PostgreSQL, Oracle, MSServer, DB2. sqlite, Access</p>
</li>
<li><p>非关系型数据库[Nosql]: 泛指那些不适用SQL语句进行数据库操作的所有其他数据库。Redis，MongoDB，Memcached，Elasticsearch&#x2F;Sphinx&#x2F;Solr，HBase&#x2F;CouchDB</p>
</li>
</ol>
<p>耦合性：类似成语里面的藕断丝连，表示2段程序之间的关联性和依赖性的强度。</p>
<p>工作中要追求代码的低藕性，就是降低2段程序之间的关联性和依赖性。 高内聚低耦合</p>
<h3 id="ORM框架"><a href="#ORM框架" class="headerlink" title="ORM框架"></a>ORM框架</h3><p>O是object，也就是类对象的意思。</p>
<p>R是relation，翻译成中文是关系，也就是关系数据库中<strong>数据表</strong>的意思</p>
<p>M是mapping，是映射的意思。</p>
<p>ORM框架会帮我们把类对象和数据表进行一对一的映射，让我们可以<strong>通过类对象来操作对应的数据表。</strong></p>
<p>ORM框架还可以<strong>根据我们设计的类自动帮我们生成数据库中的表格</strong>，省去了自己建表的过程。</p>
<p>django中内嵌了ORM框架，不需要直接编写SQL语句进行数据库操作，而是通过定义模型类，操作模型类来完成对数据库中表中的数据的增删改查和数据表创建等操作。</p>
<h4 id="ORM的优点"><a href="#ORM的优点" class="headerlink" title="ORM的优点"></a>ORM的优点</h4><blockquote>
<ul>
<li>数据模型类都在一个地方定义，更容易更新和维护，也有利于重用代码。</li>
<li>ORM有现成的工具，很多功能都可以自动完成，比如数据消除、预处理、事务等等。</li>
<li>它迫使你使用MVC架构，ORM就是天然的Model，最终使代码更清晰。</li>
<li>基于ORM的业务代码比较简单，代码最少，语义性好，容易理解。</li>
<li>新手对于复杂业务容易写出性能不佳的SQL，有了ORM不必编写复杂的SQL语句，只需要通过操作模型对象即可同步修改数据表中的数据。</li>
<li>开发中应用ORM将来如果要切换数据库，只需要切换ORM底层对接数据库的驱动【修改配置文件的连接地址即可】</li>
</ul>
</blockquote>
<h4 id="ORM缺点"><a href="#ORM缺点" class="headerlink" title="ORM缺点"></a>ORM缺点</h4><blockquote>
<ul>
<li>ORM库不是轻量级工具，需要花很多精力学习和设置，甚至不同的框架，会存在不同操作的ORM。</li>
<li>对于复杂的业务查询，ORM表达起来比原生的SQL要更加困难和复杂。</li>
<li>ORM操作数据库的i性能要比原生的SQL差。[ORM内部要拼接SQL语句]</li>
<li>ORM抽象掉了数据库层，开发者无法了解底层的数据库操作，也无法定制一些特殊的SQL。【自己使用pymysql另外操作即可，用了ORM并表示当前项目不能使用别的数据库操作工具了。】</li>
</ul>
</blockquote>
<h4 id="配置数据库连接"><a href="#配置数据库连接" class="headerlink" title="配置数据库连接"></a>配置数据库连接</h4><p>在setting.py中保存了数据库的连接配置信息，Django默认初始配置使用sqlite数据库。</p>
<p>我们可以通过一下步骤来使用django的数据库操作</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-number">1.</span>配置数据库连接信息<br><span class="hljs-number">2.</span>在子应用的<span class="hljs-keyword">models</span>.py中定义模型类<br><span class="hljs-number">3.</span>生成数据库迁移文件并执行迁移文件[注意：数据迁移是一个独立的功能，这个功能在其他web框架未必和ORM一块的]<span class="hljs-comment">//不是必要的，有些公司，直接由DBA(数据管理员)创建数据表的，那么就不需要数据迁移了。</span><br><span class="hljs-number">4.</span>通过模型类对象提供的方法或属性完成数据表的增删改查操作<br></code></pre></td></tr></table></figure>

<ol>
<li><p>使用MySQL数据库首先需要安装驱动程序</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> pymysql<br></code></pre></td></tr></table></figure>
</li>
<li><p>在django的主应用目录的_init_.py文件中添加如下语句</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pymysql <span class="hljs-keyword">import</span> install_as_MySQLdb<br><br>install_as_MySQLdb()<span class="hljs-comment">#让pymysql以MySQLDB的运行模式和Django的ORM对接运行</span><br></code></pre></td></tr></table></figure>

<p>作用是让Django的ORM能以mysqldb的方式调用pymysql</p>
</li>
<li><p>修改database配置信息，setting.py配置文件配置数据库连接信息。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs py">DATABASES = &#123;<br>    <span class="hljs-string">&#x27;default&#x27;</span>: &#123;<br>        <span class="hljs-string">&#x27;ENGINE&#x27;</span>: <span class="hljs-string">&#x27;django.db.backends.mysql&#x27;</span>,<br>        <span class="hljs-string">&#x27;NAME&#x27;</span>: <span class="hljs-string">&#x27;register_info&#x27;</span>,<br>        <span class="hljs-string">&#x27;USER&#x27;</span>:<span class="hljs-string">&#x27;root&#x27;</span>,<br>        <span class="hljs-string">&#x27;PASSWORD&#x27;</span>:<span class="hljs-string">&#x27;Acky16140563.&#x27;</span>,<br>        <span class="hljs-string">&#x27;HOST&#x27;</span>:<span class="hljs-string">&#x27;localhost&#x27;</span>,<br>        <span class="hljs-string">&#x27;POST&#x27;</span>:<span class="hljs-string">&#x27;3306&#x27;</span>,<br>        <span class="hljs-string">&#x27;POOL_OPTIONS&#x27;</span>:&#123;        <span class="hljs-comment">#数据库连接池配置</span><br>            <span class="hljs-string">&#x27;POOL_SIZE&#x27;</span>: <span class="hljs-number">10</span>,    <span class="hljs-comment">#默认情况下，打开的数据库连接的数量</span><br>            <span class="hljs-string">&#x27;MAX_OVERFLOW&#x27;</span>: <span class="hljs-number">10</span>  <span class="hljs-comment">#负载情况下，允许溢出的连接数量</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>在mysql中创建数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> database school;  #mysql8<span class="hljs-number">.0</span>默认就是utf8mb4<br><span class="hljs-keyword">create</span> database school <span class="hljs-keyword">default</span> charset<span class="hljs-operator">=</span>utf8mb4; #mysql8<span class="hljs-number">.0</span>之前的版本<br></code></pre></td></tr></table></figure>

<h4 id="mysql5-7，django3-0以下版本，错误解决"><a href="#mysql5-7，django3-0以下版本，错误解决" class="headerlink" title="mysql5.7，django3.0以下版本，错误解决"></a>mysql5.7，django3.0以下版本，错误解决</h4><p><strong>数据库兼容问题</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#错误提示</span><br>django.db.utils.ProgrammingError:(<span class="hljs-number">1064</span>,<span class="hljs-string">&quot;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED&#x27; at line 1&quot;</span>)<br><br><span class="hljs-comment">#解决方案</span><br><span class="hljs-comment">#在settings.py的database选项中每一个数据库连接加上OPTIONS选项配置</span><br>DATABASES = &#123;<br>    <span class="hljs-string">&#x27;default&#x27;</span>: &#123;<br>        <span class="hljs-string">&#x27;ENGINE&#x27;</span>: <span class="hljs-string">&#x27;django.db.backends.mysql&#x27;</span>,<br>        <span class="hljs-string">&#x27;NAME&#x27;</span>: <span class="hljs-string">&#x27;register_info&#x27;</span>,<br>        <span class="hljs-string">&#x27;USER&#x27;</span>:<span class="hljs-string">&#x27;root&#x27;</span>,<br>        <span class="hljs-string">&#x27;PASSWORD&#x27;</span>:<span class="hljs-string">&#x27;Acky16140563.&#x27;</span>,<br>        <span class="hljs-string">&#x27;HOST&#x27;</span>:<span class="hljs-string">&#x27;localhost&#x27;</span>,<br>        <span class="hljs-string">&#x27;POST&#x27;</span>:<span class="hljs-string">&#x27;3306&#x27;</span>,<br>        <span class="hljs-string">&#x27;POOL_OPTIONS&#x27;</span>:&#123;        <span class="hljs-comment">#数据库连接池配置</span><br>            <span class="hljs-string">&#x27;POOL_SIZE&#x27;</span>: <span class="hljs-number">10</span>,    <span class="hljs-comment">#默认情况下，打开的数据库连接的数量</span><br>            <span class="hljs-string">&#x27;MAX_OVERFLOW&#x27;</span>: <span class="hljs-number">10</span>  <span class="hljs-comment">#负载情况下，允许溢出的连接数量</span><br>        &#125;,<br>        <span class="hljs-string">&#x27;OPTIONS&#x27;</span>:&#123;<br>        	<span class="hljs-string">&#x27;isolation_level&#x27;</span>: <span class="hljs-literal">None</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="定义模型类"><a href="#定义模型类" class="headerlink" title="定义模型类"></a>定义模型类</h4><ul>
<li>模型类被定义在”子应用&#x2F;models.py”文件中</li>
<li>模型类必须直接或者间接继承自django.db.models.Model类</li>
</ul>
<p>在子应用目录下的models.py文件中定义模型类</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models<br><span class="hljs-comment">#字段选项</span><br>SEX_CHOICES=(<br>	(<span class="hljs-number">0</span>,<span class="hljs-string">&quot;保密&quot;</span>)，<br>    (<span class="hljs-number">1</span>，<span class="hljs-string">&quot;男&quot;</span>),<br>    (<span class="hljs-number">2</span>,<span class="hljs-string">&quot;女&quot;</span>),<br>)<br><br><span class="hljs-comment"># Create your models here.</span><br><span class="hljs-comment">#自定义的模型类，每一个类就对应着一个数据表，类名建议与表名关联</span><br><span class="hljs-comment">#模型类必须直接或间接继承于 django.db.models.MOdel</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RegisterUser</span>(models.Model):<br> <span class="hljs-comment">#模型中声明Meta用于表信息的相关内容</span><br> <span class="hljs-comment">#db_table 用于设置当前模型类对应的数据表是哪一张，如果不设置，则表名对应为&quot;子应用名_模型类名&quot;.lower()</span><br> <span class="hljs-comment">#class Meta:</span><br><span class="hljs-comment">#	db_table=&quot;student&quot;  </span><br><span class="hljs-comment">#设置表名的中文提示</span><br><span class="hljs-comment">#verbose_name=&quot;学生信息&quot;</span><br><span class="hljs-comment">#verbose_name_plural=verbose_name  #设置当前复述情况下，中文提示</span><br><span class="hljs-comment">#字段映射</span><br><span class="hljs-built_in">id</span>= models.AUtoField()  <span class="hljs-comment">#主键，这个主键id，默认情况下，我们不需要在模型类显式声明，django会自动帮我们补充，同时还会给id设置一个调用别名叫:pk</span><br><span class="hljs-comment">#age=models.SmallIntegerField(db_index=True) db_index设置索引</span><br><span class="hljs-comment">#sex=models.BooleanField(default=0,choices=SEX_CHOICES) bool值字段</span><br>reg_username=models.CharField(max_length=<span class="hljs-number">100</span>,blank=<span class="hljs-literal">False</span>) reg_password=models.CharField(max_length=<span class="hljs-number">100</span>,blank=<span class="hljs-literal">False</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LessonTable</span>(models.Model):<br>    day1=models.CharField(max_length=<span class="hljs-number">255</span>,blank=<span class="hljs-literal">False</span>)<br>    day2=models.CharField(max_length=<span class="hljs-number">255</span>,blank=<span class="hljs-literal">False</span>)<br>    day3=models.CharField(max_length=<span class="hljs-number">255</span>,blank=<span class="hljs-literal">False</span>)<br>    day4=models.CharField(max_length=<span class="hljs-number">255</span>,blank=<span class="hljs-literal">False</span>)<br>    day5=models.CharField(max_length=<span class="hljs-number">255</span>,blank=<span class="hljs-literal">False</span>)<br>    day6=models.CharField(max_length=<span class="hljs-number">255</span>,blank=<span class="hljs-literal">False</span>)<br>    day7=models.CharField(max_length=<span class="hljs-number">255</span>,blank=<span class="hljs-literal">False</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MusicTable</span>(models.Model):<br>    music_url=models.CharField(max_length=<span class="hljs-number">255</span>,blank=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseModel</span>(models.Model):<br>    <span class="hljs-comment">#auto_now_add=True 表示当前时间对象作为默认值存储在数据表中</span><br>    created_time=models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>)<br>    <span class="hljs-comment">#auto_now=True 表示当前数据创建/修改时，采用当前时间对象作为默认值存储在数据表中</span><br>    updated_time=models.DateTimeField(auto_now=<span class="hljs-literal">True</span>)<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>        <span class="hljs-comment">#设置当前模型为抽象模型，也就是说，这个模型不会被django当前一个数据表对应的模型，而是当成一个普通的类</span><br></code></pre></td></tr></table></figure>

<p><strong>db_table</strong> 用于设置当前模型类对应的数据表是哪一张，如果不设置，则表名对应为**”子应用名_模型类名”.lower()**</p>
<h5 id="2）关于主键"><a href="#2）关于主键" class="headerlink" title="2）关于主键"></a><strong>2）关于主键</strong></h5><p>django会为模型自动声明一个自动增长的主键列，每个模型只能有一个主键列</p>
<p>如果使用选项设置某个字段的约束属性为主键列后，django不会再创建自动增长的主键列</p>
<p>默认创建的主键列属性为id，可以用pk代替</p>
<h5 id="3）属性命名规则"><a href="#3）属性命名规则" class="headerlink" title="3）属性命名规则"></a><strong>3）属性命名规则</strong></h5><ul>
<li><p>不能是python的关键字或保留字</p>
</li>
<li><p>不允许使用连续的2个下划线，这是由django的查询方式决定的。__是关键字来的，不能使用！！！</p>
</li>
<li><p>定义属性时需要指定字段类型，通过字段类型的参数指定选项，语法如下:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py">属性名=models.字段类型(约束选项,verbose_name=<span class="hljs-string">&quot;注释&quot;</span>)<br><br><span class="hljs-comment">#在mysql数据表中的字段名如果在python是一个关键字/保留字。则选项中需要通过db_column()来进行关联绑定</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="4）字段类型"><a href="#4）字段类型" class="headerlink" title="4）字段类型"></a><strong>4）字段类型</strong></h5><table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>AutoField</td>
<td>自动增长的IntegerField，通常不用指定，不指定时django会自动创建属性名为id的自动增长属性，并且提供一个PK属性与主键进行关联</td>
</tr>
<tr>
<td>BooleanField</td>
<td>布尔类型，值为True或False</td>
</tr>
<tr>
<td>NullBooleanField</td>
<td>支持Null、True、False三种值</td>
</tr>
<tr>
<td>CharField</td>
<td>字符串，参数max_length表示最大字符个数，对应mysql中的varchar</td>
</tr>
<tr>
<td>TextField</td>
<td>大文本字段，一般大段文本(超过4000个字符)才使用</td>
</tr>
<tr>
<td>IntegerField</td>
<td>整数</td>
</tr>
<tr>
<td>DecimalField</td>
<td>十进制浮点数，参数max_digits表示总位数，参数decimal_places表示小数位数，常用于表示分数和价格 Decimal(max_digits&#x3D;7,decimal_places&#x3D;2)&#x3D;&#x3D;&gt;99999.99~0.00</td>
</tr>
<tr>
<td>FloatField</td>
<td>浮点数</td>
</tr>
<tr>
<td>ImageField</td>
<td>继承于FileField，对上传的内容进行校检，确保是有效的图片</td>
</tr>
</tbody></table>
<h5 id="5）约束选项"><a href="#5）约束选项" class="headerlink" title="5）约束选项"></a><strong>5）约束选项</strong></h5><table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>null</td>
<td>如果为True，表示允许为空，默认值是False。相当于python的None</td>
</tr>
<tr>
<td>blank</td>
<td>如果为True，则该字段允许为空白，默认值是False。相当于python的空字符串，””</td>
</tr>
<tr>
<td>db_column</td>
<td>数据表中真实的字段的名称，如果未指定，则使用属性的名称</td>
</tr>
<tr>
<td>db_index</td>
<td>若值为True，则在表中会为此字段创建索引，默认值是False。相当于SQL语句中的key</td>
</tr>
<tr>
<td>default</td>
<td>默认值，当不填写数据时，使用该选项的值作为数据的默认值</td>
</tr>
<tr>
<td>primary_key</td>
<td>如果为True，则该字段会成为模型的主键，默认值是False，一般不用设置，系统默认设置</td>
</tr>
<tr>
<td>unique</td>
<td>如果为True，咋该字段在表中必须有唯一值，默认值是False。相当于SQL语句中的unique</td>
</tr>
<tr>
<td>verbose_name</td>
<td>设置此字段在admin界面上的显示名称</td>
</tr>
</tbody></table>
<p><strong>注意:null是数据库范畴的概念，blank是表单验证范畴</strong></p>
<p>修改过字段选项【添加或更改】均要执行makemigrations和migrate</p>
<h5 id="Meta类"><a href="#Meta类" class="headerlink" title="Meta类"></a><strong>Meta类</strong></h5><p>使用模型类内部Meta类来给模型赋予属性</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#模型中声明Meta用于表信息的相关内容</span><br> <span class="hljs-comment">#db_table 用于设置当前模型类对应的数据表是哪一张，如果不设置，则表名对应为&quot;子应用名_模型类名&quot;.lower()</span><br> <span class="hljs-comment">#class Meta:</span><br><span class="hljs-comment">#	db_table=&quot;student&quot;</span><br></code></pre></td></tr></table></figure>

<h4 id="ORM操作"><a href="#ORM操作" class="headerlink" title="ORM操作"></a>ORM操作</h4><p>ORM的基本操作的核心是模型类的管理器对象</p>
<h5 id="管理器对象-增加数据"><a href="#管理器对象-增加数据" class="headerlink" title="管理器对象(增加数据)"></a><strong>管理器对象(增加数据)</strong></h5><p>每个继承自models.Model的模型类，都会有一个objects对象被同样继承下来。这个对象叫管理器对象</p>
<p>数据库的增删改查可以通过模型的管理器实现</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMode1</span>(models.Model):<br>.......<br><span class="hljs-comment">#objects是管理器对象</span><br><span class="hljs-comment">#方法一</span><br>MyModel.objects.create(属性<span class="hljs-number">1</span>=值<span class="hljs-number">1</span>,属性<span class="hljs-number">2</span>=值<span class="hljs-number">2</span>,...) <span class="hljs-comment">#成功后会返回创建好的实体对象，失败则会抛出异常</span><br><br><span class="hljs-comment">#方法二,创建MyModel实例对象，并调用save()进行保存</span><br>obj=MyModel(属性=值,属性=值)<br>Obj.属性=值<br>obj.save()<br><br><br></code></pre></td></tr></table></figure>



<h5 id="Django-Shell"><a href="#Django-Shell" class="headerlink" title="Django Shell"></a><strong>Django Shell</strong></h5><p>在Django提供了一个交互式的操作项目叫Django Shell 它能够在交互模式用项目工程的代码执行相应的操作</p>
<p>利用Django Shell 可以替代编写view的代码来进行直接操作</p>
<p>注意：项目代码发生变化时，重新进入Django Shell</p>
<p>启动方式：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">python manage.py shell<br></code></pre></td></tr></table></figure>

<p>使用方法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> 要操作的应用名称.models <span class="hljs-keyword">import</span> 你要操作的模型类<br><span class="hljs-keyword">from</span> login.models <span class="hljs-keyword">import</span> RegisterUser <br><span class="hljs-comment">#然后即可在此模型类的表中插入数据</span><br><span class="hljs-comment">#方法一</span><br>r1=RegisterUser.<span class="hljs-built_in">object</span>.create(属性=值...)<br><span class="hljs-comment">#方法二</span><br>r2=RegisterUser(属性=值....)<br>r2.save()<br></code></pre></td></tr></table></figure>

<h5 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a><strong>查询操作</strong></h5><ol>
<li><p>all()方法</p>
<p>用法：MyModel.objects.all()</p>
<p>作用：查询MyModel实体中所有的数据</p>
<p>等同于select * from table</p>
<p>返回值：QuerySet容器对象(可以把它当作一个数组)，内部存放MyModel实例对象</p>
</li>
<li><p>可以在模型类中定义下划线_str_下划线方法，自定义QuerySet中的输出格式例如</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_str_</span>(<span class="hljs-params">self</span>):<br>	<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;%s_%s_%s_%s&#x27;</span>%(self.title,self.price...)<span class="hljs-comment">#自定义的输出格式</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>values(‘列1’,’列2’)方法</p>
<p>用法：MyModel.objects.values(…)</p>
<p>作用：查询部分列的数据并返回</p>
<p>等同于select 列1,列2 from xxx</p>
<p>返回值： QuerySet，返回查询结果容器，容器内存字典，每个字典代表一条数据，格式为{‘列1’:值1,’列2’:值2}</p>
</li>
<li><p>values_list(‘列1’,’列2’…)</p>
<p>用法：MyModel.objects.values_list(….)</p>
<p>作用：返回元组形式的查询结果</p>
<p>等同于select 列1,列2 from xxx</p>
<p>返回值：QuerySet容器对象，内部存放元组</p>
<blockquote>
<p>会将查询出来的数据封装到元组中，在封装到查询集合QuerySet中</p>
</blockquote>
</li>
<li><p>order_by()</p>
<p>用法：MyModel.objects.order_by(‘列’,’’列)</p>
<p>作用： 与all()方法不同，它会用SQL语句的ORDER BY子句对查询结果进行根据某个字段选择性的进行排序</p>
<p>说明：默认是按照升序排序，降序排序则需要在列前增加’-‘表示</p>
</li>
</ol>
<h5 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h5><ol>
<li><p>filter(条件)</p>
<p>语法：MyModel.objects.filter(属性1&#x3D;值1,属性2&#x3D;值2)</p>
<p>作用：返回包含此条件的全部数据集</p>
<p>返回值：QuerySet容器对象，内部存放MyModel实例</p>
<p>说明：当多个属性在一起时为”与”关系</p>
</li>
<li><p>get(条件)</p>
<p>语法：MyModel.objects.get(条件)</p>
<p>作用：返回满足条件的唯一一条数据</p>
<p>说明：该方法只能返回一条数据，查询结果多于一条数据则抛出Model.MultipleObjectsReturned异常，查询结果如果没有数据则抛出Model.DoesNotExist异常</p>
</li>
<li><p><strong>查询谓词</strong></p>
<p>定义：做更灵活的条件查询时需要使用查询谓词</p>
<p>说明：每一个查询谓词是一个独立的查询功能</p>
<ul>
<li><strong>(字段)__exact：等值匹配</strong></li>
</ul>
<p>示例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">Author.objects.<span class="hljs-built_in">filter</span>(id__exact=<span class="hljs-number">1</span>)<br><span class="hljs-comment">#等同于select * from author where id = 1</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong>__contains：包含指定值</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">Author.objects.<span class="hljs-built_in">filter</span>(name__contains=<span class="hljs-string">&#x27;w&#x27;</span>)<br><span class="hljs-comment">#等同于select * from author where name like &#x27;%w%&#x27;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>__startswith：以xxx开始</p>
</li>
<li><p>__endswith：以xxx结束</p>
</li>
<li><p>__gt：大于指定值</p>
<p>样例:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">Author.objects.<span class="hljs-built_in">filter</span>(age__gt=<span class="hljs-number">50</span>)<br><span class="hljs-comment">#等同于select * from author where age &gt; 50</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>__gte：大于等于指定值</p>
</li>
<li><p>__lt：小于</p>
</li>
<li><p>__lte：小于等于</p>
</li>
<li><p>__in：查找数据是否在指定范围内</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">Author.objects.<span class="hljs-built_in">filter</span>(countyr__in=[<span class="hljs-string">&#x27;中国&#x27;</span>,<span class="hljs-string">&#x27;日本&#x27;</span>,<span class="hljs-string">&#x27;韩国&#x27;</span>]) <span class="hljs-comment">#等同于select * from author where country in (&#x27;中国&#x27;,&#x27;日本&#x27;,&#x27;韩国&#x27;)</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>__range：查找数据是否在指定的区间范围内</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#查找年龄在某一区间内的所有作者</span><br>Author.objects.<span class="hljs-built_in">filter</span>(age__range=(<span class="hljs-number">35</span>,<span class="hljs-number">50</span>))<br><span class="hljs-comment">#等同于 select ... where Author between 35 and 50;</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h5 id="更新操作"><a href="#更新操作" class="headerlink" title="更新操作"></a>更新操作</h5><p><strong>1）更新单个数据</strong></p>
<ol>
<li><p>查</p>
<p>​	-通过get()得到要修改的实体对象</p>
</li>
<li><p>改</p>
<p>​	-通过对象.属性的方式修改数据</p>
</li>
<li><p>保存</p>
<p>​	-通过对象.save()保存数据</p>
</li>
</ol>
<p><strong>2）批量更新数据</strong></p>
<p>直接调用QuerySet的update(属性&#x3D;值)实现批量修改</p>
<p>示例:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#将id大于3的所有图书价格定为0元</span><br>books=Book.objects.<span class="hljs-built_in">filter</span>(id__gt=<span class="hljs-number">3</span>)<br>books.update(price=<span class="hljs-number">0</span>)<br><span class="hljs-comment">#将所有书的零售价定为100元</span><br>books=Book.objects.<span class="hljs-built_in">all</span>()<br>books.update(market_price=<span class="hljs-number">100</span>)<br></code></pre></td></tr></table></figure>



<h5 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h5><p><strong>1）单个数据删除</strong></p>
<ol>
<li><p>查找查询结果对应的一个数据对象</p>
</li>
<li><p>调用这个数据对象的delete()方法实现删除</p>
<p>示例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">try</span>:<br>    auth=Author.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)<br>    auth.delete()<br><span class="hljs-keyword">except</span>:<br>    <span class="hljs-built_in">print</span>(删除失败)<br></code></pre></td></tr></table></figure></li>
</ol>
<p><strong>2）批量删除</strong></p>
<ol>
<li><p>查找查询结果集中满足条件的全部QuerySet查询集合对象</p>
</li>
<li><p>调用查询集合对象的delete()方法实现删除</p>
<p>示例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#删除全部作者中，年龄大于65岁的全部信息</span><br>auths=Author.objects.<span class="hljs-built_in">filter</span>(age__gt=<span class="hljs-number">65</span>)<br>auths.delete()<br></code></pre></td></tr></table></figure></li>
</ol>
<p><strong>3）伪删除</strong></p>
<ul>
<li>通常在业务中不会轻易地把数据真正删除，取而代之的是做伪删除，即在表中添加一个布尔类型字段(is_active),默认为True；执行删除时，将欲删除数据的is_active字段置为False</li>
<li>注意：用伪删除时，确保显示数据的地方，均加了is_active&#x3D;True的过滤查询</li>
</ul>
<h4 id="F对象和Q对象"><a href="#F对象和Q对象" class="headerlink" title="F对象和Q对象"></a>F对象和Q对象</h4><h5 id="F对象"><a href="#F对象" class="headerlink" title="F对象"></a>F对象</h5><p>一个F对象代表数据库中某条记录的字段的信息</p>
<p>作用：</p>
<p>​	-通常是对数据库中的字段值在不获取的情况下进行操作(也可以为标记)，在业务数据更新时，为防止资源竞争和并发事件，用F对象就等于加了把锁，可以有条不紊地进行更新。</p>
<p>​	-用于类属性(字段)之间的比较</p>
<p>语法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> F<br>F(<span class="hljs-string">&#x27;列名&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>示例代码: 更新book实例中所有的零售价涨10块</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#用F对象的操作</span><br>Book.objects.<span class="hljs-built_in">all</span>().update(market_price=F(<span class="hljs-string">&#x27;market_price&#x27;</span>)+<span class="hljs-number">10</span>)<br><span class="hljs-comment">#没有F对象的原始做法</span><br>books=Book.objects.<span class="hljs-built_in">all</span>()<br><span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:<br>    book.market_price=book.market_price+<span class="hljs-number">10</span><br>    book.save()<br></code></pre></td></tr></table></figure>

<p>实例2：对数据库中两个字段的值进行比较，列出哪儿些书的零售价高于定价</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> F<br><span class="hljs-keyword">from</span> bookstore.models <span class="hljs-keyword">import</span> Book<br>books=Book.objects.<span class="hljs-built_in">filter</span>(market_price__gt=F(<span class="hljs-string">&#x27;price&#x27;</span>))<br><span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:<br>    <span class="hljs-built_in">print</span>(book.title,<span class="hljs-string">&#x27;定价:&#x27;</span>,book.price,<span class="hljs-string">&#x27;现价:&#x27;</span>,book.market_price)<br></code></pre></td></tr></table></figure>



<h5 id="Q对象"><a href="#Q对象" class="headerlink" title="Q对象"></a>Q对象</h5><p>当在获取查询结果集使用复杂的逻辑或 |、逻辑非~等操作时可以借助于Q对象进行操作</p>
<p>如：想找出定价低于20元或清华大学出版社的全部书，可以写成</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Q<br>Book.objects.<span class="hljs-built_in">filter</span>(Q(price__lt=<span class="hljs-number">20</span>)|Q(pub=<span class="hljs-string">&quot;清华大学出版社&quot;</span>))<br></code></pre></td></tr></table></figure>

<p>Q对象在数据包django.db.models中，需要先导入再使用</p>
<p>作用：在条件中用来实现除and(&amp;)以外的or(|)或not(~)操作</p>
<p>语法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Q<br>Q(条件<span class="hljs-number">1</span>)|Q(条件<span class="hljs-number">2</span>)   <span class="hljs-comment">#条件1成立或条件2成立</span><br>Q(条件<span class="hljs-number">1</span>)&amp;Q(条件<span class="hljs-number">2</span>)   <span class="hljs-comment">#条件1和条件2同时成立</span><br>Q(条件<span class="hljs-number">1</span>)&amp;~Q(条件<span class="hljs-number">2</span>)  <span class="hljs-comment">#条件1成立且条件2不成立</span><br></code></pre></td></tr></table></figure>



<h4 id="聚合查询和原生数据库操作"><a href="#聚合查询和原生数据库操作" class="headerlink" title="聚合查询和原生数据库操作"></a>聚合查询和原生数据库操作</h4><h5 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h5><p>聚合查询是指对一个数据表中的一个字段的数据进行部分或全部进行统计查询，查bookstore_book数据表中的全部书的平均价格，查询所有书的总个数等，都要使用聚合查询</p>
<p>聚合查询分为：整表查询和分组查询</p>
<p><strong>1）整表查询</strong></p>
<p>不带分组的聚合查询是指导将全部数据进行集中统计查询</p>
<p><strong>聚合函数[需要导入]</strong></p>
<p>​	**-导入方法: from django.db.models import ***</p>
<p>​	<strong>-聚合函数: Sum,Avg,Count,Max,Min</strong></p>
<p><strong>语法：MyModel.objects.aggregate(结果变量名&#x3D;聚合函数(‘列’))</strong></p>
<p>返回结果：结果变量名和值组成的字典</p>
<p>格式为：{“结果变量名”:值}</p>
<p><strong>2）分组聚合</strong></p>
<p>分组聚合是指通过计算查询结果中每一个对象所关联的对象集合，从而得出总计值(也可以是平均值或总和)，即为查询集的每一项生成聚合。</p>
<p>语法：<br>    - <strong>QuerySet.annotate(结果变量名&#x3D;聚合函数(‘列’)</strong></p>
<p>返回值：</p>
<p>​	-  QuerySet</p>
<p>实例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">pub_count_set=pub_set.annotate(myCount=Count(<span class="hljs-string">&#x27;pub&#x27;</span>))<br></code></pre></td></tr></table></figure>



<h5 id="原生数据库操作"><a href="#原生数据库操作" class="headerlink" title="原生数据库操作"></a>原生数据库操作</h5><p>django也可以支持直接用sql语句的方式通信数据库</p>
<p><strong>查询：使用MyModel.objects.raw()进行数据库查询操作查询</strong></p>
<p><strong>语法：MyModel.objects.raw(sql语句,拼接参数)</strong></p>
<p><strong>返回值：RawQuerySet集合对象【只支持基础操作，比如循环】</strong></p>
<p>实例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py">books=models.Book.objecst.raw(<span class="hljs-string">&#x27;select * from bookstore_book&#x27;</span>)<br><span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:<br>    <span class="hljs-built_in">print</span>(book)<br></code></pre></td></tr></table></figure>

<p><strong>SQL注入</strong></p>
<p>使用原生语句时小心SQL注入</p>
<p>定义：用户通过数据上传，将恶意的sql语句提交给服务器，从而达到攻击效果</p>
<p>案例1：用户在搜索好友的表单框里输入’1 or 1&#x3D;1’</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">s1=Book.objects.raw(<span class="hljs-string">&#x27;select * from bookstore_book where id=%s&#x27;</span>%(<span class="hljs-string">&#x27;1 or 1=1&#x27;</span>))<br></code></pre></td></tr></table></figure>

<p>攻击结果：可查询出所有用户数据，’1&#x3D;1’是恒等式，会会得出全表数据</p>
<p><strong>sql注入防范</strong></p>
<p>把刚才的sql拼接语句改成</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">s2=Book.objects.raw(<span class="hljs-string">&#x27;select * from bookstore_book where id=%s&#x27;</span>,[<span class="hljs-string">&#x27;1 or 1=1&#x27;</span>]<br></code></pre></td></tr></table></figure>

<p><strong>原生数据库操作-cursor</strong></p>
<p>完全跨过模型类操作数据库-查询&#x2F;更新&#x2F;删除</p>
<ol>
<li><p>导入cursor所在的包</p>
<p>from django.db import connection</p>
</li>
<li><p>用创建cursor类的构造函数创建cursor对象，再使用cursor对象，为保证在出现异常时能释放cursor资源，通常使用with语句进行创建操作</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> connection<br><span class="hljs-keyword">with</span> connection.cursor() <span class="hljs-keyword">as</span> cur:<br>    cur.execute(<span class="hljs-string">&#x27;执行SQL语句&#x27;</span>,<span class="hljs-string">&#x27;拼接参数&#x27;</span>)<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="关系映射"><a href="#关系映射" class="headerlink" title="关系映射"></a>关系映射</h3><p>在关系型数据库中，通产不会把所有数据都放在同一张表中，不易于扩展，常见关系映射有：</p>
<ol>
<li>一对一映射</li>
<li>一对多映射</li>
<li>多对多映射</li>
</ol>
<h4 id="一对一映射"><a href="#一对一映射" class="headerlink" title="一对一映射"></a>一对一映射</h4><p>一对一是表示现实事物间存在的一对一的对应关系</p>
<p>如：一个家庭只有一个户主，一个男人有一个妻子，一个人有一个唯一的指纹信息等</p>
<p>语法：OneToOneField(类名,on_delete&#x3D;xxx)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(model.Model):<br>    ...<br>    <span class="hljs-keyword">pass</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>(model.Model):<br>    属性=models.OneToOneField(A,on_delete=xxx)<br></code></pre></td></tr></table></figure>

<p><strong>on_delete - 级联删除</strong></p>
<ol>
<li><strong>models.CASCADE 级联删除。Django模拟SQL语句约束ON_DELETE CASCADE的行为，并删除包含ForeignKey的对象</strong></li>
<li><strong>models.PROTECT 抛出ProtectedError 以阻止被引用对象的删除;[等同于mysql默认的RESTRICT]</strong></li>
<li><strong>SET_NULL 设置ForeignKey null; 需要null&#x3D;True</strong></li>
<li><strong>SET_DEFAULT 将ForeignKey设置为其默认值；必须设置ForeignKey的默认值</strong></li>
</ol>
<p><strong>创建模型类</strong></p>
<p>实例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Author</span>(mdoels.Model):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;作家模型类&#x27;&#x27;&#x27;</span><br>    name=models.CharField(<span class="hljs-string">&#x27;作家&#x27;</span>,max_length=<span class="hljs-number">50</span>)<br>    <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Wife</span>(models.Model):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;作家妻子模型类&#x27;&#x27;&#x27;</span><br>    name=models.CharField(<span class="hljs-string">&quot;妻子&quot;</span>,max_length=<span class="hljs-number">50</span>)<br>    author=models.OneToOneField(Author,on_delete=models.CASCADE)  <span class="hljs-comment">#增加一对一属性</span><br></code></pre></td></tr></table></figure>

<p><strong>创建数据</strong></p>
<ul>
<li><p>无外键的模型类[Author]:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">author1=Author.objects.create(name=<span class="hljs-string">&#x27;王老师&#x27;</span>)<br></code></pre></td></tr></table></figure>
</li>
<li><p>有外键的模型类[Wife]:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">wife1=Wife.objects.create(name=<span class="hljs-string">&#x27;王夫人&#x27;</span>,author=author1)  <span class="hljs-comment">#关联王老师对象</span><br>wife1=Wife.objects.create(name=<span class="hljs-string">&#x27;王夫人&#x27;</span>,author_id=<span class="hljs-number">1</span>) <span class="hljs-comment">#关联王老师对应主键值</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p><strong>查询数据</strong></p>
<ol>
<li><p><strong>正向查询：直接通过外键属性查询，则称为正向查询</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#通过wife找author</span><br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Wife<br>wife=Wife.objects.get(name=<span class="hljs-string">&#x27;王夫人&#x27;</span>)<br><span class="hljs-built_in">print</span>(wife.name,<span class="hljs-string">&#x27;的老公是&#x27;</span>,wife.author.name)<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>反向查询：没有外键属性的一方，可以调用反向属性查询到关联的另一方</strong></p>
<p><strong>反向关联属性为’实例对象.引用类名(小写)’,如作家的反向引用为’作家对象.wife’</strong></p>
<p> <strong>-当反向引用不存在时，则会触发异常</strong></p>
<p><strong>author1&#x3D;Author.objects.get(name&#x3D;’王老师’)</strong></p>
<p><strong>author1.wife.name</strong></p>
</li>
</ol>
<h4 id="一对多映射"><a href="#一对多映射" class="headerlink" title="一对多映射"></a>一对多映射</h4><p>一对多是表示现实事物间存在的一对多的对应关系</p>
<p>如：一个学校有多个班级，一个班级有多个学生，一本图书只能属于一个出版社，一个出版社允许出版多本图书</p>
<p>一对多需要明确出具体角色，在多表上设置外键</p>
<p>语法：当一个A类对象可以关联多个B类对象时</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(models.Model): <span class="hljs-comment">#一</span><br>    ...<br>    <span class="hljs-keyword">pass</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>(models.Model):  <span class="hljs-comment">#多</span><br>    属性=models.ForeignKey(<span class="hljs-string">&quot;一&quot;</span>的模型类,on_delete=xx)<br></code></pre></td></tr></table></figure>

<p><strong>ForeignKey必须指定on_delete模式</strong></p>
<p><strong>创建模型类</strong>：</p>
<p>实例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Publisher</span>(models.Model):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;出版社【一】&#x27;&#x27;&#x27;</span><br>    name=models.CharField(<span class="hljs-string">&#x27;名称&#x27;</span>,max_length=<span class="hljs-number">50</span>,unique=<span class="hljs-literal">True</span>)<br>    <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span>(models.Model):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;书【多】&#x27;&#x27;&#x27;</span><br>    title=models.CharField(<span class="hljs-string">&#x27;书名&#x27;</span>,max_length=<span class="hljs-number">50</span>)<br>    publisher=ForeignKey(Publisher,on_delete=models.CASCADE)<br></code></pre></td></tr></table></figure>



<p><strong>创建数据</strong></p>
<p>先创建’一’再创建’多’</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> *<br>pub1=Publisher.objects.create(name=<span class="hljs-string">&#x27;清华大学出版社&#x27;</span>)<br>Book.objects.create(title=<span class="hljs-string">&#x27;C++&#x27;</span>,publisher=pub1)<br>Book.objects.create(title=<span class="hljs-string">&#x27;Java&#x27;</span>,publisher_id=<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>

<p><strong>查询数据</strong></p>
<ol>
<li><p>正向查询[通过Book查询 Publisher]</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#通过publisher属性查询即可</span><br><span class="hljs-comment">#book.publisher</span><br><br>abook=Book.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(abook.title,<span class="hljs-string">&#x27;的出版社是:&#x27;</span>,abook.publisher.name)<br></code></pre></td></tr></table></figure>
</li>
<li><p>反向查询[通过Publisher查询对应的所有的Book]</p>
<p><strong>需要用到反向属性(下面例子中的book_set),反向属性的命名规则为关联的多的类名小写+_set</strong></p>
<p><strong>django 默认每个主表的对象都有一个是外键的属性，可以通过它来查询到所有属于主表的子表的信息。这个属性的名称默认是以子表的名称小写加上_set()来表示(上面默认以b_set访问)，默认返回的是一个querydict对象。</strong><br><strong>related_name 可以给这个外键定义好一个别的名称</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py">pub1=Publisher.objects.get(name=<span class="hljs-string">&#x27;清华大学出版社&#x27;</span>)<br>books=pub1.book_set.<span class="hljs-built_in">all</span>()  <span class="hljs-comment">#通过book_set获取pub1对应的多个Book数据对象</span><br><span class="hljs-comment">#books=Book.objects.filter(publisher=pub1)  #也可以采用此方式获取</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;清华大学出版社的书有：&quot;</span>)<br><span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:<br>    <span class="hljs-built_in">print</span>(book.title)<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="多对多映射"><a href="#多对多映射" class="headerlink" title="多对多映射"></a>多对多映射</h4><p>多对多表达对象之间多得多复杂关系，如：每一人都有不同的学校(小学，初中，高中…)，每个学校都有不同的学生…</p>
<blockquote>
<p>mysql中创建多对多需要依赖第三张表来实现</p>
<p>Django中无需手动创建第三张表，Django自动完成</p>
</blockquote>
<p>语法：<strong>在关联的两个类中的任意一个类中，增加：属性&#x3D;models.ManyToManyField(MyModel)</strong></p>
<p><strong>创建模型类</strong></p>
<p>实例：一个作者可以出版多本图书，一本图书可以被多名作者同时编写</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Author</span>(models.Model):<br>    ...<br>    <span class="hljs-keyword">pass</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span>(models.Model):<br>    ...<br>    authors=models.ManyToManyField(Author)<br></code></pre></td></tr></table></figure>



<p><strong>创建数据</strong></p>
<p>方案1：先创建author再关联book</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py">author1=Author.objects.create(name=<span class="hljs-string">&#x27;吕老师&#x27;</span>)<br>author2=Author.objects.create(name=<span class="hljs-string">&#x27;王老师&#x27;</span>)<br><span class="hljs-comment">#吕老师和王老师同时写一本python</span><br>book11=author1.book_set.create(title=<span class="hljs-string">&quot;python&quot;</span>)<br>author2.book_set.add(book11)<br></code></pre></td></tr></table></figure>

<p>方案2：先创建book再关联author</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py">book=Book.objects.create(title=<span class="hljs-string">&#x27;python1&#x27;</span>)<br><span class="hljs-comment">#郭小闹和吕老师都参与了pyhton1的创建</span><br>author3=book.authors.create(name=<span class="hljs-string">&#x27;guoxiaonao&#x27;</span>)<br>book.authors.add(author1)<br></code></pre></td></tr></table></figure>

<p><strong>查询数据</strong></p>
<ol>
<li><p>正向查询有多对多属性的对象查另一方</p>
<p>通过Book查询对应的所有的Author</p>
<p>此时多对多属性等价于objects</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">book.authors.<span class="hljs-built_in">all</span>()  -&gt;获取book对应的所有的author的信息<br>book.authors.<span class="hljs-built_in">filter</span>(age__gt=<span class="hljs-number">80</span>) -&gt;获取book对应的作者中年龄大于<span class="hljs-number">80</span>岁的作者的信息<br></code></pre></td></tr></table></figure>
</li>
<li><p>反向查询</p>
<p>通过Author查询对应的所有的Book</p>
<p>利用反向属性book_set</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">author.book_set.<span class="hljs-built_in">all</span>()<br>author.book_set.<span class="hljs-built_in">filter</span>()<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="admin后台管理"><a href="#admin后台管理" class="headerlink" title="admin后台管理"></a>admin后台管理</h2><p>django提供了比较完善的后台管理数据库的接口，可供开发过程中调用和测试使用</p>
<p>django会搜集所有已注册的模型类，为这些模型类提供数据管理界面，供开发者使用</p>
<h3 id="注册自定义模型类"><a href="#注册自定义模型类" class="headerlink" title="注册自定义模型类"></a>注册自定义模型类</h3><p>若要自己定义的模型类也能在&#x2F;admin后台管理界中显示和管理，需要将自己的类注册到后台管理界面</p>
<p>注册步骤：</p>
<ol>
<li>在应用app中的admin.py中导入注册要管理的模型models类，如：from .models import Book</li>
<li>调用admin.site.register 方法进行注册,如：admin.site.register(自定义模型类)</li>
</ol>
<h4 id="模型管理类"><a href="#模型管理类" class="headerlink" title="模型管理类"></a>模型管理类</h4><p>作用：为后台管理界面添加便于操作的新功能</p>
<p>说明：后台管理器类须继承自django.contrib.admin里的ModelAdmin类</p>
<p>使用方法：</p>
<ol>
<li><p>在应用app的admin.py里定义模型管理器类</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">xxxxManager</span>(admin.ModelAdmin):<br>    ......<br></code></pre></td></tr></table></figure>
</li>
<li><p>绑定注册模型管理器和模型类</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> *<br>admin.site.register(YYYY,xxxxManager)  <span class="hljs-comment">#绑定YYYY模型类与管理器类 xxxxManager</span><br></code></pre></td></tr></table></figure></li>
</ol>
<p><strong>模型管理器类的属性以及作用</strong></p>
<ol>
<li>list_display 去控制哪些字段会显示在Admin的修改列表页面中</li>
<li>list_display_links 可以控制list_display中的字段是否应该链接到对象的”更改”页面</li>
<li>list_filter 设置激活Admin修改列表页面右侧栏中的过滤器</li>
<li>search_fields 设置启用Admin更改列表页面上的搜索框</li>
<li>list_editable 设置为模型上的字段名称列表，这将允许更改页面上进行编辑</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserManager</span>(admin.ModelAdmin):<br>    <span class="hljs-comment">#列表页显示哪些字段的列</span><br>    list_display = [<span class="hljs-string">&#x27;id&#x27;</span>,<span class="hljs-string">&#x27;reg_username&#x27;</span>,<span class="hljs-string">&#x27;reg_password&#x27;</span>]<br>    <span class="hljs-comment">#控制list_display中的字段，哪些可以链接到修改页</span><br>    list_display_links =[<span class="hljs-string">&#x27;reg_username&#x27;</span>]<br>    <span class="hljs-comment">#添加过滤器</span><br>    list_filter =[<span class="hljs-string">&#x27;id&#x27;</span>]<br>    <span class="hljs-comment">#添加搜索框[模糊查询]</span><br>    search_fields = [<span class="hljs-string">&#x27;reg_username&#x27;</span>]<br>    <span class="hljs-comment">#添加可在列表页编辑的字段</span><br>    list_editable = [<span class="hljs-string">&#x27;reg_password&#x27;</span>]<br></code></pre></td></tr></table></figure>

<p><img src="/../../../study/images/capture_20230314000410869.bmp" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="内建用户系统"><a href="#内建用户系统" class="headerlink" title="内建用户系统"></a>内建用户系统</h3><p>django带有一个用户认证系统。它处理用户账户、组、权限以及基于cookie的用户会话。</p>
<p>用户可以直接使用django自带的用户表</p>
<h4 id="基本字段"><a href="#基本字段" class="headerlink" title="基本字段"></a>基本字段</h4><p>模型类位置：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User<br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">模型字段</th>
<th align="center">用处</th>
</tr>
</thead>
<tbody><tr>
<td align="center">username</td>
<td align="center">用户名</td>
</tr>
<tr>
<td align="center">password</td>
<td align="center">密码</td>
</tr>
<tr>
<td align="center">email</td>
<td align="center">邮箱</td>
</tr>
<tr>
<td align="center">first_name</td>
<td align="center">名</td>
</tr>
<tr>
<td align="center">last_name</td>
<td align="center">姓</td>
</tr>
<tr>
<td align="center">is_superuser</td>
<td align="center">是否是管理员账号(&#x2F;admin)</td>
</tr>
<tr>
<td align="center">is_staff</td>
<td align="center">是否可以访问admin管理界面</td>
</tr>
<tr>
<td align="center">is_active</td>
<td align="center">是否是活跃用户，默认为True。一般不删除用户，而是将用户的is_avtive设为False</td>
</tr>
<tr>
<td align="center">last_login</td>
<td align="center">上一次的登录时间</td>
</tr>
<tr>
<td align="center">date_joined</td>
<td align="center">用户创建的时间</td>
</tr>
</tbody></table>
<h4 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h4><h5 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h5><ol>
<li><p><strong>创建普通用户create_user</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User<br>user=User.objects.create_user(username=<span class="hljs-string">&#x27;用户名&#x27;</span>,password=<span class="hljs-string">&#x27;密码&#x27;</span>,email=<span class="hljs-string">&#x27;邮箱&#x27;</span>,....)<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>创建超级用户create_superuser</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User<br>user=User.objects.create_superuser(username=<span class="hljs-string">&#x27;用户名&#x27;</span>,password=<span class="hljs-string">&#x27;密码&#x27;</span>,email=<span class="hljs-string">&#x27;邮箱&#x27;</span>,...)<br></code></pre></td></tr></table></figure></li>
</ol>
<h5 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h5><p>django建议我们还是用伪删除</p>
<p>示例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User<br><span class="hljs-keyword">try</span>:<br>    user=User.objects.get(username=<span class="hljs-string">&#x27;用户名&#x27;</span>)<br>    user.is_active=<span class="hljs-literal">False</span> <span class="hljs-comment">#记当前用户无效</span><br>    user.save()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;删除普通用户成功！&quot;</span>)<br><span class="hljs-keyword">except</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;删除普通用户失败&quot;</span>)<br></code></pre></td></tr></table></figure>



<h5 id="校验密码"><a href="#校验密码" class="headerlink" title="校验密码"></a>校验密码</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.contrib.auth <span class="hljs-keyword">import</span> authenticate<br>user=authenticate(username=username,password=password)<br></code></pre></td></tr></table></figure>

<p>说明：</p>
<p><strong>如果用户名密码校验成功则返回对应的user对象，否则返回None</strong></p>
<h5 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h5><p>示例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User<br><span class="hljs-keyword">try</span>:<br>    user=User.objects.get(username=<span class="hljs-string">&#x27;xiaonao&#x27;</span>)<br>    user.set_password(<span class="hljs-string">&#x27;654321&#x27;</span>)<br>    user.save()<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;修改密码成功！&quot;</span>)<br><span class="hljs-keyword">except</span>:<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;修改密码失败！&quot;</span>)<br></code></pre></td></tr></table></figure>



<h4 id="自带登录系统功能"><a href="#自带登录系统功能" class="headerlink" title="自带登录系统功能"></a>自带登录系统功能</h4><h5 id="登录状态保持"><a href="#登录状态保持" class="headerlink" title="登录状态保持"></a>登录状态保持</h5><p>利用了session，但session保存时间不可控</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.contrib.auth <span class="hljs-keyword">import</span> login<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login_view</span>(<span class="hljs-params">request</span>):<br>    user=authenticate(username=username,password=password)<br>    login(request,user)<br></code></pre></td></tr></table></figure>



<h5 id="登录状态校验"><a href="#登录状态校验" class="headerlink" title="登录状态校验"></a>登录状态校验</h5><p>示例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.contrib.auth.decorators <span class="hljs-keyword">import</span> login_required<br><span class="hljs-meta">@login_required</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index_view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#该视图必须为用户登录状态下才可以访问</span><br>    <span class="hljs-comment">#当前登录用户可通过request.user获取</span><br>    login_user=request.user<br>    ....<br></code></pre></td></tr></table></figure>



<h5 id="登录状态取消"><a href="#登录状态取消" class="headerlink" title="登录状态取消"></a>登录状态取消</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.contrib.auth <span class="hljs-keyword">import</span> logout<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">logout_view</span>(<span class="hljs-params">request</span>):<br>    logout(request)<br></code></pre></td></tr></table></figure>



<h4 id="内建用户表扩展字段"><a href="#内建用户表扩展字段" class="headerlink" title="内建用户表扩展字段"></a>内建用户表扩展字段</h4><p>两种方案：</p>
<ul>
<li><strong>通过建立新表，跟内建表做1对1</strong></li>
<li><strong>继承内建的抽象user模型类</strong></li>
</ul>
<p>方案二：</p>
<p>步骤：</p>
<ol>
<li><strong>添加新的应用</strong></li>
<li><strong>定义模型类继承AbstractUser</strong></li>
<li><strong>settings.py中知指明AUTH_USER_MODEL&#x3D;’应用名.类名’</strong></li>
</ol>
<p><strong>注意：此操作要在第一次Migrate之前进行</strong></p>
<p>示例：- user&#x2F;models.py -添加user应用</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models<br><span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> AbstractUser<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span>(<span class="hljs-title class_ inherited__">AbstractUser</span>):<br>    phone=models.CharField(max_length=<span class="hljs-number">11</span>,default=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p><strong>settings.py添加配置</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">AUTH_USER_MODEL=<span class="hljs-string">&#x27;user.UserInfo&#x27;</span><br></code></pre></td></tr></table></figure>

<p><strong>添加用户</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> user.models <span class="hljs-keyword">import</span> UserInfo<br>UserInfo.objects.create_user(username=<span class="hljs-string">&#x27;guoxiao&#x27;</span>,password=<span class="hljs-string">&#x27;123456&#x27;</span>,phone=<span class="hljs-string">&#x27;13488871101&#x27;</span>)<br></code></pre></td></tr></table></figure>





<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>定义：缓存是一类可以更快的读取数据的介质统称，也指其它可以加快数据读取的存储方式。一般用来存储临时数据，常用介质的是读取速度很快的内存</p>
<p>意义：<strong>视图渲染有一定成本，数据库的频繁查询过高；所以对于低频变动的页面可以考虑使用缓存技术，减少实际渲染次数；用户拿到响应的时间成本会更低</strong></p>
<h3 id="缓存配置"><a href="#缓存配置" class="headerlink" title="缓存配置"></a>缓存配置</h3><ol>
<li><p><strong>设置数据库缓存</strong></p>
<p>将缓存的数据存储在您的数据库中</p>
<p>说明：尽管存储介质没有更换，但是当把一次负责查询的结果直接存储在表里，比如多个条件的过滤查询结果，可避免重复进行复杂的查询，提升效率； </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># #数据库缓存设置，需要手动执行创建表的命令(my_cache_table)</span><br>CACHES=&#123;<br>    <span class="hljs-string">&#x27;default&#x27;</span>:&#123;<br>        <span class="hljs-string">&#x27;BACKEND&#x27;</span>:<span class="hljs-string">&#x27;django.core.cache.backends.db.DatabaseCache&#x27;</span>,<br>  <span class="hljs-string">&#x27;LOCATION&#x27;</span>:<span class="hljs-string">&#x27;my_cache_table&#x27;</span>,<br>  <span class="hljs-string">&#x27;TIMEOUT&#x27;</span>:<span class="hljs-number">300</span>, <span class="hljs-comment">#缓存保存时间 单位秒，默认值为300</span><br>  <span class="hljs-string">&#x27;OPTIONS&#x27;</span>:&#123;<br>      <span class="hljs-string">&#x27;MAX_ENTRIES&#x27;</span>:<span class="hljs-number">300</span>, <span class="hljs-comment">#缓存最大数据条数</span><br>      <span class="hljs-string">&#x27;CYLL_FREQUENCY&#x27;</span>:<span class="hljs-number">2</span>, <span class="hljs-comment">#缓存条数达到最大值时，删除1/x的缓存数据</span><br>  &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>创建数据库缓存表的操作：</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">python manage.py createcachetable<br></code></pre></td></tr></table></figure>


</li>
<li><p><strong>本地内存缓存：</strong></p>
<p>数据缓存到服务器内存中</p>
<p>配置：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py">CACHES=&#123;<br>    <span class="hljs-string">&#x27;default&#x27;</span>:&#123;<br>        <span class="hljs-string">&#x27;BACKEND&#x27;</span>:<span class="hljs-string">&#x27;django.core.cache.backends.locmem.LocMemCache&#x27;</span>,<br>        <span class="hljs-string">&#x27;LOCATION&#x27;</span>:<span class="hljs-string">&#x27;unique-snowflake&#x27;</span>,<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>文件系统缓存</strong></p>
<p>将缓存的数据存储到本地文件中</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py">CACHES=&#123;<br>    <span class="hljs-string">&#x27;default&#x27;</span>:&#123;<br>        <span class="hljs-string">&#x27;BACKEND&#x27;</span>:<span class="hljs-string">&#x27;django.core.cache.backends.filebased.FileBasedCache&#x27;</span>,<br>  <span class="hljs-string">&#x27;LOCATION&#x27;</span>:<span class="hljs-string">&#x27;/var/tem/django_cache&#x27;</span>,  <span class="hljs-comment">#这个是文件夹的路径</span><br>    <span class="hljs-comment">#&#x27;LOCATION&#x27;:&#x27;c:\test\cache&#x27;,#windows下示例</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="缓存使用"><a href="#缓存使用" class="headerlink" title="缓存使用"></a>缓存使用</h3><h4 id="整体缓存"><a href="#整体缓存" class="headerlink" title="整体缓存"></a>整体缓存</h4><ol>
<li><p>视图函数中：</p>
<p>样例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.views.decorators.cache <span class="hljs-keyword">import</span> cache_page<br><br><span class="hljs-meta">@cache_page(<span class="hljs-params"><span class="hljs-number">30</span></span>)  </span><span class="hljs-comment">#当前缓存保存的时间  单位s</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_view</span>(<span class="hljs-params">request</span>):<br>    ....<br></code></pre></td></tr></table></figure>
</li>
<li><p>在路由中：</p>
<p>示例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.views.decorators.cache <span class="hljs-keyword">import</span> cache_page<br><br>urlpatterns=[<br>    path(<span class="hljs-string">&#x27;foo/&#x27;</span>,cache_page(<span class="hljs-number">60</span>)(my_view))<br>]<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="局部缓存"><a href="#局部缓存" class="headerlink" title="局部缓存"></a>局部缓存</h4><p>缓存api的使用：</p>
<p><strong>先引入cache对象：</strong></p>
<ol>
<li><p>使用caches[‘CACHE配置key’]导入具体对象</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.core.cache <span class="hljs-keyword">import</span> caches<br>cache1=caches[<span class="hljs-string">&#x27;myalias&#x27;</span>]<br>cache2=caches[<span class="hljs-string">&#x27;myalias_2&#x27;</span>]<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>from django.core.cache import cache</strong>  相当于直接引入CACHES配置项的’default’项</p>
</li>
</ol>
<p><strong>cache.set(key,value,timeout)   - 存储缓存</strong></p>
<ul>
<li>key:缓存的key，字符串类型</li>
<li>value：python对象</li>
<li>timeout：缓存存储时间(s)，默认为CACHES中的TIMEOUT值</li>
<li>返回值：None</li>
</ul>
<p><strong>cache.get(key) - 获取缓存</strong></p>
<ul>
<li>key：缓存的key</li>
<li>返回值：为key的具体值，如果没有数据，则返回None</li>
</ul>
<p><strong>cache.add(key,value) - 存储缓存</strong></p>
<ul>
<li>注意：只在key不存在时生效</li>
<li>返回值：True[存储成功]或者False[存储失败]</li>
</ul>
<p><strong>cache.get_or_set(key,value,timeout)  - 如果未获取到数据，则执行set操作</strong></p>
<ul>
<li>返回值：value</li>
</ul>
<p><strong>cache.set_many(dict,timeout) - 批量存储缓存</strong></p>
<ul>
<li>dict：key和value的字典</li>
<li>timeout：存储时间(s)</li>
<li>返回值：插入不成功的key的数组</li>
</ul>
<p><strong>cache.get_many(key_list) - 批量存储缓存数据</strong></p>
<ul>
<li>key_list：包含key的数组</li>
<li>返回值：取到的key和value的字典</li>
</ul>
<p><strong>cache.delete(key) - 删除key的缓存数据</strong></p>
<ul>
<li>返回值：None</li>
</ul>
<p><strong>cache.delete_many(key_list) - 批量删除</strong></p>
<ul>
<li>返回值：None</li>
</ul>
<h4 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h4><p><strong>强缓存</strong></p>
<p>不会向服务器发送请求，直接从缓存中读取资源</p>
<ol>
<li><strong>响应头 - Expires</strong><ul>
<li>定义：缓存过期时间，用来指定资源到期的时间，是服务器端的具体的时间点(绝对时间)</li>
<li>样例：Expires：Thu,02 Apr 2030 05:14:08 GMT</li>
</ul>
</li>
<li><strong>响应头 -  Cache-Control</strong><ul>
<li>在HTTP&#x2F;1.1中，Cache-Control主要用于控制网页缓存。比如当’Cache-Control:max-age&#x3D;120’ 代表请求创建时间后的120秒，缓存失效(相对时间)</li>
<li>说明：目前服务器都会带着这两个头同时响应给浏览器，浏览器优先使用Cache-Control</li>
</ul>
</li>
</ol>
<h4 id="协商缓存"><a href="#协商缓存" class="headerlink" title="协商缓存"></a>协商缓存</h4><p>强缓存中的数据一旦过期。还需要跟服务器进行通信，从而获取最新数据；如果强缓存的数据是一些静态文件，大图片等；</p>
<p>考虑到大图片这类比较费带宽且不易变化的数据，强缓存时间到期后，浏览器会去跟服务器协商，当前缓存是否可用，如果可用，服务器不必返回数据，浏览器继续使用原来缓存的数据，如果文件不可用，则返回最新数据</p>
<p><strong>1.Last-Modified响应头和 If-Modified-Since请求头</strong></p>
<ul>
<li>Last-Modified为文件的最近修改时间，浏览器第一次请求静态文件时，服务器如果返回Last-Modified响应头，则代表该资源为需要协商的缓存</li>
<li>当缓存到期后，浏览器将获取到的Last-Modified值做为请求头If-Modified-Since的值，与服务器发请求协商，服务端返回304响应码[<em>响应体为空</em>]，代表缓存继续使用，200响应码代表缓存不可用[<em>响应体为最新资源</em>]</li>
</ul>
<p><strong>ETag响应头和If-None-Match响应头</strong></p>
<ul>
<li>ETag是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)，只要资源有变化，ETag就会重新生成</li>
<li>缓存到期后，浏览器将Etag响应头的值作为If-None-Match请求头的值，给服务器发请求协商；服务器接到请求头后，比对文件标识，不一致则认为资源不可用，返回200响应码[响应体为最新资源]；可用则返回304响应码</li>
</ul>
<p><strong>Last-Modified和ETag的相对区别</strong></p>
<ul>
<li>精度不一样 - Etag准确率更高</li>
<li>性能上 - Last-Modified高，Etag需要计算文件标识</li>
<li>优先级 - Etag高；两个头同时出现，浏览器优先取Etag</li>
</ul>
<h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><p>定义：分页是指在web页面有大量数据需要显示，为了阅读方便在每个页面中只显示部分数据</p>
<p>优点：</p>
<ul>
<li>方便阅读</li>
<li>减少数据提取量，减轻服务器压力</li>
</ul>
<p><strong>- Django提供了Paginator类可以方便的实现分页功能</strong></p>
<p><strong>- Paginator类位于’django.core.paginator’模块中</strong></p>
<h3 id="Paginator对象"><a href="#Paginator对象" class="headerlink" title="Paginator对象"></a>Paginator对象</h3><p>负责分页数据整体的管理</p>
<p>对象的构造方法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">paginator=Paginator(object_list,per_page)<br></code></pre></td></tr></table></figure>

<ol>
<li><p>参数;</p>
<ul>
<li><strong>object_list需要分页数据的对象列表</strong></li>
<li><strong>per_page每页数据个数</strong></li>
</ul>
</li>
<li><p>返回值：</p>
<p>Paginator对象</p>
</li>
<li><p><strong>属性：</strong></p>
<ul>
<li><strong>count：需要分页数据的对象总数</strong></li>
<li><strong>num_pages：分页后的页面总数</strong></li>
<li><strong>page_range：从1开始的range对象，用于记录当前面码数</strong></li>
<li><strong>per_page：每页数据的个数</strong></li>
</ul>
</li>
</ol>
<p><strong>Paginator方法</strong>：</p>
<p>paginator对象.page(number)</p>
<ul>
<li>参数number为页码信息(从1开始)</li>
<li>返回当前number页对应的页信息</li>
<li>如果提供的页码不存在，抛出InvalidPage异常</li>
</ul>
<p><strong>Paginator异常exception</strong>：</p>
<p>InvalidPage：总的异常基类，包含以下两个异常子类</p>
<ul>
<li>PageNotAnlnteger：当向page()传入一个不是整数的值时抛出</li>
<li>EmptyPage：当向page()提供一个有效值，但是那个页面上没有任何对象时抛出</li>
</ul>
<h3 id="Page对象"><a href="#Page对象" class="headerlink" title="Page对象"></a>Page对象</h3><p>负责具体某一页的数据的管理</p>
<p><strong>创建对象</strong>：</p>
<ul>
<li>Paginator对象的page()方法返回Page对象</li>
<li>page&#x3D;paginator.page(页码)</li>
</ul>
<p><strong>Page对象属性</strong>：</p>
<ul>
<li>object_list：当前页上所有数据对象的列表</li>
<li>number：当前页的序号，从1开始</li>
<li>paginator：当前page对象相关的Paginator对象</li>
</ul>
<p><strong>Page对象方法</strong>：</p>
<ul>
<li>has_next()：如果有下一页返回True</li>
<li>has_previous()：如果有上一页返回True</li>
<li>has_other_page()：如果有上一页或下一页返回True</li>
<li>next_page_number()：返回下一页的页码，如果下一页不存在，抛出InvalidPage异常</li>
<li>previous_page_number()：返回上一页的页码，如果上一页不存在，抛出InvaildPage异常</li>
</ul>
<p>实例：</p>
<p>视图层：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#分页</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">text_page</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment">#页码通过url进行传递的(两种方式)</span><br>    <span class="hljs-comment">#/text_page/4</span><br>    <span class="hljs-comment">#/text_page?page=1  查询字符串</span><br>    page_num=request.GET.get(<span class="hljs-string">&#x27;page&#x27;</span>,<span class="hljs-number">1</span>)<br>    all_data=[<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>]<br>    <span class="hljs-comment">#初始化Paginator对象</span><br>    paginator=Paginator(all_data,<span class="hljs-number">2</span>)<br>    <span class="hljs-comment">#初始化 具体的页码的Page对象</span><br>    c_page=paginator.page(<span class="hljs-built_in">int</span>(page_num))<br>    <span class="hljs-keyword">return</span> render(request,<span class="hljs-string">&#x27;text_page.html&#x27;</span>,<span class="hljs-built_in">locals</span>())<br></code></pre></td></tr></table></figure>



<p>前端代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>分页<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>&#123;% for p in c_page %&#125;<br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>    &#123;&#123; p &#125;&#125;<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>&#123;% endfor %&#125;<br><br>&#123;% if c_page.has_previous %&#125;<br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/tem/text_page?page=&#123;&#123; c_page.previous_page_number &#125;&#125;&quot;</span>&gt;</span>上一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>&#123;% else %&#125;<br>  上一页<br>&#123;% endif %&#125;<br><br>&#123;% for p_num in paginator.page_range %&#125;<br>  &#123;% if p_num == c_page.number %&#125;<br>      &#123;&#123; p_num &#125;&#125;<br>  &#123;% else %&#125;<br>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/tem/text_page?page=&#123;&#123; p_num &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; p_num &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  &#123;% endif %&#125;<br>&#123;% endfor %&#125;<br><br><br>&#123;% if c_page.has_next %&#125;<br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/tem/text_page?page=&#123;&#123; c_page.next_page_number &#125;&#125;&quot;</span>&gt;</span>下一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>&#123;% else %&#125;<br>  下一页<br>&#123;% endif %&#125;<br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="csv文件"><a href="#csv文件" class="headerlink" title="csv文件"></a>csv文件</h2><p>定义：逗号分隔值（Comma-Separated Values,CSV,有时也称为字符分隔值，因为分隔字符也可以不是逗号），其文件以纯文本形式存储表格数据(数字和文本)</p>
<p>说明：可被常见制表工具，如excel等直接进行读取</p>
<h3 id="python中生成csv文件"><a href="#python中生成csv文件" class="headerlink" title="python中生成csv文件"></a>python中生成csv文件</h3><p>python提供了内建库 - csv；可直接通过该库操作csv文件</p>
<p>案例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> csv<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;eggs.csv&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,newline=<span class="hljs-string">&#x27;&#x27;</span>)<span class="hljs-keyword">as</span> csvfile:<br>    writer=csv.writer(csvfile)<br>    writer.writerow([<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>])<br></code></pre></td></tr></table></figure>



<h3 id="csv文件下载"><a href="#csv文件下载" class="headerlink" title="csv文件下载"></a>csv文件下载</h3><p>在网站中，实现下载csv，注意如下：</p>
<ul>
<li>响应Content-Type类型需修改为text&#x2F;csv。这告诉浏览器该文档是CSV文件，而不是HTML文件</li>
<li>响应会获得一个额外的Content-Disposition标头，其中包含CSV文件的名称。它将被浏览器用于开启”另存为…”对话框</li>
</ul>
<p>案例代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> csv<br><span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResposne<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Book<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_csv_view</span>(<span class="hljs-params">request</span>):<br>    response=HttpResponse(content_type=<span class="hljs-string">&#x27;text/csv&#x27;</span>)<br>    response[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>]=<span class="hljs-string">&#x27;attachment;filename=&quot;mybook.csv&quot;&#x27;</span><br>    all_book=Book.objects.<span class="hljs-built_in">all</span>()<br>    writer=csv.writer(response)<br>    writer.writerow([<span class="hljs-string">&#x27;id&#x27;</span>,<span class="hljs-string">&#x27;title&#x27;</span>])<br>    <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> all_book:<br>        writer.writerow([b.<span class="hljs-built_in">id</span>,b.title])<br>    <span class="hljs-keyword">return</span> response<br><br></code></pre></td></tr></table></figure>



<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>定义：用户可以通过浏览器将图片等文件传至网站</p>
<p>场景：</p>
<ul>
<li>用户上传头像</li>
<li>上传流程性的文档[pdf，txt等]</li>
</ul>
<h4 id="上传规范-前端-html"><a href="#上传规范-前端-html" class="headerlink" title="上传规范 - 前端[html]"></a>上传规范 - 前端[html]</h4><p>文件上传必须为POST提交方式</p>
<p>表单<code>&lt;form&gt;</code>中文件上传时必须有带有enctype&#x3D;”multipart&#x2F;form-data”时才会包含文件内容数据。</p>
<p>表单中用<code>&lt;input type=&quot;file&quot; name=&quot;xxx&quot;&gt;</code>标签上传文件</p>
<p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/tem/getfile/&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>	&#123;% csrf_token %&#125;<br>	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;login_box&quot;</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>文件上传<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input_box&quot;</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control-file&quot;</span> <span class="hljs-attr">name</span> =<span class="hljs-string">&#x27;hunter&#x27;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;exampleFormControlFile1&quot;</span>&gt;</span><br>		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary mb-2&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;getInput()&quot;</span>&gt;</span>上传<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="上传规范-后端-django"><a href="#上传规范-后端-django" class="headerlink" title="上传规范 - 后端[django]"></a>上传规范 - 后端[django]</h4><p>视图函数中，用request.FILES去文件框的内容</p>
<p>file&#x3D;request.FILES[‘xxx’]</p>
<p>说明：</p>
<ol>
<li>FILES的key对应页面中file框的name值</li>
<li>file绑定文件流对象</li>
<li>file.name 文件名</li>
<li>file.file 文件的字节流数据</li>
</ol>
<h4 id="配置文件的访问路径和存储路径"><a href="#配置文件的访问路径和存储路径" class="headerlink" title="配置文件的访问路径和存储路径"></a>配置文件的访问路径和存储路径</h4><p>在setting.py中设置MEDIA相关配置；Django把用户上传的文件，统称为media资源</p>
<p>Django把用户上传的文件，统称为media资源</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#file: settings.py</span><br>MEDIA_URL=<span class="hljs-string">&#x27;/media/&#x27;</span><br>MEDIA_ROOT=os.path.join(BASE_DIR,<span class="hljs-string">&#x27;media&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p><strong>MEDIA_URL和MEDIA_ROOT需要手动绑定</strong></p>
<p>步骤：主路由中添加路由</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.conf <span class="hljs-keyword">import</span> settings<br><span class="hljs-keyword">from</span> django.conf.urls.static <span class="hljs-keyword">import</span> static<br>urlpatterns+=static(settings.MEDIA_URL,document_root=settings.MEDIA_ROOT)<br></code></pre></td></tr></table></figure>

<p><strong>说明：等价于做了MEDIA_URL开头的路由，Django接到该特征请求后去MEDIA_ROOT路径查找资源</strong></p>
<h4 id="文件写入"><a href="#文件写入" class="headerlink" title="文件写入"></a>文件写入</h4><ol>
<li><p>方案1：传统的open方式</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">@csrf_exempt</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">if</span> request.method==<span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <span class="hljs-keyword">return</span> render(request,<span class="hljs-string">&#x27;text_upload.html&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> request.method==<span class="hljs-string">&#x27;POST&#x27;</span>:<br>        a_file=request.FILES[<span class="hljs-string">&#x27;myfile&#x27;</span>]<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;上传文件名是：&quot;</span>,a_file.name)<br> 	    filename=os.path.join(settings.MEDIA_ROOT,a_file.name)<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename,<span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                data=a_file.file.read()<br>                f.write(data)<br>            <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;接收文件：&quot;</span>+a_file.name+<span class="hljs-string">&quot;成功&quot;</span>)<br></code></pre></td></tr></table></figure>
</li>
<li><p>方案2：借助ORM</p>
<p>得借助orm层的字段：FileField(upload&#x3D;’子目录名’)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">@csrf_exempt</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_view_dj</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">if</span> request.method==<span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <span class="hljs-keyword">return</span> render(request,<span class="hljs-string">&#x27;test_upload.html&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> request.method==<span class="hljs-string">&#x27;POST&#x27;</span>:<br>        title=request.POST[<span class="hljs-string">&#x27;title&#x27;</span>]<br>        a_file=request.FILES[<span class="hljs-string">&#x27;myfile&#x27;</span>]<br>        Content.objects.create(desc=titile,myfile=a_file)<br>        <span class="hljs-keyword">return</span> 	HttpResponse(<span class="hljs-string">&#x27;---upload is ok---&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>orm层示例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Content</span>(models.Model):<br>    title=models.CharField(<span class="hljs-string">&#x27;文章名字&#x27;</span>,max_length=<span class="hljs-number">11</span>)<br>    picture=models.FileField(upload_to=<span class="hljs-string">&#x27;picture&#x27;</span>)<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h2><p>业务场景：</p>
<ul>
<li>业务告警</li>
<li>邮件验证</li>
<li>密码找回</li>
</ul>
<h4 id="邮件相关的三个协议"><a href="#邮件相关的三个协议" class="headerlink" title="邮件相关的三个协议"></a>邮件相关的三个协议</h4><ol>
<li><strong>SMTP</strong><ul>
<li>SMTP的全称是”Simple Mail Transfer Protocol”，即简单邮件传输协议(25号端口)</li>
<li>它是一组用于从源地址到目的地址传输邮件的规范，通过它来控制邮件的中转</li>
<li><strong>属于”推送”协议</strong></li>
</ul>
</li>
<li><strong>IMAP</strong><ul>
<li>IMAP全称是Internet Mail Access Protocol，即交互式邮件访问协议，是一个应用层协议(端口是143)</li>
<li>用来从本地邮件客户端(Outlook Express、Foxmail、Mozilla、Thunderbird等)访问远程服务器上的邮件</li>
<li><strong>属于”拉取”协议</strong></li>
</ul>
</li>
<li><strong>POP3</strong><ul>
<li>POP3事是Post Office Protocol 3 的简称，即邮局协议的第三个版本，是TCP&#x2F;IP协议族中的一员(默认端口是110)</li>
<li>本协议主要用于支持使用客户端远程管理在服务器上的电子邮件</li>
<li><strong>属于”拉取”协议</strong></li>
</ul>
</li>
</ol>
<h4 id="IMAP跟POP3的区别"><a href="#IMAP跟POP3的区别" class="headerlink" title="IMAP跟POP3的区别"></a>IMAP跟POP3的区别</h4><p>两者均为”拉取”型协议，负责从邮件服务器中下载邮件</p>
<ul>
<li><p><strong>IMAP具备摘要浏览功能，可预览部分摘要，再下载整个邮件</strong></p>
</li>
<li><p><strong>IMAP为双向协议，客户端操作可反馈给服务器</strong></p>
</li>
<li><p><strong>POP3必须下载全部邮件，无摘要功能</strong></p>
</li>
<li><p><strong>POP3为单向协议，客户端操作无法同步服务器</strong></p>
</li>
</ul>
<p><strong>邮件收发全过程</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511959.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><strong>django就是充当邮件客户端的身份</strong></p>
<h4 id="Django发邮件"><a href="#Django发邮件" class="headerlink" title="Django发邮件"></a>Django发邮件</h4><p>Django中配置邮件的功能，主要为SMTP协议，负责发邮件</p>
<h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><ul>
<li>给Django授权一个邮箱</li>
<li>Django用该邮箱给对应收件人发送邮件</li>
<li>django.core.mail封装了电子邮件的自动发送SMTP协议</li>
</ul>
<h5 id="授权步骤"><a href="#授权步骤" class="headerlink" title="授权步骤"></a>授权步骤</h5><p>以QQ邮箱为例：</p>
<ol>
<li><p>申请QQ号</p>
</li>
<li><p>用QQ号登录QQ邮箱并修改设置</p>
<ul>
<li>用申请到QQ号和密码登录 到<a target="_blank" rel="noopener" href="https://mail.qq.com/">https://mail.qq.com</a></li>
<li>修改’QQ邮箱-&gt;设置-&gt;账户-&gt;”POP3&#x2F;IMAP….服务”</li>
<li>拿到授权码</li>
</ul>
</li>
<li><p><strong>Django配置</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py">EMAIL_BACKEND=<span class="hljs-string">&#x27;django.core.mail.backends.smtp.EmailBackend&#x27;</span><br>EMAIL_HOST=<span class="hljs-string">&#x27;smtp.qq.com&#x27;</span> <span class="hljs-comment">#腾讯QQ邮箱SMTP服务器地址</span><br>EMAIL_PORT=<span class="hljs-number">25</span> <span class="hljs-comment">#SMTP服务的端口号</span><br>EMAIL_HOST_USER=<span class="hljs-string">&#x27;xxxx@qq.com&#x27;</span> <span class="hljs-comment">#发送邮件的QQ邮箱</span><br>EMAIL_HOST_PASSWORD=<span class="hljs-string">&#x27;******&#x27;</span> <span class="hljs-comment">#在QQ邮箱-&gt;设置-&gt;账户-&gt;&quot;POP3/IMAP...服务&quot;里得到的在第三方登录QQ邮箱授权码</span><br>EMAIL_USE_TLS=<span class="hljs-literal">False</span> <span class="hljs-comment">#与SMTP服务器通信时，是否启动TLS链接(安全链接)默认False</span><br></code></pre></td></tr></table></figure></li>
</ol>
<h5 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.core <span class="hljs-keyword">import</span> mail<br>mail.send_mail(<br>	subject,  <span class="hljs-comment">#题目</span><br>    message,  <span class="hljs-comment">#消息内容</span><br>    from_email,  <span class="hljs-comment">#发送者[当前配置邮箱]</span><br>    recipient_list=[<span class="hljs-string">&#x27;xxx@qq.com&#x27;</span>],  <span class="hljs-comment">#接收者邮件列表</span><br>)<br></code></pre></td></tr></table></figure>





<h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><p>项目部署是指在软件开发完毕后，将开发机器上运行的软件实际安装到服务器上进行长期运行</p>
<ol>
<li><p>在安装机器上安装和配置同版本的环境[py,数据库等]</p>
</li>
<li><p>django项目迁移</p>
<p>虚拟机linux系统下做的迁移，示例：linux命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo scp /home/tarena/django/mysite1 #要复制的项目<br>root@88.77.66.55:/home/root/xxx  #要迁移到的外部目录，得输入用户名和<br></code></pre></td></tr></table></figure>
</li>
<li><p>用uWSGI替代python manage.py runserver方法启动服务器</p>
</li>
<li><p>配置nginx反向代理服务器</p>
</li>
<li><p>用nginx配置静态文件路径，解决静态路径问题</p>
</li>
</ol>
<h4 id="uWSGI"><a href="#uWSGI" class="headerlink" title="uWSGI"></a>uWSGI</h4><h5 id="uWSGI网关接口配置"><a href="#uWSGI网关接口配置" class="headerlink" title="uWSGI网关接口配置"></a>uWSGI网关接口配置</h5><p>WSGI(Web Server Gateway Interface)Web服务器网关接口，是Python应用程序或框架和Web服务器之间的一种接口，被广泛使用</p>
<p>使用python manage.py runserver通常只在开发和测试环境中使用</p>
<p>当开发结束后，完善的项目代码需要在一个高效稳定的环境运行，这时可以使用WSGI</p>
<p><img src="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511960.bmp" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><img src="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511961.bmp" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><strong>uWSGI是WSGI的一种，它实现了http协议 WSGI协议以及uwsgi协议</strong></p>
<p>uWSGI功能完善，支持协议众多，在python web圈热度极高</p>
<p><strong>uWSGI主要以学习配置为主</strong></p>
<p><strong>配置uWSGI</strong></p>
<p>添加配置文件 <strong>项目同名文件夹&#x2F;uwsgi.ini</strong>,例如：mysite1&#x2F;mysite1&#x2F;uwsgi.ini</p>
<p><strong>文件以[uwsgi]开头</strong>，有如下配置项：</p>
<ol>
<li><p><strong>套接字方式的 IP地址:端口号 [此模式需要有nginx]</strong></p>
<p><strong>socket&#x3D;127.0.0.1:8000</strong></p>
</li>
<li><p><strong>Http通信方式的 IP地址:端口号</strong></p>
<p><strong>http&#x3D;127.0.0.1:8000</strong></p>
</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py">[uwsgi]<br><span class="hljs-number">1.</span>socket=<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8000</span><br><span class="hljs-number">2.</span>http=<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8000</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li><p><strong>项目当前工作目录</strong></p>
<p>示例：</p>
<p><strong>chdir&#x3D;&#x2F;home&#x2F;tarena&#x2F;…&#x2F;my_project</strong></p>
</li>
<li><p><strong>项目中wsgi.py文件的目录，相对于当前工作目录</strong></p>
<p>示例：</p>
<p><strong>wsgi-file&#x3D;my_project&#x2F;wsgi.py</strong></p>
</li>
<li><p><strong>进程个数</strong></p>
<p><strong>process&#x3D;4</strong></p>
</li>
<li><p><strong>每个进程的线程个数</strong></p>
<p><strong>threads&#x3D;2</strong></p>
</li>
<li><p><strong>服务的pid记录文件</strong></p>
<p><strong>pidfile&#x3D;uwsgi.pid</strong></p>
</li>
<li><p><strong>服务的日志文件位置</strong></p>
<p><strong>daemonize&#x3D;uwsgi.log</strong></p>
</li>
<li><p><strong>开启主进程管理模式</strong></p>
<p><strong>master&#x3D;true</strong></p>
</li>
</ol>
<p><strong>特殊说明</strong></p>
<p>Django的settings.py需要做如下配置</p>
<ol>
<li><strong>修改settings.py将DEBUG&#x3D;True改为DEBUG&#x3D;False</strong>(正式上线时是要更改该配置，要不然用户会看到我们的报错信息)</li>
<li><strong>修改settings.py将ALLOWED_HOSTS&#x3D;[]改为ALLOWED_HOSTS&#x3D;[‘网站域名’]或者[‘服务监听的ip地址’]</strong></li>
</ol>
<h5 id="uWSGI的运行管理"><a href="#uWSGI的运行管理" class="headerlink" title="uWSGI的运行管理"></a>uWSGI的运行管理</h5><ol>
<li><p><strong>启动uWSGI</strong></p>
<p>cd到uWSGI配置文件所在目录下</p>
<p><strong>uwsgi –ini uwsgi.ini</strong></p>
<p>**ps aux|grep ‘uwsgi’**检测是否启动uwsgi是否启动和停止</p>
</li>
<li><p><strong>停止uWSGI</strong></p>
<p>cd到uWSGI配置文件所在目录</p>
<p><strong>uwsgi –stop uwsgi.pid</strong></p>
</li>
<li><p><strong>重启uWSGI</strong></p>
<p><strong>uwsgi –reload uwsgi.pid</strong></p>
</li>
</ol>
<p><strong>uWSGI的运行说明</strong></p>
<ol>
<li>无论是启动后还是关闭，都需要执行ps aux|grep ‘uwsgi’确认是否符合预期</li>
<li>启动成功后，进程在后台执行，所有日志均输出在配置文件所在目录的uwsgi.log钟</li>
<li>Django中代码有任何修改，需要重新启动uwsgi</li>
</ol>
<p><strong>uWSGI测试</strong></p>
<p>在浏览器端输入<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/url%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95">http://127.0.0.1:8000/url进行测试</a></p>
<p>注意： 此时端口8000被uWSGI进程监听，并非runserver</p>
<p><strong>如果当前有与其返回，则uWSGI启动成功</strong></p>
<h5 id="uWSGI常见问题汇总"><a href="#uWSGI常见问题汇总" class="headerlink" title="uWSGI常见问题汇总"></a>uWSGI常见问题汇总</h5><ol>
<li><p>启动失败：端口被占用</p>
<p>原因：有其他进程占用uWSGI启动的端口；</p>
<p>解决方案：可执行 sudo lsof -i:端口号 查询出具体进程；杀掉进程后，重新启动uWSGI即可</p>
</li>
<li><p>停止失败：stop无法关闭uWSGI</p>
<p>原因：重复启动uWSGI，导致pid文件中的进程号失准</p>
<p>解决方案：ps出uWSGI进程，手动kill掉</p>
</li>
</ol>
<h4 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a><strong>nginx</strong></h4><ul>
<li>Nginx是轻量级的高性能Web服务器，提供了诸如HTTP代理和反向代理、负载均衡等一系列重要特性</li>
<li>C语言编写</li>
<li>nginx作用：<br>- 负载均衡，多台服务器轮流处理请求<br>               - 反向代理</li>
<li><strong>原理</strong>：客户端请求nginx，再由nginx将请求转发uWSGI运行的django</li>
</ul>
<p><strong>反向代理</strong>:就是nginx可以接收来自五湖四海的网民的请求，并将这些请求分发给多台django机器中</p>
<p><img src="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511962.bmp" srcset="/img/loading.gif" lazyload alt="image">*</p>
<p><strong>负载均衡</strong>：均衡的把请求分发给django机器</p>
<p><img src="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511963.bmp" srcset="/img/loading.gif" lazyload alt="image"></p>
<h5 id="nginx的运行"><a href="#nginx的运行" class="headerlink" title="nginx的运行"></a>nginx的运行</h5><ol>
<li><p><strong>启动nginx</strong></p>
<p>cd 到&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin目录中</p>
<p>输入命令**.&#x2F;nginx**来启动nginx</p>
</li>
<li><p><strong>停止nginx</strong></p>
<p>cd 到&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin目录中</p>
<p><strong>输入命令.&#x2F;nginx -s stop或者.&#x2F;nginx -s quit</strong></p>
<p>.nginx -s stop 是快速停止,可能会导致数据没有完全保存</p>
<p>.nginx -s quit 是有序停止</p>
</li>
<li><p><strong>重启nginx</strong></p>
<p>命令: <strong>.&#x2F;nginx -s reopen 或者 .&#x2F;nginx -s reload</strong></p>
</li>
<li><p><strong>查询nginx进程</strong></p>
<p>用于检测nginx是否启动成功</p>
<p>命令: <strong>ps -ef | grep nginx</strong></p>
</li>
<li><p><strong>命令大全</strong></p>
<p>killall nginx #杀死所有nginx进程</p>
<p>nginx -t #检测配置文件是否有语法错误，然后退出</p>
<p>nginx -v #显示版本信息并退出</p>
<p>nginx -V #显示版本和配置选项信息，然后退出</p>
<p>nginx -t #检测配置文件是否有语法错误，然后退出，<strong>因为有些文件权限没给，所以前面加个sudo</strong></p>
<p>nginx -T #检测配置文件是否有语法错误，转储并退出</p>
<p>nginx -q #在检测配置文件期间屏蔽非错误信息</p>
<p>nginx -?,-h #打开帮助信息  </p>
<p>nginx -p prefix #设置前缀路径(默认是:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;)</p>
<p>nginx -c filename #设置配置文件(默认是:&#x2F;etc&#x2F;nginx&#x2F;nginx.conf)</p>
<p>nginx -g directives #设置配置文件外的全局指令</p>
</li>
</ol>
<h5 id="nginx和uwsgi排错"><a href="#nginx和uwsgi排错" class="headerlink" title="nginx和uwsgi排错"></a><strong>nginx和uwsgi排错</strong></h5><p><strong>常见问题排查</strong></p>
<p>排查问题宗旨 是 看日志！看日志！ 看日志！！ 看日志！！！</p>
<ol>
<li>nginx日志位置：</li>
</ol>
<p>​				异常信息存放地：&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;error.log</p>
<p>​				正常访问信息存放地：&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;access.log</p>
<ol start="2">
<li><p>uwsgi日志位置：</p>
<p>​	项目同名目录下，uwsgi.log</p>
</li>
<li><p>访问127.0.0.1:80 地址，502响应</p>
<p>​	502响应代表nginx反向代理配置成功，但是对应的uwsgi未启动</p>
</li>
<li><p>访问127.0.0.1:80&#x2F;url 404响应</p>
<pre><code class="hljs">- 路由的确不在django配置中(黄色页面报错)
- nginx配置错误，未禁止掉 try_files
</code></pre>
</li>
</ol>
<p><strong>nginx静态文件配置问题</strong></p>
<p>静态文件配置步骤</p>
<ol>
<li><p>创建新路径-主要存放Django所有静态文件 如：&#x2F;home&#x2F;dreamcreator&#x2F;djdemo_static&#x2F;</p>
</li>
<li><p>在Django settings.py中添加新配置</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">STATIC_ROOT = <span class="hljs-string">&#x27;/home/dreamcreator/djdemo_static/static&#x27;</span><br><span class="hljs-comment">#注意此配置路径为 存放所有正式环境中需要的静态文件</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>进入项目，执行python3 manage.py collectstatic 执行该命令后，Django将项目中所有静态文件复制到STATIC_ROOT中，包括Django内建的静态文件</p>
</li>
</ol>
<p><strong>Nginx配置中添加新配置</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apl">server&#123;<br>	....<br>	location /static&#123;<br>		#root 第一步创建文件夹得绝对路径<br>		root /home/dreamcreator/djdemo_static;<br>	&#125;<br>	....<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="404-500页面"><a href="#404-500页面" class="headerlink" title="404&#x2F;500页面"></a><strong>404&#x2F;500页面</strong></h4><p><strong>定义和配置</strong></p>
<p><strong>在模板文件夹内添加404.html 模板，当视图触发Http404异常时将会被显示</strong></p>
<p><strong>404.html仅在发布版中(即settings.py中得DEBUG&#x3D;False时)才起作用，当响应处理函数触发Http404异常时就会跳转到404界面</strong></p>
<h4 id="邮箱告警"><a href="#邮箱告警" class="headerlink" title="邮箱告警"></a>邮箱告警</h4><h4 id="定义和配置"><a href="#定义和配置" class="headerlink" title="定义和配置"></a><strong>定义和配置</strong></h4><p>当正式服务器上代码运行有报错时，可将错误追溯信息发至指定的邮箱</p>
<p>settings.py中 - 在基础邮箱授权后 添加如下配置：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#关闭调试模式</span><br>DEBUG = <span class="hljs-literal">False</span><br><br><span class="hljs-comment">#错误报告接收方</span><br>ADMINS = [(<span class="hljs-string">&#x27;guoxiaonao&#x27;</span>,<span class="hljs-string">&#x27;xxxx@example.com&#x27;</span>),(<span class="hljs-string">&#x27;wanglaoshi&#x27;</span>,<span class="hljs-string">&#x27;xxxx@example.com&#x27;</span>)]<br><br><span class="hljs-comment">#发送错误报告方，默认为 root@localhost账户，多数邮件服务器会拒绝</span><br>SERVER_EMAIL = <span class="hljs-string">&#x27;email配置中的邮箱&#x27;</span><br></code></pre></td></tr></table></figure>



<p><strong>过滤敏感信息</strong></p>
<p>报错邮件中会显示一些错误的追踪，这些错误追踪会出现如password等敏感信息，Django已经将配置文件中的敏感信息过滤修改为多个星号，但是用户自定义的视图函数需要手动过滤敏感信息</p>
<p><em>可过滤如下信息</em>：</p>
<ul>
<li><p>局部变量</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.views.decorators.debug <span class="hljs-keyword">import</span> sensitive_variables<br><br><span class="hljs-meta">@sensitive_variables(<span class="hljs-params"><span class="hljs-string">&#x27;user&#x27;</span>,<span class="hljs-string">&#x27;pw&#x27;</span>,<span class="hljs-string">&#x27;cc&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_info</span>(<span class="hljs-params">user</span>):<br>    pw=user.pass_word<br>    cc=user.credit_card_number<br>    name=user.name<br>    ...<br></code></pre></td></tr></table></figure>

<p>说明：</p>
<ol>
<li>若报错邮件中牵扯到user，pw，cc等局部变量的值，则会将其替换成****，而name变量还显示其真实值</li>
<li>多个装饰器时，需要将其放在最顶部</li>
<li>若不传参数，则过滤所以局部变量的值</li>
</ol>
</li>
<li><p>POST提交数据</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.views.decorators.debug <span class="hljs-keyword">import</span> sensitive_post_parameters<br><br><span class="hljs-meta">@sensitive_post_parameters(<span class="hljs-params"><span class="hljs-string">&#x27;password&#x27;</span>,<span class="hljs-string">&#x27;username&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>(<span class="hljs-params">requet</span>):<br>    s=request.POST[<span class="hljs-string">&#x27;username&#x27;</span>]+request.POST[<span class="hljs-string">&#x27;abcd&#x27;</span>]<br>    <span class="hljs-comment">#&#x27;abcd&#x27;并不存在，此时引发error</span><br><span class="hljs-comment">#POST中username及password的值会被替换成 ******</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Celery框架"><a href="#Celery框架" class="headerlink" title="Celery框架"></a>Celery框架</h2><p><strong>概念</strong>：Celery是一个简单、灵活且可靠的，处理大量信息的分布式系统，专注于实时处理的异步任务队列，同时也支持任务调度。celery是一个基于Python开发的模块，可以帮助我们对任务进行分发和处理</p>
<p><strong>组成</strong>:</p>
<ol>
<li><em>消息中间件(message broker)</em></li>
<li><em>任务执行单元(worker)</em></li>
<li><em>任务执行结果存储(task result store)</em></li>
</ol>
<p><strong>消息中间件</strong></p>
<p>​	Celery本身不提供消息服务，但是可以方便的和第三方提供的消息中间件集成。包括，RabbitMQ,Redis等等</p>
<p><strong>任务执行单元</strong></p>
<p>​	Worker是Celery提供的任务执行的单元，worker并发的运行在分布式的系统节点中</p>
<p><strong>任务结果存储</strong></p>
<p>​	Task result store用来存储Worker执行的任务的结果，Celery支持以不同方式存储任务的结果，包括AMQP，redis等</p>
<p>另外，Celery还支持不同的并发和序列化手段</p>
<ul>
<li>并发：Prefork,Eventlet,gevent,threads&#x2F;single threaded</li>
<li>序列化：pickle,json,yaml,msgpack,zilb,bzip2 compression,Cryptographic message signing等等</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511964.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><p><strong>redis服务端启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /usr/local/redis/bin<br>./redis-server redis.conf<br></code></pre></td></tr></table></figure>



<p><strong>redis服务端关闭</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /usr/local/redis/bin<br>./redis-server stop<br></code></pre></td></tr></table></figure>



<p><strong>redis服务端重启</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /usr/local/redis/bin<br>./redis-server restart<br></code></pre></td></tr></table></figure>



<p><strong>redis客户端启动</strong></p>
<p>如果把redis-cli文件复制到了&#x2F;usr&#x2F;local&#x2F;bin&#x2F;目录下的话</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">任意一个目录下</span><br>redis-cli<br></code></pre></td></tr></table></figure>

<p>如果没有</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /usr/local/redis/bin<br>./redis-cli<br></code></pre></td></tr></table></figure>



<p><strong>redis客户端关闭</strong></p>
<ol>
<li><strong>Ctrl+c</strong></li>
<li><strong>客户端内输入 quit</strong></li>
<li><strong>客户端内输入 exit</strong></li>
</ol>
<p><strong>redis内部库的切换</strong></p>
<ol>
<li>进入redis客户端</li>
<li>输入命令 select 你要切换库的序号</li>
<li>输入 keys * 可以看到该库中所有的键</li>
</ol>
<h3 id="django部署Celery"><a href="#django部署Celery" class="headerlink" title="django部署Celery"></a>django部署Celery</h3><p><em>Celery的环境部署</em></p>
<ol>
<li>在django项目外创建一个给celery的单独目录</li>
<li>手动创建config.py文件用于存储celery配置，再建一个main.py文件用于跟django连接的主配置</li>
<li>在celery单独创建要使用task的目录然后在该目录中创建tasks.py文件用于写任务</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405191511965.png" srcset="/img/loading.gif" lazyload alt="image"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Django/" class="category-chain-item">Django</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Django/" class="print-no-link">#Django</a>
      
        <a href="/tags/Web/" class="print-no-link">#Web</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Django框架学习与开发</div>
      <div>https://moonfordream.github.io/posts/Django框架学习与开发/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Moon</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年5月19日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">计算机网络</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/hexo-github%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" title="hexo+github博客搭建">
                        <span class="hidden-mobile">hexo+github博客搭建</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/MoonforDream" target="_blank" rel="nofollow noopener"><span>Moon</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
