

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405190208396.jpg">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405190208396.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta name="google-site-verification" content="AjiazagGb4CIlb9bWWd66wgpHJ5-hhpbR58p3yYikbE" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Moon">
  <meta name="keywords" content="">
  
    <meta name="description" content="MoonNet Guide">
<meta property="og:type" content="article">
<meta property="og:title" content="MoonNet guide_en">
<meta property="og:url" content="https://moonfordream.github.io/posts/MoonNet-guide-en/index.html">
<meta property="og:site_name" content="Moon&#39;s Blog">
<meta property="og:description" content="MoonNet Guide">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-10-27T03:55:05.000Z">
<meta property="article:modified_time" content="2024-11-20T01:19:33.100Z">
<meta property="article:author" content="Moon">
<meta property="article:tag" content="MoonNet">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>MoonNet guide_en - Moon&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/scrollAnimation.css">
<link rel="stylesheet" href="/css/selection.css">
<link rel="stylesheet" href="/css/mk.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"moonfordream.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Moon&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://cdn.jsdelivr.net/gh/MoonforDream/photohouse/hexo/202405190159278.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MoonNet guide_en"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-10-27 11:55" pubdate>
          2024年10月27日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          2.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          24 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="MoonNet"
        id="heading-8c27045a0d4b6541a5b60fd982edaf21" role="tab" data-toggle="collapse" href="#collapse-8c27045a0d4b6541a5b60fd982edaf21"
        aria-expanded="true"
      >
        MoonNet
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-8c27045a0d4b6541a5b60fd982edaf21"
           role="tabpanel" aria-labelledby="heading-8c27045a0d4b6541a5b60fd982edaf21">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/posts/MoonNet-guide-en/" title="MoonNet guide_en"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">MoonNet guide_en</span>
        </a>
      
    
      
      
        <a href="/posts/MoonNet%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/" title="MoonNet使用手册"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">MoonNet使用手册</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">MoonNet guide_en</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="MoonNet-Guide"><a href="#MoonNet-Guide" class="headerlink" title="MoonNet Guide"></a>MoonNet Guide</h1><hr>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>MoonNet is a lightweight, high-performance, event-driven network library based on C++. It aims to simplify the development of network applications, supporting both TCP and UDP protocols. It provides an efficient event loop mechanism for handling asynchronous I&#x2F;O operations. With its modular design, MoonNet offers flexible interfaces that allow developers to quickly build high-performance network services.</p>
<hr>
<h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><ol>
<li><a href="#module-overview">Module Overview</a></li>
<li><a href="#classes-and-interfaces">Classes and Interfaces</a><ul>
<li><a href="#base_event">base_event</a></li>
<li><a href="#event">event</a></li>
<li><a href="#eventloop">eventloop</a></li>
<li><a href="#loopthread">loopthread</a></li>
<li><a href="#looptpool">looptpool</a></li>
<li><a href="#threadpool">Threadpool</a></li>
<li><a href="#buffer">buffer</a></li>
<li><a href="#bfevent">bfevent</a></li>
<li><a href="#udpevent">udpevent</a></li>
<li><a href="#timerevent">timerevent</a></li>
<li><a href="#signalevent">signalevent</a></li>
<li><a href="#acceptor">acceptor</a></li>
<li><a href="#server">server</a></li>
<li><a href="#wrap">wrap</a></li>
</ul>
</li>
<li><a href="#usage-examples">Usage Examples</a><ul>
<li><a href="#tcp-server-example">TCP Server Example</a></li>
<li><a href="#udp-server-example">UDP Server Example</a></li>
<li><a href="#timer-example">Timer Example</a></li>
<li><a href="#signal-handling-example">Signal Handling Example</a></li>
</ul>
</li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#frequently-asked-questions-faqs">Frequently Asked Questions (FAQs)</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<hr>
<h2 id="Module-Overview"><a href="#Module-Overview" class="headerlink" title="Module Overview"></a>Module Overview</h2><p>The core modules of MoonNet include:</p>
<ul>
<li><strong>Event Loop (<code>eventloop</code>)</strong>: Manages the registration, deletion, and distribution of events, implementing the core Reactor model.</li>
<li><strong>Event (<code>event</code>)</strong>: Represents an event on a file descriptor, encapsulating event callbacks and trigger mechanisms.</li>
<li><strong>Buffer (<code>buffer</code>)</strong>: Handles data buffering for non-blocking I&#x2F;O, implementing data caching and processing.</li>
<li><strong>Buffered Event (<code>bfevent</code>)</strong>: A buffer-based event handling class, encapsulating read&#x2F;write buffers and callbacks.</li>
<li><strong>UDP Event (<code>udpevent</code>)</strong>: Handles the sending and receiving of UDP packets.</li>
<li><strong>Timer Event (<code>timerevent</code>)</strong>: Provides timer functionality, supporting one-time and periodic timers.</li>
<li><strong>Signal Event (<code>signalevent</code>)</strong>: Handles UNIX signals, integrating signal events into the event loop.</li>
<li><strong>Acceptor (<code>acceptor</code>)</strong>: Listens on TCP ports and accepts new connections.</li>
<li><strong>Server (<code>server</code>)</strong>: Encapsulates TCP and UDP server functionalities, managing connections, events, and thread pools.</li>
</ul>
<blockquote>
<p><strong>Note</strong>: The commented-out section labeled <code>/** v1.0.0 **/</code> contains deprecated or previous versions of event handling functions. These have been superseded by the generalized functions to provide a unified approach to event management.</p>
</blockquote>
<hr>
<h2 id="Classes-and-Interfaces"><a href="#Classes-and-Interfaces" class="headerlink" title="Classes and Interfaces"></a>Classes and Interfaces</h2><h3 id="base-event"><a href="#base-event" class="headerlink" title="base_event"></a><code>base_event</code></h3><p><strong>Description:</strong></p>
<p><code>base_event</code> is the base class for all event types, defining the basic interfaces and behaviors of an event.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">eventloop</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">base_event</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">base_event</span>()&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> eventloop* <span class="hljs-title">getloop</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">disable_cb</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-comment">/** v1.0.1 **/</span><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">enable_listen</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">del_listen</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">update_ep</span><span class="hljs-params">()</span></span>=<span class="hljs-number">0</span>;<br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Descriptions:</strong></p>
<ul>
<li><p><code>virtual eventloop* getloop() const = 0;</code><br>Retrieves the associated event loop object.</p>
</li>
<li><p><code>virtual void close() = 0;</code><br>Closes the event and releases related resources.</p>
</li>
<li><p><code>virtual void disable_cb() = 0;</code><br>Disables the event’s callback functions to prevent it from being triggered again.</p>
</li>
<li><p><code>virtual void enable_listen() = 0;</code></p>
<p>Enables event listening.</p>
</li>
<li><p><code>virtual void del_listen() = 0;</code></p>
<p>Removes the event listening.</p>
</li>
<li><p><code>virtual void update_ep() = 0;</code></p>
<p>Updates the event’s status in epoll.</p>
</li>
</ul>
<hr>
<h3 id="event"><a href="#event" class="headerlink" title="event"></a><code>event</code></h3><p><strong>Description:</strong></p>
<p>The <code>event</code> class represents an event on a file descriptor, encapsulating the event type, callback functions, and trigger mechanisms.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">eventloop</span>;<br><br><span class="hljs-comment">// Event class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">event</span> : <span class="hljs-keyword">public</span> base_event &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> Callback = std::function&lt;<span class="hljs-built_in">void</span>()&gt;;<br><br>    <span class="hljs-built_in">event</span>(eventloop* base, <span class="hljs-type">int</span> fd, <span class="hljs-type">uint32_t</span> events);<br>    ~<span class="hljs-built_in">event</span>();<br><br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getfd</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;                <span class="hljs-comment">// Gets the file descriptor</span><br>    <span class="hljs-function"><span class="hljs-type">uint32_t</span> <span class="hljs-title">getevents</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;       <span class="hljs-comment">// Gets the event types being listened to</span><br>    <span class="hljs-function">eventloop* <span class="hljs-title">getloop</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setcb</span><span class="hljs-params">(<span class="hljs-type">const</span> Callback&amp; rcb, <span class="hljs-type">const</span> Callback&amp; wcb, <span class="hljs-type">const</span> Callback&amp; ecb)</span></span>; <span class="hljs-comment">// Sets the callback functions</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setrcb</span><span class="hljs-params">(<span class="hljs-type">const</span> Callback&amp; rcb)</span></span>; <span class="hljs-comment">// Sets the read event callback</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setwcb</span><span class="hljs-params">(<span class="hljs-type">const</span> Callback&amp; wcb)</span></span>; <span class="hljs-comment">// Sets the write event callback</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setecb</span><span class="hljs-params">(<span class="hljs-type">const</span> Callback&amp; ecb)</span></span>; <span class="hljs-comment">// Sets the error event callback</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setrevents</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> revents)</span></span>; <span class="hljs-comment">// Sets the triggered event types</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_events</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> op)</span></span>;  <span class="hljs-comment">// Enables specific event types</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_events</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> op)</span></span>; <span class="hljs-comment">// Disables specific event types</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update_ep</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;        <span class="hljs-comment">// Updates the event listening</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handle_cb</span><span class="hljs-params">()</span></span>;                 <span class="hljs-comment">// Handles the event callback</span><br><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">readable</span><span class="hljs-params">()</span></span>;                  <span class="hljs-comment">// Checks if the event is readable</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">writeable</span><span class="hljs-params">()</span></span>;                 <span class="hljs-comment">// Checks if the event is writable</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_read</span><span class="hljs-params">()</span></span>;               <span class="hljs-comment">// Enables read events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_read</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// Disables read events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_write</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// Enables write events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_write</span><span class="hljs-params">()</span></span>;             <span class="hljs-comment">// Disables write events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_ET</span><span class="hljs-params">()</span></span>;                 <span class="hljs-comment">// Enables edge-triggered mode</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_ET</span><span class="hljs-params">()</span></span>;                <span class="hljs-comment">// Disables edge-triggered mode</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reset_events</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// Resets the event types</span><br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del_listen</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;       <span class="hljs-comment">// Removes the event listening</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_listen</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;    <span class="hljs-comment">// Enables event listening</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_cb</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;       <span class="hljs-comment">// Disables the callback functions</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;            <span class="hljs-comment">// Closes the event</span><br><br><span class="hljs-keyword">private</span>:<br>    eventloop* loop_;<br>    <span class="hljs-type">int</span> fd_;<br>    <span class="hljs-type">uint32_t</span> events_;   <span class="hljs-comment">// Events being listened to</span><br>    <span class="hljs-type">uint32_t</span> revents_;  <span class="hljs-comment">// Triggered events</span><br>    Callback readcb_;   <span class="hljs-comment">// Read event callback</span><br>    Callback writecb_;  <span class="hljs-comment">// Write event callback</span><br>    Callback eventcb_;  <span class="hljs-comment">// Error event callback</span><br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Descriptions:</strong></p>
<ul>
<li><p><code>event(eventloop* base, int fd, uint32_t events);</code><br>Constructor that initializes the event object.</p>
</li>
<li><p><code>~event();</code><br>Destructor that releases resources.</p>
</li>
<li><p><code>int getfd() const;</code><br>Gets the file descriptor associated with the event.</p>
</li>
<li><p><code>uint32_t getevents() const;</code><br>Gets the event types being listened to.</p>
</li>
<li><p><code>eventloop* getloop() const override;</code><br>Retrieves the associated event loop object.</p>
</li>
<li><p><code>void setcb(const Callback&amp; rcb, const Callback&amp; wcb, const Callback&amp; ecb);</code><br>Sets the read, write, and error event callback functions.</p>
</li>
<li><p><code>void setrcb(const Callback&amp; rcb);</code><br>Sets the read event callback function.</p>
</li>
<li><p><code>void setwcb(const Callback&amp; wcb);</code><br>Sets the write event callback function.</p>
</li>
<li><p><code>void setecb(const Callback&amp; ecb);</code><br>Sets the error event callback function.</p>
</li>
<li><p><code>void setrevents(const uint32_t revents);</code><br>Sets the triggered event types.</p>
</li>
<li><p><code>void enable_events(uint32_t op);</code><br>Enables specific event types.</p>
</li>
<li><p><code>void disable_events(uint32_t op);</code><br>Disables specific event types.</p>
</li>
<li><p><code>void update_ep() override;</code><br>Updates the event’s status in epoll.</p>
</li>
<li><p><code>void handle_cb();</code><br>Handles the event by calling the appropriate callback functions.</p>
</li>
<li><p><code>bool readable();</code><br>Checks if the event is readable.</p>
</li>
<li><p><code>bool writeable();</code><br>Checks if the event is writable.</p>
</li>
<li><p><code>void enable_read();</code><br>Enables read event listening.</p>
</li>
<li><p><code>void disable_read();</code><br>Disables read event listening.</p>
</li>
<li><p><code>void enable_write();</code><br>Enables write event listening.</p>
</li>
<li><p><code>void disable_write();</code><br>Disables write event listening.</p>
</li>
<li><p><code>void enable_ET();</code><br>Enables edge-triggered mode.</p>
</li>
<li><p><code>void disable_ET();</code><br>Disables edge-triggered mode.</p>
</li>
<li><p><code>void reset_events();</code><br>Resets the event types.</p>
</li>
<li><p><code>void del_listen() override;</code><br>Removes the event listening.</p>
</li>
<li><p><code>void enable_listen() override;</code><br>Enables event listening.</p>
</li>
<li><p><code>void disable_cb() override;</code><br>Disables the event’s callback functions.</p>
</li>
<li><p><code>void close() override;</code><br>Closes the event.</p>
</li>
</ul>
<hr>
<h3 id="eventloop"><a href="#eventloop" class="headerlink" title="eventloop"></a><code>eventloop</code></h3><p><strong>Description:</strong></p>
<p>The <code>eventloop</code> class is the core of the event loop, implementing the Reactor model and managing the registration, deletion, and distribution of all events.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">base_event</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">event</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">loopthread</span>;<br><br><span class="hljs-comment">// Event loop class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">eventloop</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> Callback = std::function&lt;<span class="hljs-built_in">void</span>()&gt;;<br><br>    <span class="hljs-built_in">eventloop</span>(loopthread* base = <span class="hljs-literal">nullptr</span>, <span class="hljs-type">int</span> timeout = <span class="hljs-number">-1</span>);<br>    ~<span class="hljs-built_in">eventloop</span>();<br><br>    <span class="hljs-function">loopthread* <span class="hljs-title">getbaseloop</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getefd</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getevfd</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getload</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br><br>    <span class="hljs-comment">// Event control functions</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_event</span><span class="hljs-params">(event* event)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del_event</span><span class="hljs-params">(event* event)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mod_event</span><span class="hljs-params">(event* event)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span></span>;          <span class="hljs-comment">// Starts the event loop</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">loopbreak</span><span class="hljs-params">()</span></span>;     <span class="hljs-comment">// Stops the event loop</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">getallev</span><span class="hljs-params">(std::list&lt;event*&gt;&amp; list)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">create_eventfd</span><span class="hljs-params">()</span></span>;     <span class="hljs-comment">// Creates a notification file descriptor</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">read_eventfd</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">write_eventfd</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_pending_del</span><span class="hljs-params">(base_event* ev)</span></span>; <span class="hljs-comment">// Adds an event to the pending deletion queue</span><br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">updateload</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span></span>; <span class="hljs-comment">// Updates the load</span><br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> epfd_;                         <span class="hljs-comment">// epoll file descriptor</span><br>    <span class="hljs-type">int</span> eventfd_;                      <span class="hljs-comment">// Event notification file descriptor</span><br>    <span class="hljs-type">int</span> timeout_;                      <span class="hljs-comment">// epoll timeout</span><br>    std::atomic&lt;<span class="hljs-type">int</span>&gt; load_;            <span class="hljs-comment">// Load (number of active events)</span><br>    std::atomic&lt;<span class="hljs-type">bool</span>&gt; shutdown_;       <span class="hljs-comment">// Whether to shut down the event loop</span><br>    std::list&lt;event*&gt; evlist_;         <span class="hljs-comment">// List of events</span><br>    std::vector&lt;epoll_event&gt; events_;  <span class="hljs-comment">// Array of epoll events</span><br>    std::vector&lt;base_event*&gt; delque_;  <span class="hljs-comment">// Queue of events pending deletion</span><br>    loopthread* baseloop_;             <span class="hljs-comment">// Associated thread</span><br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Descriptions:</strong></p>
<ul>
<li><p><code>eventloop(loopthread* base = nullptr, int timeout = -1);</code><br>Constructor that initializes the event loop object.</p>
</li>
<li><p><code>~eventloop();</code><br>Destructor that releases resources.</p>
</li>
<li><p><code>loopthread* getbaseloop();</code><br>Gets the associated thread object.</p>
</li>
<li><p><code>int getefd() const;</code><br>Gets the epoll file descriptor.</p>
</li>
<li><p><code>int getevfd() const;</code><br>Gets the event notification file descriptor.</p>
</li>
<li><p><code>int getload() const;</code><br>Gets the current load (number of active events) of the event loop.</p>
</li>
<li><p><code>void add_event(event* event);</code><br>Adds an event to be listened to by epoll.</p>
</li>
<li><p><code>void del_event(event* event);</code><br>Removes an event from epoll.</p>
</li>
<li><p><code>void mod_event(event* event);</code><br>Modifies the event’s listening types.</p>
</li>
<li><p><code>void loop();</code><br>Starts the event loop and handles events.</p>
</li>
<li><p><code>void loopbreak();</code><br>Stops the event loop.</p>
</li>
<li><p><code>void getallev(std::list&lt;event*&gt;&amp; list);</code><br>Retrieves all events in the list.</p>
</li>
<li><p><code>void create_eventfd();</code><br>Creates an event notification file descriptor.</p>
</li>
<li><p><code>void read_eventfd();</code><br>Reads from the event notification file descriptor to handle loop termination signals.</p>
</li>
<li><p><code>void write_eventfd();</code><br>Writes to the event notification file descriptor to notify the event loop to terminate.</p>
</li>
<li><p><code>void add_pending_del(base_event* ev);</code><br>Adds an event to the pending deletion queue.</p>
</li>
</ul>
<hr>
<h3 id="loopthread"><a href="#loopthread" class="headerlink" title="loopthread"></a><code>loopthread</code></h3><p><strong>Description:</strong></p>
<p>The <code>loopthread</code> class encapsulates an event loop thread used to run an <code>eventloop</code>.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">eventloop</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">loopthread</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">loopthread</span>(<span class="hljs-type">int</span> timeout = <span class="hljs-number">-1</span>);<br>    ~<span class="hljs-built_in">loopthread</span>();<br><br>    <span class="hljs-function">eventloop* <span class="hljs-title">getloop</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// Gets the event loop object</span><br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">void</span> _init_(); <span class="hljs-comment">// Initializes the event loop</span><br><br><span class="hljs-keyword">private</span>:<br>    eventloop* loop_;<br>    std::thread t_;<br>    std::mutex mx_;<br>    std::condition_variable cv_;<br>    <span class="hljs-type">int</span> timeout_;<br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Descriptions:</strong></p>
<ul>
<li><p><code>loopthread(int timeout = -1);</code><br>Constructor that initializes the thread and creates the event loop.</p>
</li>
<li><p><code>~loopthread();</code><br>Destructor that terminates the thread and releases resources.</p>
</li>
<li><p><code>eventloop* getloop();</code><br>Gets the event loop object.</p>
</li>
<li><p><code>void _init_();</code><br>Internal function that initializes the event loop and starts looping.</p>
</li>
</ul>
<hr>
<h3 id="looptpool"><a href="#looptpool" class="headerlink" title="looptpool"></a><code>looptpool</code></h3><p><strong>Description:</strong></p>
<p>The <code>looptpool</code> class manages a group of event loop threads (<code>loopthread</code>), implementing thread pool functionality and providing static&#x2F;dynamic load balancing.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">eventloop</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">loopthread</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">looptpool</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">looptpool</span>(eventloop* base, <span class="hljs-type">bool</span> dispath = <span class="hljs-literal">false</span>); <span class="hljs-comment">// By default, dynamic load balancing is disabled</span><br>    ~<span class="hljs-built_in">looptpool</span>();<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">create_pool</span><span class="hljs-params">(<span class="hljs-type">int</span> timeout = <span class="hljs-number">-1</span>)</span></span>;                  <span class="hljs-comment">// Creates the thread pool</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">create_pool</span><span class="hljs-params">(<span class="hljs-type">int</span> n, <span class="hljs-type">int</span> timeout)</span></span>;                <span class="hljs-comment">// Creates the thread pool with specified number of threads</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">create_pool_noadjust</span><span class="hljs-params">(<span class="hljs-type">int</span> n, <span class="hljs-type">int</span> timeout)</span></span>;       <span class="hljs-comment">// Creates the thread pool without dynamic adjustment</span><br><br>    <span class="hljs-function">eventloop* <span class="hljs-title">ev_dispatch</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">// Dispatches events to event loops in the thread pool</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">delloop_dispatch</span><span class="hljs-params">()</span></span>;     <span class="hljs-comment">// Deletes a sub-reactor and redistributes events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addloop</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// Adds a new event loop thread</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">adjust_task</span><span class="hljs-params">()</span></span>;          <span class="hljs-comment">// Management thread task, dynamically adjusting sub-reactors</span><br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getscale</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// Gets the average load</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_adjust</span><span class="hljs-params">()</span></span>;        <span class="hljs-comment">// Enables dynamic load balancing</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span></span>;                 <span class="hljs-comment">// Stops the thread pool</span><br><br>    <span class="hljs-comment">// Disables copy and assignment operations</span><br>    <span class="hljs-built_in">looptpool</span>(<span class="hljs-type">const</span> looptpool&amp;) = <span class="hljs-keyword">delete</span>;<br>    looptpool&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> looptpool&amp;) = <span class="hljs-keyword">delete</span>;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">init_pool</span><span class="hljs-params">(<span class="hljs-type">int</span> timeout = <span class="hljs-number">-1</span>)</span></span>; <span class="hljs-comment">// Initializes the thread pool</span><br>    <span class="hljs-function">eventloop* <span class="hljs-title">getminload</span><span class="hljs-params">()</span></span>;          <span class="hljs-comment">// Gets the event loop with the minimum load</span><br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getmaxidx</span><span class="hljs-params">()</span></span>;                  <span class="hljs-comment">// Gets the index of the event loop with the maximum load</span><br><br><span class="hljs-keyword">private</span>:<br>    eventloop* baseloop_;            <span class="hljs-comment">// Main event loop</span><br>    std::thread manager_;            <span class="hljs-comment">// Management thread</span><br>    std::vector&lt;eventloop*&gt; loadvec_;<span class="hljs-comment">// List of event loops</span><br>    <span class="hljs-type">int</span> next_;                       <span class="hljs-comment">// Round-robin index</span><br>    <span class="hljs-type">int</span> t_num_;                      <span class="hljs-comment">// Number of threads</span><br>    <span class="hljs-type">int</span> timeout_;                    <span class="hljs-comment">// Timeout duration</span><br>    <span class="hljs-type">int</span> max_tnum_;                   <span class="hljs-comment">// Maximum number of threads</span><br>    <span class="hljs-type">int</span> min_tnum_;                   <span class="hljs-comment">// Minimum number of threads</span><br>    <span class="hljs-type">bool</span> dispath_;                   <span class="hljs-comment">// Whether dynamic dispatch is enabled</span><br>    <span class="hljs-type">int</span> coolsec_;                    <span class="hljs-comment">// Cool-down time</span><br>    <span class="hljs-type">int</span> timesec_;                    <span class="hljs-comment">// Dispatch interval</span><br>    <span class="hljs-type">int</span> scale_max_;                  <span class="hljs-comment">// Maximum load scale</span><br>    <span class="hljs-type">int</span> scale_min_;                  <span class="hljs-comment">// Minimum load scale</span><br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Descriptions:</strong></p>
<ul>
<li><p><code>looptpool(eventloop* base, bool dispath = false);</code><br>Constructor that initializes the thread pool and specifies whether to enable dynamic load balancing.</p>
</li>
<li><p><code>~looptpool();</code><br>Destructor that releases resources.</p>
</li>
<li><p><code>void create_pool(int timeout = -1);</code><br>Creates the thread pool with the default number of threads.</p>
</li>
<li><p><code>void create_pool(int n, int timeout);</code><br>Creates the thread pool with a specified number of threads.</p>
</li>
<li><p><code>void create_pool_noadjust(int n, int timeout);</code><br>Creates the thread pool without dynamic adjustment.</p>
</li>
<li><p><code>eventloop* ev_dispatch();</code><br>Dispatches events to event loops in the thread pool.</p>
</li>
<li><p><code>void delloop_dispatch();</code><br>Deletes the event loop with the maximum load and redistributes its events.</p>
</li>
<li><p><code>void addloop();</code><br>Adds a new event loop thread.</p>
</li>
<li><p><code>void adjust_task();</code><br>Management thread task for dynamically adjusting the number of threads.</p>
</li>
<li><p><code>int getscale();</code><br>Gets the average load scale.</p>
</li>
<li><p><code>void enable_adjust();</code><br>Enables dynamic load balancing.</p>
</li>
<li><p><code>void stop();</code><br>Stops the thread pool and terminates all event loops.</p>
</li>
</ul>
<hr>
<h3 id="Threadpool"><a href="#Threadpool" class="headerlink" title="Threadpool"></a><code>Threadpool</code></h3><p><strong>Description:</strong></p>
<p>The <code>Threadpool</code> class implements a general-purpose thread pool for executing arbitrary task functions.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Threadpool</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Threadpool</span>(<span class="hljs-type">int</span> num);<br>    ~<span class="hljs-built_in">Threadpool</span>();<br><br>    <span class="hljs-comment">// Adds a task to the thread pool</span><br>    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _Fn, <span class="hljs-keyword">typename</span>... _Args&gt;</span><br><span class="hljs-function">    <span class="hljs-type">void</span> <span class="hljs-title">add_task</span><span class="hljs-params">(_Fn&amp;&amp; fn, _Args&amp;&amp;... args)</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span>;          <span class="hljs-comment">// Initializes the thread pool</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">t_shutdown</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">// Shuts down the thread pool</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">t_task</span><span class="hljs-params">()</span></span>;        <span class="hljs-comment">// Task thread entry function</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">adjust_task</span><span class="hljs-params">()</span></span>;   <span class="hljs-comment">// Management thread entry function</span><br><br><span class="hljs-keyword">private</span>:<br>    std::thread adjust_thr;                    <span class="hljs-comment">// Management thread</span><br>    std::vector&lt;std::thread&gt; threads;          <span class="hljs-comment">// Worker threads</span><br>    std::queue&lt;std::function&lt;<span class="hljs-type">void</span>()&gt;&gt; tasks;   <span class="hljs-comment">// Task queue</span><br>    std::mutex mx;                             <span class="hljs-comment">// Mutex</span><br>    std::condition_variable task_cv;           <span class="hljs-comment">// Condition variable</span><br>    <span class="hljs-type">int</span> min_thr_num;                           <span class="hljs-comment">// Minimum number of threads</span><br>    <span class="hljs-type">int</span> max_thr_num;                           <span class="hljs-comment">// Maximum number of threads</span><br>    std::atomic&lt;<span class="hljs-type">int</span>&gt; run_num;                  <span class="hljs-comment">// Number of threads executing tasks</span><br>    std::atomic&lt;<span class="hljs-type">int</span>&gt; live_num;                 <span class="hljs-comment">// Number of live threads</span><br>    std::atomic&lt;<span class="hljs-type">int</span>&gt; exit_num;                 <span class="hljs-comment">// Number of threads to terminate</span><br>    <span class="hljs-type">bool</span> shutdown;                             <span class="hljs-comment">// Whether the thread pool is shut down</span><br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Descriptions:</strong></p>
<ul>
<li><p><code>Threadpool(int num);</code><br>Constructor that initializes the thread pool with a specified minimum number of threads.</p>
</li>
<li><p><code>~Threadpool();</code><br>Destructor that shuts down the thread pool.</p>
</li>
<li><p><code>void add_task(_Fn&amp;&amp; fn, _Args&amp;&amp;... args);</code><br>Adds a task to the thread pool, specifying the task function and its arguments.</p>
</li>
<li><p><code>void init();</code><br>Initializes the thread pool, creating worker and management threads.</p>
</li>
<li><p><code>void t_shutdown();</code><br>Shuts down the thread pool, terminating all threads.</p>
</li>
<li><p><code>void t_task();</code><br>Entry function for worker threads to execute tasks.</p>
</li>
<li><p><code>void adjust_task();</code><br>Entry function for the management thread to dynamically adjust the number of threads.</p>
</li>
</ul>
<hr>
<h3 id="buffer"><a href="#buffer" class="headerlink" title="buffer"></a><code>buffer</code></h3><p><strong>Description:</strong></p>
<p>The <code>buffer</code> class implements an auto-expanding buffer for handling data caching and operations in non-blocking I&#x2F;O.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">buffer</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">buffer</span>();<br>    ~<span class="hljs-built_in">buffer</span>();<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">append</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* data, <span class="hljs-type">size_t</span> len)</span></span>; <span class="hljs-comment">// Appends data to the buffer</span><br>    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-type">char</span>* data, <span class="hljs-type">size_t</span> len)</span></span>;     <span class="hljs-comment">// Reads data from the buffer</span><br>    <span class="hljs-function">std::string <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-type">size_t</span> len)</span></span>;            <span class="hljs-comment">// Reads data from the buffer and returns a string</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">retrieve</span><span class="hljs-params">(<span class="hljs-type">size_t</span> len)</span></span>;                 <span class="hljs-comment">// Moves the read pointer without copying data</span><br>    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">readbytes</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;                  <span class="hljs-comment">// Gets the size of readable data</span><br>    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">writebytes</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;                 <span class="hljs-comment">// Gets the size of writable space</span><br>    <span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-title">peek</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;                  <span class="hljs-comment">// Gets the data at the current read pointer</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reset</span><span class="hljs-params">()</span></span>;                              <span class="hljs-comment">// Resets the buffer</span><br>    <span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">readiov</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">int</span>&amp; errnum)</span></span>;      <span class="hljs-comment">// Reads data from a file descriptor into the buffer</span><br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">able_wirte</span><span class="hljs-params">(<span class="hljs-type">size_t</span> len)</span></span>;               <span class="hljs-comment">// Ensures there is enough writable space</span><br><br><span class="hljs-keyword">private</span>:<br>    std::vector&lt;<span class="hljs-type">char</span>&gt; buffer_;<br>    <span class="hljs-type">uint64_t</span> reader_;    <span class="hljs-comment">// Read pointer position</span><br>    <span class="hljs-type">uint64_t</span> writer_;    <span class="hljs-comment">// Write pointer position</span><br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Descriptions:</strong></p>
<ul>
<li><p><code>buffer();</code><br>Constructor that initializes the buffer.</p>
</li>
<li><p><code>~buffer();</code><br>Destructor that releases resources.</p>
</li>
<li><p><code>void append(const char* data, size_t len);</code><br>Appends data to the buffer.</p>
</li>
<li><p><code>size_t remove(char* data, size_t len);</code><br>Reads data from the buffer into a specified memory location.</p>
</li>
<li><p><code>std::string remove(size_t len);</code><br>Reads data from the buffer and returns it as a string.</p>
</li>
<li><p><code>void retrieve(size_t len);</code><br>Moves the read pointer forward, marking data as read without copying.</p>
</li>
<li><p><code>size_t readbytes() const;</code><br>Gets the number of bytes available for reading.</p>
</li>
<li><p><code>size_t writebytes() const;</code><br>Gets the number of bytes available for writing.</p>
</li>
<li><p><code>const char* peek() const;</code><br>Gets a pointer to the data at the current read position.</p>
</li>
<li><p><code>void reset();</code><br>Resets the buffer, clearing all data.</p>
</li>
<li><p><code>ssize_t readiov(int fd, int&amp; errnum);</code><br>Reads data from a file descriptor into the buffer using scatter&#x2F;gather I&#x2F;O.</p>
</li>
</ul>
<hr>
<h3 id="bfevent"><a href="#bfevent" class="headerlink" title="bfevent"></a><code>bfevent</code></h3><p><strong>Description:</strong></p>
<p>The <code>bfevent</code> class is a buffer-based event handling class, encapsulating read&#x2F;write buffers and callbacks, handling data transmission for TCP connections.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">eventloop</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">event</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">bfevent</span> : <span class="hljs-keyword">public</span> base_event &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> RCallback = std::function&lt;<span class="hljs-built_in">void</span>(bfevent*)&gt;;<br>    <span class="hljs-keyword">using</span> Callback = std::function&lt;<span class="hljs-built_in">void</span>()&gt;;<br><br>    <span class="hljs-built_in">bfevent</span>(eventloop* base, <span class="hljs-type">int</span> fd, <span class="hljs-type">uint32_t</span> events);<br>    ~<span class="hljs-built_in">bfevent</span>();<br><br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getfd</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function">eventloop* <span class="hljs-title">getloop</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function">buffer* <span class="hljs-title">getinbuff</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">buffer* <span class="hljs-title">getoutbuff</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">writeable</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setcb</span><span class="hljs-params">(<span class="hljs-type">const</span> RCallback&amp; rcb, <span class="hljs-type">const</span> Callback&amp; wcb, <span class="hljs-type">const</span> Callback&amp; ecb)</span></span>; <span class="hljs-comment">// Sets the callback functions</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setrcb</span><span class="hljs-params">(<span class="hljs-type">const</span> RCallback&amp; rcb)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setwcb</span><span class="hljs-params">(<span class="hljs-type">const</span> Callback&amp; wcb)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setecb</span><span class="hljs-params">(<span class="hljs-type">const</span> Callback&amp; ecb)</span></span>;<br>    <span class="hljs-function">RCallback <span class="hljs-title">getrcb</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">Callback <span class="hljs-title">getwcb</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">Callback <span class="hljs-title">getecb</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update_ep</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;                <span class="hljs-comment">// Updates the event listening</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del_listen</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;               <span class="hljs-comment">// Cancels event listening</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_listen</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;            <span class="hljs-comment">// Enables event listening</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendout</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* data, <span class="hljs-type">size_t</span> len)</span></span>;   <span class="hljs-comment">// Sends data</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendout</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; data)</span></span>;        <span class="hljs-comment">// Sends data</span><br>    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">receive</span><span class="hljs-params">(<span class="hljs-type">char</span>* data, <span class="hljs-type">size_t</span> len)</span></span>;       <span class="hljs-comment">// Receives data into specified memory</span><br>    <span class="hljs-function">std::string <span class="hljs-title">receive</span><span class="hljs-params">(<span class="hljs-type">size_t</span> len)</span></span>;              <span class="hljs-comment">// Receives a specified length of data</span><br>    <span class="hljs-function">std::string <span class="hljs-title">receive</span><span class="hljs-params">()</span></span>;                        <span class="hljs-comment">// Receives all available data</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_events</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> op)</span></span>;  <span class="hljs-comment">// Enables specific events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_events</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> op)</span></span>; <span class="hljs-comment">// Disables specific events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_read</span><span class="hljs-params">()</span></span>;               <span class="hljs-comment">// Enables read events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_read</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// Disables read events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_write</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// Enables write events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_write</span><span class="hljs-params">()</span></span>;             <span class="hljs-comment">// Disables write events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_ET</span><span class="hljs-params">()</span></span>;                 <span class="hljs-comment">// Enables edge-triggered mode</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_ET</span><span class="hljs-params">()</span></span>;                <span class="hljs-comment">// Disables edge-triggered mode</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_cb</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;       <span class="hljs-comment">// Disables callback functions</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;            <span class="hljs-comment">// Closes the event</span><br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close_event</span><span class="hljs-params">()</span></span>;               <span class="hljs-comment">// Internal function to close the event</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handle_read</span><span class="hljs-params">()</span></span>;               <span class="hljs-comment">// Handles read events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handle_write</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// Handles write events</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handle_event</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// Handles error events</span><br><br><span class="hljs-keyword">private</span>:<br>    eventloop* loop_;<br>    <span class="hljs-type">int</span> fd_;<br>    event* ev_;<br>    buffer inbuff_;<br>    buffer outbuff_;<br>    RCallback readcb_;<br>    Callback writecb_;<br>    Callback eventcb_;<br>    <span class="hljs-type">bool</span> closed_;<br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Descriptions:</strong></p>
<ul>
<li><p><code>bfevent(eventloop* base, int fd, uint32_t events);</code><br>Constructor that initializes the buffered event object.</p>
</li>
<li><p><code>~bfevent();</code><br>Destructor that closes the event and releases resources.</p>
</li>
<li><p><code>int getfd() const;</code><br>Gets the file descriptor.</p>
</li>
<li><p><code>eventloop* getloop() const override;</code><br>Retrieves the associated event loop.</p>
</li>
<li><p><code>buffer* getinbuff();</code><br>Gets the input buffer.</p>
</li>
<li><p><code>buffer* getoutbuff();</code><br>Gets the output buffer.</p>
</li>
<li><p><code>bool writeable() const;</code><br>Checks if the event is writable.</p>
</li>
<li><p><code>void setcb(const RCallback&amp; rcb, const Callback&amp; wcb, const Callback&amp; ecb);</code><br>Sets the read, write, and error event callback functions.</p>
</li>
<li><p><code>void update_ep() override;</code><br>Updates the event listening.</p>
</li>
<li><p><code>void del_listen() override;</code><br>Cancels event listening.</p>
</li>
<li><p><code>void enable_listen() override;</code><br>Enables event listening.</p>
</li>
<li><p><code>void sendout(const char* data, size_t len);</code><br>Sends data.</p>
</li>
<li><p><code>void sendout(const std::string&amp; data);</code><br>Sends data.</p>
</li>
<li><p><code>size_t receive(char* data, size_t len);</code><br>Receives data into specified memory.</p>
</li>
<li><p><code>std::string receive(size_t len);</code><br>Receives a specified length of data.</p>
</li>
<li><p><code>std::string receive();</code><br>Receives all available data.</p>
</li>
<li><p><code>void enable_events(uint32_t op);</code><br>Enables specific events.</p>
</li>
<li><p><code>void disable_events(uint32_t op);</code><br>Disables specific events.</p>
</li>
<li><p><code>void enable_read();</code><br>Enables read events.</p>
</li>
<li><p><code>void disable_read();</code><br>Disables read events.</p>
</li>
<li><p><code>void enable_write();</code><br>Enables write events.</p>
</li>
<li><p><code>void disable_write();</code><br>Disables write events.</p>
</li>
<li><p><code>void enable_ET();</code><br>Enables edge-triggered mode.</p>
</li>
<li><p><code>void disable_ET();</code><br>Disables edge-triggered mode.</p>
</li>
<li><p><code>void disable_cb() override;</code><br>Disables callback functions.</p>
</li>
<li><p><code>void close() override;</code><br>Closes the event.</p>
</li>
</ul>
<hr>
<h3 id="udpevent"><a href="#udpevent" class="headerlink" title="udpevent"></a><code>udpevent</code></h3><p><strong>Description:</strong></p>
<p>The <code>udpevent</code> class handles the transmission and reception of UDP protocol data, supporting non-blocking UDP communication.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs cpp">cppCopy codenamespace moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">eventloop</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">event</span>;<br><br><span class="hljs-comment">// UDP event handling class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">udpevent</span> : <span class="hljs-keyword">public</span> base_event &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> Callback = std::function&lt;<span class="hljs-built_in">void</span>()&gt;;<br>    <span class="hljs-keyword">using</span> RCallback = std::function&lt;<span class="hljs-built_in">void</span>(<span class="hljs-type">const</span> sockaddr_in&amp;, udpevent*)&gt;;<br><br>    <span class="hljs-built_in">udpevent</span>(eventloop* base, <span class="hljs-type">int</span> port);<br>    ~<span class="hljs-built_in">udpevent</span>();<br><br>    <span class="hljs-function">buffer* <span class="hljs-title">getinbuff</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">eventloop* <span class="hljs-title">getloop</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setcb</span><span class="hljs-params">(<span class="hljs-type">const</span> RCallback&amp; rcb, <span class="hljs-type">const</span> Callback&amp; ecb)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setrcb</span><span class="hljs-params">(<span class="hljs-type">const</span> RCallback&amp; rcb)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setecb</span><span class="hljs-params">(<span class="hljs-type">const</span> Callback&amp; ecb)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">init_sock</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span></span>;<br>    <span class="hljs-comment">/** v1.0.0 **/</span><br>    <span class="hljs-comment">//void start();       // Start listening</span><br>    <span class="hljs-comment">//void stop();        // Stop listening</span><br>    <br>    <span class="hljs-comment">/** v1.0.1 **/</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_listen</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;	<span class="hljs-comment">// Start listening</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del_listen</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;		<span class="hljs-comment">// Stop listening</span><br>    <br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update_ep</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;   <span class="hljs-comment">// Update listening event</span><br>    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">receive</span><span class="hljs-params">(<span class="hljs-type">char</span>* data, <span class="hljs-type">size_t</span> len)</span></span>;  <span class="hljs-comment">// Receive data into specified memory</span><br>    <span class="hljs-function">std::string <span class="hljs-title">receive</span><span class="hljs-params">(<span class="hljs-type">size_t</span> len)</span></span>;         <span class="hljs-comment">// Receive specified length of data</span><br>    <span class="hljs-function">std::string <span class="hljs-title">receive</span><span class="hljs-params">()</span></span>;                   <span class="hljs-comment">// Receive all readable data</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">send_to</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; data, <span class="hljs-type">const</span> sockaddr_in&amp; addr)</span></span>; <span class="hljs-comment">// Send data to specified address</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_read</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_read</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_ET</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_ET</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_cb</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function">RCallback <span class="hljs-title">getrcb</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">Callback <span class="hljs-title">getecb</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>; <span class="hljs-comment">// Close event</span><br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handle_receive</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// Handle receive event</span><br><br><span class="hljs-keyword">private</span>:<br>    eventloop* loop_;<br>    <span class="hljs-type">int</span> fd_;<br>    event* ev_;<br>    buffer inbuff_;<br>    RCallback receive_cb_;<br>    Callback event_cb_;<br>    <span class="hljs-type">bool</span> started_;<br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Description:</strong></p>
<ul>
<li><code>udpevent(eventloop* base, int port);</code><br><strong>Constructor:</strong> Initializes the UDP event object with the specified event loop and port number.</li>
<li><code>~udpevent();</code><br><strong>Destructor:</strong> Closes the event and releases resources.</li>
<li><code>buffer* getinbuff();</code><br><strong>Get Input Buffer:</strong> Retrieves the input buffer.</li>
<li><code>eventloop* getloop() const override;</code><br><strong>Get Event Loop:</strong> Retrieves the associated event loop.</li>
<li><code>void setcb(const RCallback&amp; rcb, const Callback&amp; ecb);</code><br><strong>Set Callbacks:</strong> Sets the receive and error event callback functions.</li>
<li><code>void setrcb(const RCallback&amp; rcb);</code><br><strong>Set Receive Callback:</strong> Sets the receive event callback function.</li>
<li><code>void setecb(const Callback&amp; ecb);</code><br><strong>Set Error Callback:</strong> Sets the error event callback function.</li>
<li><code>void init_sock(int port);</code><br><strong>Initialize Socket:</strong> Initializes the UDP socket.</li>
<li><code>void enable_listen() override;</code><br><strong>Enable Listening:</strong> Starts listening for UDP packets.</li>
<li><code>void del_listen() override;</code><br><strong>Disable Listening:</strong> Stops listening for UDP packets.</li>
<li><code>void update_ep() override;</code><br><strong>Update Event:</strong> Updates the listening event within the event loop.</li>
<li><code>size_t receive(char* data, size_t len);</code><br><strong>Receive Data:</strong> Receives data into the specified memory buffer.</li>
<li><code>std::string receive(size_t len);</code><br><strong>Receive Specified Length Data:</strong> Receives a specified length of data from the buffer.</li>
<li><code>std::string receive();</code><br><strong>Receive All Readable Data:</strong> Receives all readable data from the buffer.</li>
<li><code>void send_to(const std::string&amp; data, const sockaddr_in&amp; addr);</code><br><strong>Send Data To:</strong> Sends data to the specified address.</li>
<li><code>void enable_read();</code><br><strong>Enable Read Event:</strong> Enables the read event for the UDP socket.</li>
<li><code>void disable_read();</code><br><strong>Disable Read Event:</strong> Disables the read event for the UDP socket.</li>
<li><code>void enable_ET();</code><br><strong>Enable Edge Triggered:</strong> Enables edge-triggered behavior for the UDP socket.</li>
<li><code>void disable_ET();</code><br><strong>Disable Edge Triggered:</strong> Disables edge-triggered behavior for the UDP socket.</li>
<li><code>void disable_cb() override;</code><br><strong>Disable Callback:</strong> Disables the assigned callback functions.</li>
<li><code>RCallback getrcb();</code><br><strong>Get Receive Callback:</strong> Retrieves the currently assigned receive callback function.</li>
<li><code>Callback getecb();</code><br><strong>Get Error Callback:</strong> Retrieves the currently assigned error callback function.</li>
<li><code>void close() override;</code><br><strong>Close Event:</strong> Closes the UDP event and cleans up resources.</li>
<li><code>void handle_receive();</code><br><strong>Handle Receive Event:</strong> Processes incoming data when a receive event is triggered.</li>
</ul>
<hr>
<h3 id="timerevent"><a href="#timerevent" class="headerlink" title="timerevent"></a><code>timerevent</code></h3><p><strong>Description:</strong></p>
<p>The <code>timerevent</code> class implements timer functionalities, supporting both one-time and periodic timers for executing tasks at regular intervals.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs cpp">cppCopy codenamespace moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">event</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">eventloop</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">timerevent</span> : <span class="hljs-keyword">public</span> base_event &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> Callback = std::function&lt;<span class="hljs-built_in">void</span>()&gt;;<br><br>    <span class="hljs-built_in">timerevent</span>(eventloop* loop, <span class="hljs-type">int</span> timeout_ms, <span class="hljs-type">bool</span> periodic);<br>    ~<span class="hljs-built_in">timerevent</span>();<br><br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getfd</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function">eventloop* <span class="hljs-title">getloop</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setcb</span><span class="hljs-params">(<span class="hljs-type">const</span> Callback&amp; cb)</span></span>;<br>    <span class="hljs-comment">/** v1.0.0 **/</span><br>    <span class="hljs-comment">//void start();</span><br>    <span class="hljs-comment">//void stop();</span><br>    <span class="hljs-comment">/** v1.0.1 **/</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_listen</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del_listen</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update_ep</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>    <br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_cb</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function">Callback <span class="hljs-title">getcb</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">void</span> _init_();<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handle_timeout</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    eventloop* loop_;<br>    event* ev_;<br>    <span class="hljs-type">int</span> fd_;<br>    <span class="hljs-type">int</span> timeout_ms_;<br>    <span class="hljs-type">bool</span> periodic_;<br>    Callback cb_;<br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Description:</strong></p>
<ul>
<li><code>timerevent(eventloop* loop, int timeout_ms, bool periodic);</code><br><strong>Constructor:</strong> Initializes the timer event with the specified event loop, timeout in milliseconds, and a flag indicating whether the timer is periodic.</li>
<li><code>~timerevent();</code><br><strong>Destructor:</strong> Closes the timer and releases associated resources.</li>
<li><code>int getfd() const;</code><br><strong>Get File Descriptor:</strong> Retrieves the file descriptor associated with the timer.</li>
<li><code>eventloop* getloop() const override;</code><br><strong>Get Event Loop:</strong> Retrieves the associated event loop.</li>
<li><code>void setcb(const Callback&amp; cb);</code><br><strong>Set Callback:</strong> Assigns a callback function to be executed when the timer expires.</li>
<li><code>void enable_listen() override;</code><br><strong>Enable Listening:</strong> Starts the timer, enabling it to trigger events based on the specified timeout.</li>
<li><code>void del_listen() override;</code><br><strong>Disable Listening:</strong> Stops the timer from triggering further events.</li>
<li><code>void update_ep() override;</code><br><strong>Update Event:</strong> Updates the event’s state within the event loop, typically used after modifying timer settings.</li>
<li><code>void close() override;</code><br><strong>Close Event:</strong> Closes the timer event and cleans up resources.</li>
<li><code>void disable_cb() override;</code><br><strong>Disable Callback:</strong> Disables the assigned callback function, preventing it from being executed when the timer expires.</li>
<li><code>Callback getcb();</code><br><strong>Get Callback:</strong> Retrieves the currently assigned callback function.</li>
<li><code>void _init_();</code><br><strong>Initialize Timer:</strong> Internal method to initialize timer settings and configurations.</li>
<li><code>void handle_timeout();</code><br><strong>Handle Timeout:</strong> Internal method invoked when the timer expires, executing the assigned callback function.</li>
</ul>
<hr>
<h3 id="signalevent"><a href="#signalevent" class="headerlink" title="signalevent"></a><code>signalevent</code></h3><p><strong>Description:</strong></p>
<p>The <code>signalevent</code> class handles UNIX signals by integrating signal events into the event loop using a pipe mechanism.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs cpp">cppCopy codenamespace moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">eventloop</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">event</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">signalevent</span> : <span class="hljs-keyword">public</span> base_event &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> Callback = std::function&lt;<span class="hljs-built_in">void</span>(<span class="hljs-type">int</span>)&gt;;<br><br>    <span class="hljs-built_in">signalevent</span>(eventloop* base);<br>    ~<span class="hljs-built_in">signalevent</span>();<br><br>    <span class="hljs-function">eventloop* <span class="hljs-title">getloop</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_signal</span><span class="hljs-params">(<span class="hljs-type">int</span> signo)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_signal</span><span class="hljs-params">(<span class="hljs-type">const</span> std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; signals)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setcb</span><span class="hljs-params">(<span class="hljs-type">const</span> Callback&amp; cb)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_listen</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del_listen</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update_ep</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_cb</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function">Callback <span class="hljs-title">getcb</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">handle_signal</span><span class="hljs-params">(<span class="hljs-type">int</span> signo)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handle_read</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    eventloop* loop_;<br>    <span class="hljs-type">int</span> pipe_fd_[<span class="hljs-number">2</span>]; <span class="hljs-comment">// Read and write ends of the pipe</span><br>    event* ev_;<br>    Callback cb_;<br>    <span class="hljs-type">static</span> signalevent* sigev_; <span class="hljs-comment">// Singleton instance</span><br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Description:</strong></p>
<ul>
<li><code>signalevent(eventloop* base);</code><br><strong>Constructor:</strong> Initializes the signal event object with the given event loop.</li>
<li><code>~signalevent();</code><br><strong>Destructor:</strong> Closes the event and releases resources.</li>
<li><code>eventloop* getloop() const override;</code><br><strong>Get Event Loop:</strong> Retrieves the associated event loop.</li>
<li><code>void add_signal(int signo);</code><br><strong>Add Single Signal:</strong> Adds a listener for a single signal.</li>
<li><code>void add_signal(const std::vector&lt;int&gt;&amp; signals);</code><br><strong>Add Multiple Signals:</strong> Adds listeners for multiple signals.</li>
<li><code>void setcb(const Callback&amp; cb);</code><br><strong>Set Callback:</strong> Assigns a callback function to handle signals.</li>
<li><code>void enable_listen() override;</code><br><strong>Enable Listening:</strong> Starts listening for the configured signals.</li>
<li><code>void del_listen() override;</code><br><strong>Disable Listening:</strong> Stops listening for signals.</li>
<li><code>void update_ep() override;</code><br><strong>Update Event:</strong> Updates the event’s state within the event loop.</li>
<li><code>void disable_cb() override;</code><br><strong>Disable Callback:</strong> Disables the assigned callback function.</li>
<li><code>void close() override;</code><br><strong>Close Event:</strong> Closes the signal event and cleans up resources.</li>
<li><code>Callback getcb();</code><br><strong>Get Callback:</strong> Retrieves the currently assigned callback function.</li>
<li><code>static void handle_signal(int signo);</code><br><strong>Handle Signal (Static):</strong> Static method to handle incoming signals and forward them to the appropriate instance.</li>
<li><code>void handle_read();</code><br><strong>Handle Read:</strong> Processes the signal read from the pipe.</li>
</ul>
<hr>
<h3 id="acceptor"><a href="#acceptor" class="headerlink" title="acceptor"></a><code>acceptor</code></h3><p><strong>Description:</strong></p>
<p>The <code>acceptor</code> class is responsible for listening on a specified port, accepting new TCP connections, and handing them off to a callback function.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">eventloop</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">event</span>;<br><br><span class="hljs-comment">// Acceptor class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">acceptor</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> Callback = std::function&lt;<span class="hljs-built_in">void</span>(<span class="hljs-type">int</span>)&gt;;<br><br>    <span class="hljs-built_in">acceptor</span>(<span class="hljs-type">int</span> port, eventloop* base);<br>    ~<span class="hljs-built_in">acceptor</span>();<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">listen</span><span class="hljs-params">()</span></span>;               <span class="hljs-comment">// Starts listening</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span></span>;                 <span class="hljs-comment">// Stops listening</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">init_sock</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span></span>;    <span class="hljs-comment">// Initializes the listening socket</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setcb</span><span class="hljs-params">(<span class="hljs-type">const</span> Callback&amp; accept_cb)</span></span>; <span class="hljs-comment">// Sets the callback function</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handle_accept</span><span class="hljs-params">()</span></span>;        <span class="hljs-comment">// Handles new connections</span><br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> lfd_;           <span class="hljs-comment">// Listening socket</span><br>    eventloop* loop_;   <span class="hljs-comment">// Event loop</span><br>    event* ev_;         <span class="hljs-comment">// Event object</span><br>    Callback cb_;       <span class="hljs-comment">// Callback function</span><br>    <span class="hljs-type">bool</span> shutdown_;     <span class="hljs-comment">// Whether it has been shut down</span><br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Descriptions:</strong></p>
<ul>
<li><p><code>acceptor(int port, eventloop* base);</code><br>Constructor that initializes the acceptor object.</p>
</li>
<li><p><code>~acceptor();</code><br>Destructor that stops listening and releases resources.</p>
</li>
<li><p><code>void listen();</code><br>Starts listening.</p>
</li>
<li><p><code>void stop();</code><br>Stops listening.</p>
</li>
<li><p><code>void init_sock(int port);</code><br>Initializes the listening socket.</p>
</li>
<li><p><code>void setcb(const Callback&amp; accept_cb);</code><br>Sets the callback function for new connections.</p>
</li>
<li><p><code>void handle_accept();</code><br>Handles new connection events.</p>
</li>
</ul>
<hr>
<h3 id="server"><a href="#server" class="headerlink" title="server"></a><code>server</code></h3><p><strong>Description:</strong></p>
<p>The <code>server</code> class encapsulates TCP and UDP server functionalities, managing connections, events, and thread pools.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs cpp">cppCopy codenamespace moon &#123;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">udpevent</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">signalevent</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">timerevent</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">server</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> SCallback = std::function&lt;<span class="hljs-built_in">void</span>(<span class="hljs-type">int</span>)&gt;;<br>    <span class="hljs-keyword">using</span> UCallback = std::function&lt;<span class="hljs-built_in">void</span>(<span class="hljs-type">const</span> sockaddr_in&amp;, udpevent*)&gt;;<br>    <span class="hljs-keyword">using</span> RCallback = std::function&lt;<span class="hljs-built_in">void</span>(bfevent*)&gt;;<br>    <span class="hljs-keyword">using</span> Callback = std::function&lt;<span class="hljs-built_in">void</span>()&gt;;<br><br>    <span class="hljs-built_in">server</span>(<span class="hljs-type">int</span> port = <span class="hljs-number">-1</span>);<br>    ~<span class="hljs-built_in">server</span>();<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span>;                         <span class="hljs-comment">// Start the server</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span></span>;                          <span class="hljs-comment">// Stop the server</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">init_pool</span><span class="hljs-params">(<span class="hljs-type">int</span> timeout = <span class="hljs-number">-1</span>)</span></span>;     <span class="hljs-comment">// Initialize the thread pool</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">init_pool</span><span class="hljs-params">(<span class="hljs-type">int</span> tnum, <span class="hljs-type">int</span> timeout)</span></span>;<span class="hljs-comment">// Initialize the thread pool with a specified number of threads</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">init_pool_noadjust</span><span class="hljs-params">(<span class="hljs-type">int</span> tnum, <span class="hljs-type">int</span> timeout)</span></span>; <span class="hljs-comment">// Initialize the thread pool with a specified number of threads without dynamic scheduling</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_tcp</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span></span>;            <span class="hljs-comment">// Enable TCP service</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enable_tcp_accept</span><span class="hljs-params">()</span></span>;             <span class="hljs-comment">// Enable TCP connection listening</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disable_tcp_accept</span><span class="hljs-params">()</span></span>;            <span class="hljs-comment">// Disable TCP connection listening</span><br>    <span class="hljs-function">eventloop* <span class="hljs-title">getloop</span><span class="hljs-params">()</span></span>;                 <span class="hljs-comment">// Get the main event loop</span><br>    <span class="hljs-function">eventloop* <span class="hljs-title">dispatch</span><span class="hljs-params">()</span></span>;                <span class="hljs-comment">// Dispatch events</span><br><br>    <span class="hljs-comment">// Set the callback functions for TCP connections</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">set_tcpcb</span><span class="hljs-params">(<span class="hljs-type">const</span> RCallback&amp; rcb, <span class="hljs-type">const</span> Callback&amp; wcb, <span class="hljs-type">const</span> Callback&amp; ecb)</span></span>;<br><br>    <span class="hljs-comment">// Event operations</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addev</span><span class="hljs-params">(base_event *ev)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">delev</span><span class="hljs-params">(base_event *ev)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modev</span><span class="hljs-params">(base_event *ev)</span></span>;<br>    <span class="hljs-function">udpevent* <span class="hljs-title">add_udpev</span><span class="hljs-params">(<span class="hljs-type">int</span> port, <span class="hljs-type">const</span> UCallback&amp; rcb, <span class="hljs-type">const</span> Callback&amp; ecb)</span></span>;	<span class="hljs-comment">// It is recommended to use this function to add a `udpevent`. Errors will automatically clean up.</span><br>    <span class="hljs-function">signalevent* <span class="hljs-title">add_sev</span><span class="hljs-params">(<span class="hljs-type">int</span> signo, <span class="hljs-type">const</span> SCallback&amp; cb)</span></span>;<br>    <span class="hljs-function">signalevent* <span class="hljs-title">add_sev</span><span class="hljs-params">(<span class="hljs-type">const</span> std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; signals, <span class="hljs-type">const</span> SCallback&amp; cb)</span></span>;<br>    <span class="hljs-function">timerevent* <span class="hljs-title">add_timeev</span><span class="hljs-params">(<span class="hljs-type">int</span> timeout_ms, <span class="hljs-type">bool</span> periodic, <span class="hljs-type">const</span> Callback&amp; cb)</span></span>;<br><br>    <span class="hljs-comment">/** v1.0.0 **/</span><br>    <span class="hljs-comment">/* void add_ev(event *ev);</span><br><span class="hljs-comment">    void del_ev(event *ev);</span><br><span class="hljs-comment">    void mod_ev(event *ev);</span><br><span class="hljs-comment">    void add_bev(bfevent *bev);</span><br><span class="hljs-comment">    void del_bev(bfevent *bev);</span><br><span class="hljs-comment">    void mod_bev(bfevent *bev);</span><br><span class="hljs-comment">    void add_udpev(udpevent *uev);</span><br><span class="hljs-comment">    void del_udpev(udpevent *uev);</span><br><span class="hljs-comment">    void mod_udpev(udpevent *uev);</span><br><span class="hljs-comment">    void add_sev(signalevent* sev);</span><br><span class="hljs-comment">    void del_sev(signalevent* sev);</span><br><span class="hljs-comment">    void add_timeev(timerevent *tev);</span><br><span class="hljs-comment">    void del_timeev(timerevent *tev); */</span><br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">acceptcb_</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span></span>; <span class="hljs-comment">// Handle new connections</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">tcp_eventcb_</span><span class="hljs-params">(bfevent* bev)</span></span>; <span class="hljs-comment">// Handle TCP error events</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handle_close</span><span class="hljs-params">(base_event* ev)</span></span>; <span class="hljs-comment">// Handle event closure</span><br><br><span class="hljs-keyword">private</span>:<br>    std::mutex events_mutex_;<br>    eventloop base_;             <span class="hljs-comment">// Main event loop</span><br>    looptpool pool_;             <span class="hljs-comment">// Thread pool</span><br>    acceptor acceptor_;          <span class="hljs-comment">// Acceptor</span><br>    <span class="hljs-type">int</span> port_;                   <span class="hljs-comment">// Port number</span><br>    <span class="hljs-type">bool</span> tcp_enable_;            <span class="hljs-comment">// Whether TCP is enabled</span><br>    std::list&lt;base_event*&gt; events_; <span class="hljs-comment">// List of events</span><br><br>    <span class="hljs-comment">// TCP connection callback functions</span><br>    RCallback readcb_;<br>    Callback writecb_;<br>    Callback eventcb_;<br>&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Function Description:</strong></p>
<ul>
<li><code>server(int port = -1);</code><br><strong>Constructor:</strong> Initializes the server object.</li>
<li><code>~server();</code><br><strong>Destructor:</strong> Shuts down the server and releases resources.</li>
<li><code>void start();</code><br><strong>Start the server:</strong> Begins the event loop.</li>
<li><code>void stop();</code><br><strong>Stop the server:</strong> Terminates the event loop.</li>
<li><code>void init_pool(int timeout = -1);</code><br><strong>Initialize the thread pool:</strong> Sets up the thread pool with an optional timeout.</li>
<li><code>void enable_tcp(int port);</code><br><strong>Enable TCP service:</strong> Activates TCP functionality on the specified port.</li>
<li><code>void enable_tcp_accept();</code><br><strong>Enable TCP connection listening:</strong> Starts listening for incoming TCP connections.</li>
<li><code>void disable_tcp_accept();</code><br><strong>Disable TCP connection listening:</strong> Stops listening for incoming TCP connections.</li>
<li><code>eventloop* getloop();</code><br><strong>Get the main event loop:</strong> Retrieves the primary event loop instance.</li>
<li><code>eventloop* dispatch();</code><br><strong>Dispatch events:</strong> Distributes events to the thread pool.</li>
<li><code>void set_tcpcb(const RCallback&amp; rcb, const Callback&amp; wcb, const Callback&amp; ecb);</code><br><strong>Set TCP connection callbacks:</strong> Assigns callback functions for read, write, and error events on TCP connections.</li>
<li><code>void addev(base_event *ev);</code><br><strong>Add a general event:</strong> Adds a generic event (can pass any event type).</li>
<li><code>void delev(base_event *ev);</code><br><strong>Delete a general event:</strong> Removes a generic event (can pass any event type).</li>
<li><code>void modev(base_event *ev);</code><br><strong>Modify a general event:</strong> Modifies a generic event (can pass any event type).</li>
<li><code>udpevent* add_udpev(int port, const UCallback&amp; rcb, const Callback&amp; ecb);</code><br><strong>Add and initialize a UDP event:</strong> Adds a <code>udpevent</code> and initializes it. It is recommended to use this function to add a <code>udpevent</code>, as it will automatically clean up in case of errors.</li>
<li><code>signalevent* add_sev(int signo, const SCallback&amp; cb);</code><br><strong>Add and initialize a signal event:</strong> Adds a <code>signalevent</code> for a specific signal number and assigns a callback function.</li>
<li><code>signalevent* add_sev(const std::vector&lt;int&gt;&amp; signals, const SCallback&amp; cb);</code><br><strong>Add and initialize multiple signal events:</strong> Adds <code>signalevent</code> instances for a list of signal numbers and assigns a callback function.</li>
<li><code>timerevent* add_timeev(int timeout_ms, bool periodic, const Callback&amp; cb);</code><br><strong>Add and initialize a timer event:</strong> Adds a <code>timerevent</code> with a specified timeout in milliseconds, a flag indicating if it is periodic, and assigns a callback function.</li>
</ul>
<hr>
<h3 id="wrap"><a href="#wrap" class="headerlink" title="wrap"></a><code>wrap</code></h3><p><strong>Description:</strong></p>
<p>The <code>wrap</code> module encapsulates cross-platform socket operation functions, providing a unified interface for both Windows and Unix systems.</p>
<p><strong>Interface:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> _WRAP_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _WRAP_H_</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _WIN32</span><br><br><span class="hljs-comment">// Socket encapsulation functions for Windows platform</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setreuse</span><span class="hljs-params">(SOCKET fd)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setnonblock</span><span class="hljs-params">(SOCKET fd)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">perr_exit</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* s)</span></span>;<br><span class="hljs-comment">// Other function definitions...</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br><br><span class="hljs-comment">// Socket encapsulation functions for Unix/Linux platform</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">settcpnodelay</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setreuse</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setnonblock</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">perr_exit</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* s)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Accept</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-keyword">struct</span> sockaddr* sa, <span class="hljs-type">socklen_t</span>* salenptr)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Bind</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sockaddr* sa, <span class="hljs-type">socklen_t</span> salen)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Connect</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sockaddr* sa, <span class="hljs-type">socklen_t</span> salen)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Listen</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">int</span> backlog)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Socket</span><span class="hljs-params">(<span class="hljs-type">int</span> family, <span class="hljs-type">int</span> type, <span class="hljs-type">int</span> protocol)</span></span>;<br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">void</span>* ptr, <span class="hljs-type">size_t</span> nbytes)</span></span>;<br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">Write</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-type">void</span>* ptr, <span class="hljs-type">size_t</span> nbytes)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Close</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span></span>;<br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">Readn</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">void</span>* vptr, <span class="hljs-type">size_t</span> n)</span></span>;<br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">Writen</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-type">void</span>* vptr, <span class="hljs-type">size_t</span> n)</span></span>;<br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">Readline</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">void</span>* vptr, <span class="hljs-type">size_t</span> maxlen)</span></span>;<br><span class="hljs-comment">// Other function definitions...</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<p><strong>Function Descriptions:</strong></p>
<ul>
<li><p><code>void settcpnodelay(int fd);</code><br>Sets the socket to no-delay mode (<code>TCP_NODELAY</code>).</p>
</li>
<li><p><code>void setreuse(int fd);</code><br>Sets the socket’s address and port to be reusable.</p>
</li>
<li><p><code>void setnonblock(int fd);</code><br>Sets the socket to non-blocking mode.</p>
</li>
<li><p><code>void perr_exit(const char* s);</code><br>Prints an error message and exits the program.</p>
</li>
<li><p><code>int Accept(int fd, struct sockaddr* sa, socklen_t* salenptr);</code><br>Accepts a new connection.</p>
</li>
<li><p><code>int Bind(int fd, const struct sockaddr* sa, socklen_t salen);</code><br>Binds the socket to a specified address and port.</p>
</li>
<li><p><code>int Connect(int fd, const struct sockaddr* sa, socklen_t salen);</code><br>Connects to a specified address and port.</p>
</li>
<li><p><code>int Listen(int fd, int backlog);</code><br>Starts listening on the socket.</p>
</li>
<li><p><code>int Socket(int family, int type, int protocol);</code><br>Creates a new socket.</p>
</li>
<li><p><code>ssize_t Read(int fd, void* ptr, size_t nbytes);</code><br>Reads data from the socket.</p>
</li>
<li><p><code>ssize_t Write(int fd, const void* ptr, size_t nbytes);</code><br>Writes data to the socket.</p>
</li>
<li><p><code>int Close(int fd);</code><br>Closes the socket.</p>
</li>
<li><p><code>ssize_t Readn(int fd, void* vptr, size_t n);</code><br>Reads a specified number of bytes from the socket.</p>
</li>
<li><p><code>ssize_t Writen(int fd, const void* vptr, size_t n);</code><br>Writes a specified number of bytes to the socket.</p>
</li>
<li><p><code>ssize_t Readline(int fd, void* vptr, size_t maxlen);</code><br>Reads a line of data from the socket.</p>
</li>
</ul>
<hr>
<h2 id="Usage-Examples"><a href="#Usage-Examples" class="headerlink" title="Usage Examples"></a>Usage Examples</h2><p>The following examples demonstrate how to use the MoonNet network library to build TCP and UDP servers, as well as how to use timer and signal handling functionalities.</p>
<h3 id="TCP-Server-Example"><a href="#TCP-Server-Example" class="headerlink" title="TCP Server Example"></a>TCP Server Example</h3><p><strong>Description:</strong></p>
<p>Creates a simple TCP server that listens on a specified port, accepts client connections, and echoes back received data.</p>
<p><strong>Code Example:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;server.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;bfevent.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// Read event callback function</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_read</span><span class="hljs-params">(moon::bfevent* bev)</span> </span>&#123;<br>    std::string data = bev-&gt;<span class="hljs-built_in">receive</span>();<br>    <span class="hljs-keyword">if</span> (!data.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Received: &quot;</span> &lt;&lt; data &lt;&lt; std::endl;<br>        <span class="hljs-comment">// Echo the data back</span><br>        bev-&gt;<span class="hljs-built_in">sendout</span>(data);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Write event callback function</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_write</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">// Handle write events if necessary</span><br>&#125;<br><br><span class="hljs-comment">// Other event callback function (e.g., error)</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_event</span><span class="hljs-params">()</span> </span>&#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;An error occurred on the connection.&quot;</span> &lt;&lt; std::endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// Create a server listening on port 8080</span><br>    <span class="hljs-function">moon::server <span class="hljs-title">tcp_server</span><span class="hljs-params">(<span class="hljs-number">8080</span>)</span></span>;<br><br>    <span class="hljs-comment">// Set the buffered event callback functions</span><br>    tcp_server.<span class="hljs-built_in">set_tcpcb</span>(on_read, on_write, on_event);<br><br>    <span class="hljs-comment">// Initialize the thread pool (optional)</span><br>    tcp_server.<span class="hljs-built_in">init_pool</span>();<br><br>    <span class="hljs-comment">// Start the server</span><br>    tcp_server.<span class="hljs-built_in">start</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Explanation:</strong></p>
<ol>
<li><p><strong>Create Server Instance:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">moon::server <span class="hljs-title">tcp_server</span><span class="hljs-params">(<span class="hljs-number">8080</span>)</span></span>;<br></code></pre></td></tr></table></figure>

<p>Creates a <code>server</code> object that listens on TCP port <code>8080</code>.</p>
</li>
<li><p><strong>Set Callback Functions:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">tcp_server.<span class="hljs-built_in">set_tcpcb</span>(on_read, on_write, on_event);<br></code></pre></td></tr></table></figure>

<p>Sets the buffered event’s read, write, and error callback functions.</p>
</li>
<li><p><strong>Initialize Thread Pool:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">tcp_server.<span class="hljs-built_in">init_pool</span>();<br></code></pre></td></tr></table></figure>

<p>Initializes the thread pool to improve the server’s concurrency handling capabilities.</p>
</li>
<li><p><strong>Start Server:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">tcp_server.<span class="hljs-built_in">start</span>();<br></code></pre></td></tr></table></figure>

<p>Starts the server, begins the event loop, and listens for and handles connections.</p>
</li>
</ol>
<hr>
<h3 id="UDP-Server-Example"><a href="#UDP-Server-Example" class="headerlink" title="UDP Server Example"></a>UDP Server Example</h3><p><strong>Description:</strong></p>
<p>Creates a simple UDP server that listens on a specified port, receives data packets, and replies to clients.</p>
<p><strong>Code Example:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;server.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;udpevent.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// UDP receive callback function</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_udp_receive</span><span class="hljs-params">(<span class="hljs-type">const</span> sockaddr_in&amp; addr, moon::udpevent* uev)</span> </span>&#123;<br>    std::string data = uev-&gt;<span class="hljs-built_in">receive</span>();<br>    <span class="hljs-keyword">if</span> (!data.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;UDP Received from &quot;</span> &lt;&lt; <span class="hljs-built_in">inet_ntoa</span>(addr.sin_addr)<br>                  &lt;&lt; <span class="hljs-string">&quot;:&quot;</span> &lt;&lt; <span class="hljs-built_in">ntohs</span>(addr.sin_port) &lt;&lt; <span class="hljs-string">&quot; - &quot;</span> &lt;&lt; data &lt;&lt; std::endl;<br><br>        <span class="hljs-comment">// Send a reply</span><br>        std::string reply = <span class="hljs-string">&quot;Echo: &quot;</span> + data;<br>        uev-&gt;<span class="hljs-built_in">send_to</span>(reply, addr);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// Create a server without specifying a TCP port</span><br>    <span class="hljs-function">moon::server <span class="hljs-title">udp_server</span><span class="hljs-params">(<span class="hljs-number">-1</span>)</span></span>;<br><br>    <span class="hljs-comment">// Add a UDP event listening on port 5005</span><br>    udp_server.<span class="hljs-built_in">add_udpev</span>(<span class="hljs-number">5005</span>, on_udp_receive, <span class="hljs-literal">nullptr</span>);<br><br>    <span class="hljs-comment">// Start the server</span><br>    udp_server.<span class="hljs-built_in">start</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Explanation:</strong></p>
<ol>
<li><p><strong>Create Server Instance:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">moon::server <span class="hljs-title">udp_server</span><span class="hljs-params">(<span class="hljs-number">-1</span>)</span></span>;<br></code></pre></td></tr></table></figure>

<p>Creates a <code>server</code> object without enabling TCP service.</p>
</li>
<li><p><strong>Add UDP Event:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">udp_server.<span class="hljs-built_in">add_udpev</span>(<span class="hljs-number">5005</span>, on_udp_receive, <span class="hljs-literal">nullptr</span>);<br></code></pre></td></tr></table></figure>

<p>Adds a UDP event that listens on port <code>5005</code> and sets the receive callback function.</p>
</li>
<li><p><strong>Start Server:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">udp_server.<span class="hljs-built_in">start</span>();<br></code></pre></td></tr></table></figure>

<p>Starts the server, begins the event loop, and listens for and handles UDP packets.</p>
</li>
</ol>
<hr>
<h3 id="Timer-Example"><a href="#Timer-Example" class="headerlink" title="Timer Example"></a>Timer Example</h3><p><strong>Description:</strong></p>
<p>Uses a timer to periodically execute a task, such as printing a message every second.</p>
<p><strong>Code Example:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;server.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;timerevent.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// Timer callback function</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_timer</span><span class="hljs-params">()</span> </span>&#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Timer triggered!&quot;</span> &lt;&lt; std::endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// Create a server without specifying a TCP port</span><br>    <span class="hljs-function">moon::server <span class="hljs-title">timer_server</span><span class="hljs-params">(<span class="hljs-number">-1</span>)</span></span>;<br><br>    <span class="hljs-comment">// Add a periodic timer that triggers every 1000 milliseconds</span><br>    timer_server.<span class="hljs-built_in">add_timeev</span>(<span class="hljs-number">1000</span>, <span class="hljs-literal">true</span>, on_timer);<br><br>    <span class="hljs-comment">// Start the server</span><br>    timer_server.<span class="hljs-built_in">start</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Explanation:</strong></p>
<ol>
<li><p><strong>Create Server Instance:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">moon::server <span class="hljs-title">timer_server</span><span class="hljs-params">(<span class="hljs-number">-1</span>)</span></span>;<br></code></pre></td></tr></table></figure>

<p>Creates a <code>server</code> object without enabling TCP service.</p>
</li>
<li><p><strong>Add Timer Event:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">timer_server.<span class="hljs-built_in">add_timeev</span>(<span class="hljs-number">1000</span>, <span class="hljs-literal">true</span>, on_timer);<br></code></pre></td></tr></table></figure>

<p>Adds a timer event with a timeout of <code>1000</code> milliseconds (1 second). The <code>true</code> parameter indicates that the timer is periodic.</p>
</li>
<li><p><strong>Start Server:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">timer_server.<span class="hljs-built_in">start</span>();<br></code></pre></td></tr></table></figure>

<p>Starts the server, begins the event loop, and the timer starts working.</p>
</li>
</ol>
<hr>
<h3 id="Signal-Handling-Example"><a href="#Signal-Handling-Example" class="headerlink" title="Signal Handling Example"></a>Signal Handling Example</h3><p><strong>Description:</strong></p>
<p>Uses the signal event handling class to listen for and respond to specific UNIX signals, such as <code>SIGINT</code> (Ctrl+C).</p>
<p><strong>Code Example:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;server.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;signalevent.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;csignal&gt;</span></span><br><br><span class="hljs-comment">// Signal handling callback function</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_signal</span><span class="hljs-params">(<span class="hljs-type">int</span> signo)</span> </span>&#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Received signal: &quot;</span> &lt;&lt; signo &lt;&lt; std::endl;<br>    <span class="hljs-comment">// Perform cleanup operations or graceful exit here</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// Create a server without specifying a TCP port</span><br>    <span class="hljs-function">moon::server <span class="hljs-title">signal_server</span><span class="hljs-params">(<span class="hljs-number">-1</span>)</span></span>;<br><br>    <span class="hljs-comment">// Add signal events to listen for SIGINT and SIGTERM</span><br>    std::vector&lt;<span class="hljs-type">int</span>&gt; signals = &#123;SIGINT, SIGTERM&#125;;<br>    signal_server.<span class="hljs-built_in">add_sev</span>(signals, on_signal);<br><br>    <span class="hljs-comment">// Start the server</span><br>    signal_server.<span class="hljs-built_in">start</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Explanation:</strong></p>
<ol>
<li><p><strong>Create Server Instance:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">moon::server <span class="hljs-title">signal_server</span><span class="hljs-params">(<span class="hljs-number">-1</span>)</span></span>;<br></code></pre></td></tr></table></figure>

<p>Creates a <code>server</code> object without enabling TCP service.</p>
</li>
<li><p><strong>Add Signal Event:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::vector&lt;<span class="hljs-type">int</span>&gt; signals = &#123;SIGINT, SIGTERM&#125;;<br>signal_server.<span class="hljs-built_in">add_sev</span>(signals, on_signal);<br></code></pre></td></tr></table></figure>

<p>Adds a signal event to listen for <code>SIGINT</code> and <code>SIGTERM</code> signals and sets the callback function.</p>
</li>
<li><p><strong>Start Server:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">signal_server.<span class="hljs-built_in">start</span>();<br></code></pre></td></tr></table></figure>

<p>Starts the server, begins the event loop, and the signal handling starts working.</p>
</li>
</ol>
<hr>
<h2 id="Error-Handling"><a href="#Error-Handling" class="headerlink" title="Error Handling"></a>Error Handling</h2><p>MoonNet uses standard POSIX error handling mechanisms. When an error occurs, the library calls the <code>perr_exit</code> function to print an error message and terminate the program. Users can customize error handling logic as needed, such as modifying callback functions to handle specific error situations.</p>
<p><strong>Example:</strong></p>
<p>In <code>wrap.cpp</code>, the <code>perr_exit</code> function:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">perr_exit</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *s)</span> </span>&#123;<br>    <span class="hljs-built_in">perror</span>(s);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Custom Error Handling:</strong></p>
<p>If you want to avoid directly exiting the program when an error occurs, you can modify the <code>perr_exit</code> function or add error handling logic in the callback functions.</p>
<p><strong>Example:</strong></p>
<p>Handling errors in the callback function instead of exiting:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_event</span><span class="hljs-params">()</span> </span>&#123;<br>    std::cerr &lt;&lt; <span class="hljs-string">&quot;An error occurred on the connection.&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-comment">// Perform cleanup operations or attempt recovery</span><br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="Frequently-Asked-Questions-FAQs"><a href="#Frequently-Asked-Questions-FAQs" class="headerlink" title="Frequently Asked Questions (FAQs)"></a>Frequently Asked Questions (FAQs)</h2><h3 id="1-How-do-I-enable-both-TCP-and-UDP-services-simultaneously"><a href="#1-How-do-I-enable-both-TCP-and-UDP-services-simultaneously" class="headerlink" title="1. How do I enable both TCP and UDP services simultaneously?"></a>1. How do I enable both TCP and UDP services simultaneously?</h3><p><strong>Answer:</strong></p>
<p>Create a <code>server</code> instance, enable TCP service, and add UDP events.</p>
<p><strong>Example:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;server.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;bfevent.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;udpevent.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// TCP read callback function</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_tcp_read</span><span class="hljs-params">(moon::bfevent* bev)</span> </span>&#123;<br>    std::string data = bev-&gt;<span class="hljs-built_in">receive</span>();<br>    <span class="hljs-keyword">if</span> (!data.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;TCP Received: &quot;</span> &lt;&lt; data &lt;&lt; std::endl;<br>        <span class="hljs-comment">// Echo the data back</span><br>        bev-&gt;<span class="hljs-built_in">sendout</span>(data);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// UDP receive callback function</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_udp_receive</span><span class="hljs-params">(<span class="hljs-type">const</span> sockaddr_in&amp; addr, moon::udpevent* uev)</span> </span>&#123;<br>    std::string data = uev-&gt;<span class="hljs-built_in">receive</span>();<br>    <span class="hljs-keyword">if</span> (!data.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;UDP Received from &quot;</span> &lt;&lt; <span class="hljs-built_in">inet_ntoa</span>(addr.sin_addr)<br>                  &lt;&lt; <span class="hljs-string">&quot;:&quot;</span> &lt;&lt; <span class="hljs-built_in">ntohs</span>(addr.sin_port) &lt;&lt; <span class="hljs-string">&quot; - &quot;</span> &lt;&lt; data &lt;&lt; std::endl;<br><br>        <span class="hljs-comment">// Send a reply</span><br>        std::string reply = <span class="hljs-string">&quot;Echo: &quot;</span> + data;<br>        uev-&gt;<span class="hljs-built_in">send_to</span>(reply, addr);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// Create a server listening on TCP port 8080</span><br>    <span class="hljs-function">moon::server <span class="hljs-title">network_server</span><span class="hljs-params">(<span class="hljs-number">8080</span>)</span></span>;<br><br>    <span class="hljs-comment">// Set the TCP read event callback function</span><br>    network_server.<span class="hljs-built_in">set_tcpcb</span>(on_tcp_read, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);<br><br>    <span class="hljs-comment">// Add a UDP event listening on port 9090</span><br>    network_server.<span class="hljs-built_in">add_udpev</span>(<span class="hljs-number">9090</span>, on_udp_receive, <span class="hljs-literal">nullptr</span>);<br><br>    <span class="hljs-comment">// Initialize the thread pool</span><br>    network_server.<span class="hljs-built_in">init_pool</span>();<br><br>    <span class="hljs-comment">// Start the server</span><br>    network_server.<span class="hljs-built_in">start</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h3 id="2-How-do-I-gracefully-shut-down-the-server"><a href="#2-How-do-I-gracefully-shut-down-the-server" class="headerlink" title="2. How do I gracefully shut down the server?"></a>2. How do I gracefully shut down the server?</h3><p><strong>Answer:</strong></p>
<p>Call the <code>stop()</code> method to interrupt the event loop and ensure all resources are properly released.</p>
<p><strong>Example:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;server.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;signalevent.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;csignal&gt;</span></span><br><br>moon::server* global_server = <span class="hljs-literal">nullptr</span>;<br><br><span class="hljs-comment">// Signal handling callback</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_signal</span><span class="hljs-params">(<span class="hljs-type">int</span> signo)</span> </span>&#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Received signal: &quot;</span> &lt;&lt; signo &lt;&lt; <span class="hljs-string">&quot;, stopping server...&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-keyword">if</span> (global_server) &#123;<br>        global_server-&gt;<span class="hljs-built_in">stop</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// Create a server listening on TCP port 8080</span><br>    <span class="hljs-function">moon::server <span class="hljs-title">network_server</span><span class="hljs-params">(<span class="hljs-number">8080</span>)</span></span>;<br>    global_server = &amp;network_server;<br><br>    <span class="hljs-comment">// Set TCP callback functions (omitted)</span><br><br>    <span class="hljs-comment">// Add signal handling for SIGINT</span><br>    network_server.<span class="hljs-built_in">add_sev</span>(SIGINT, on_signal);<br><br>    <span class="hljs-comment">// Initialize the thread pool</span><br>    network_server.<span class="hljs-built_in">init_pool</span>();<br><br>    <span class="hljs-comment">// Start the server</span><br>    network_server.<span class="hljs-built_in">start</span>();<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Server stopped gracefully.&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h3 id="3-How-do-I-handle-data-race-issues-in-multithreading"><a href="#3-How-do-I-handle-data-race-issues-in-multithreading" class="headerlink" title="3. How do I handle data race issues in multithreading?"></a>3. How do I handle data race issues in multithreading?</h3><p><strong>Answer:</strong></p>
<p>MoonNet minimizes data race issues through its design of thread pools and event loops. Each event loop runs in an independent thread. When processing data in callback functions, users should ensure thread-safe access to shared resources, using synchronization mechanisms like mutexes (<code>std::mutex</code>).</p>
<p><strong>Example:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;server.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;bfevent.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><br><span class="hljs-comment">// Shared resource</span><br>std::mutex data_mutex;<br><span class="hljs-type">int</span> shared_data = <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">// TCP read callback function</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_tcp_read</span><span class="hljs-params">(moon::bfevent* bev)</span> </span>&#123;<br>    std::string data = bev-&gt;<span class="hljs-built_in">receive</span>();<br>    <span class="hljs-keyword">if</span> (!data.<span class="hljs-built_in">empty</span>()) &#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(data_mutex)</span></span>;<br>        shared_data += data.<span class="hljs-built_in">size</span>();<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Shared Data Size: &quot;</span> &lt;&lt; shared_data &lt;&lt; std::endl;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// Create a server listening on TCP port 8080</span><br>    <span class="hljs-function">moon::server <span class="hljs-title">network_server</span><span class="hljs-params">(<span class="hljs-number">8080</span>)</span></span>;<br><br>    <span class="hljs-comment">// Set the buffered event callback functions</span><br>    network_server.<span class="hljs-built_in">set_tcpcb</span>(on_tcp_read, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);<br><br>    <span class="hljs-comment">// Initialize the thread pool</span><br>    network_server.<span class="hljs-built_in">init_pool</span>();<br><br>    <span class="hljs-comment">// Start the server</span><br>    network_server.<span class="hljs-built_in">start</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>MoonNet provides an efficient and easy-to-use network programming framework suitable for building various types of network applications. With its modular design and flexible interfaces, developers can quickly implement high-performance network services. We hope this documentation helps you better understand and use the MoonNet network library.</p>
<p>If you have any questions or suggestions, feel free to contact the author or submit feedback.</p>
<hr>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/MoonNet/" class="category-chain-item">MoonNet</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/MoonNet/" class="print-no-link">#MoonNet</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MoonNet guide_en</div>
      <div>https://moonfordream.github.io/posts/MoonNet-guide-en/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Moon</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年10月27日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/MoonNet%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/" title="MoonNet使用手册">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MoonNet使用手册</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/Reactor%E6%A8%A1%E5%9E%8B/" title="Reactor模型">
                        <span class="hidden-mobile">Reactor模型</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="twikoo"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/twikoo/1.6.8/twikoo.all.min.js', function() {
        var options = Object.assign(
          {"envId":"https://moon-twikoo.netlify.app/.netlify/functions/twikoo","region":"ap-shanghai","path":"window.location.pathname"},
          {
            el: '#twikoo',
            path: 'window.location.pathname',
            onCommentLoaded: function() {
              Fluid.utils.listenDOMLoaded(function() {
                var imgSelector = '#twikoo .tk-content img:not(.tk-owo-emotion)';
                Fluid.plugins.imageCaption(imgSelector);
                Fluid.plugins.fancyBox(imgSelector);
              });
            }
          }
        )
        twikoo.init(options)
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/MoonforDream" target="_blank" rel="nofollow noopener"><span>Moon</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/js/scrollAnimation.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
